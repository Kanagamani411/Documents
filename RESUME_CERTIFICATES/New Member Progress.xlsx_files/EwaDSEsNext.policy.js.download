'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[59],{1462:function(r,F,a){a.r(F);var c=a(0),b=a(15),e=a(85),f=a(869),d=a(192),h=a(553);class l{constructor(Lb,Ic,Ob=null){this.id=Lb.Id;Ob||(Ob="");this.Udj=Ob;this.sensitivityLabel=Lb}}Object(c.a)(l,"AutoPolicyLabelData",null,[]);class k{constructor(Lb,Ic){this.YL=Lb;this.displayName=Ic}}Object(c.a)(k,"PolicyLabelRequestState",null,[]);var t=a(150),n=a(4),z=a(156),w=a(14),m=a(46),u=a(30);class y{static get Gud(){return y.Oxi}}
y.Oxi="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> </div> </div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}</label> </div> </div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'></input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'></input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'></input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>";
Object(c.a)(y,"JustificationDialogHtml",null,[]);class v extends t.a{constructor(Lb,Ic){super(!1,!1,v.Iu);this.yqa=[CommonUIStrings.l_SensitivityJustificationNoLongerApplies,CommonUIStrings.l_SensitivityJustificationIncorrect,CommonUIStrings.l_SensitivityJustificationOther];this.RWb=null;this.PWb=!1;this.EXb=Lb;this.OD=Ic;this.og=this.nYg();this.Ob=1;this.pe=v.id;this.tc(1,CommonUIStrings.l_DialogChange);this.YK(1,!1);this.p0(0)}SUd(){if(v.Iu)this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,
Object(e.a)(this,this.ORf,"reactJustificationDialogHandler"),this.x6e(this.PWb));else{const Lb={};for(let Ic=0;Ic<this.yqa.length;Ic++)Lb[v.TId+Ic]=!1;Lb[v.VOb]="";this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(e.a)(this,this.Nxi,"justificationDialogHandler"),Lb);this.Mfj();m.a.addHandler($get(v.VOb),w.a.input,Object(e.a)(this,this.JRj,"textAreaHandler"))}}validate(){if(v.Iu)return this.jmg(this.RWb);const Lb=$get(v.VOb);return Lb.disabled?!0:this.jmg(Lb.value)}jmg(Lb){const Ic=
2>Lb.length,Ob=500<Lb.length,Kc=RegExp("[{|}|;|\\\\]").test(Lb);Lb=""===u.a.kuc(Lb);return!Ic&&!Ob&&!Kc&&!Lb}Nxi(Lb,Ic){let Ob="";if(1===Lb)for(let Kc=0;Kc<this.yqa.length;Kc++)if(Ic[v.TId+Kc]){Ob=Kc===this.yqa.length-1?Ic[v.VOb]:this.yqa[Kc];break}this.OD(Lb,this.EXb,Ob)}ORf(Lb){let Ic="";1===Lb&&this.RWb&&(Ic=this.RWb);this.OD(Lb,this.EXb,Ic)}WVi(Lb){this.RWb=Lb;Lb=this.validate();this.PWb!==Lb&&(this.PWb=Lb,this.dUa(CommonUIStrings.l_SensitivityJustificationTitle,Object(e.a)(this,this.ORf,"reactJustificationDialogHandler"),
this.x6e(this.PWb)))}x6e(Lb){return{["id"]:this.pe,["bodyControls"]:{["choiceGroupProps"]:{},["textAreaProps"]:{["placeholder"]:CommonUIStrings.l_SensitivityJustificationPlaceholder}},["actionButtonProps"]:{["label"]:CommonUIStrings.l_DialogChange,["disabled"]:!Lb},["infoMessage"]:CommonUIStrings.l_SensitivityJustificationMessage,["justificationIrrelevantLabel"]:CommonUIStrings.l_SensitivityJustificationNoLongerApplies,["justificationIncorrectLabel"]:CommonUIStrings.l_SensitivityJustificationIncorrect,
["justificationOtherLabel"]:CommonUIStrings.l_SensitivityJustificationOther,["onJustificationUpdated"]:Object(e.a)(this,this.WVi,"onJustificationUpdated")}}JRj(Lb){Lb.target&&this.YK(1,this.validate())}nYg(){return t.a.zq(v.Gud,n.AFrameworkApplication.UA,z.getImageClass(v.iconName),CommonUIStrings.l_SensitivityJustificationMessage,this.yqa[0],this.yqa[1],this.yqa[2],CommonUIStrings.l_SensitivityJustificationPlaceholder)}Mfj(){const Lb=document.getElementsByName(v.oAi);for(let Ic=0;Ic<Lb.length;Ic++)m.a.addHandler(Lb[Ic],
w.a.focus,Object(e.a)(this,this.uQf,"radioButtonFocusHandler")),m.a.addHandler(Lb[Ic],w.a.click,Object(e.a)(this,this.uQf,"radioButtonFocusHandler"))}uQf(Lb){if(Lb=Lb.target){Lb.checked=!0;var Ic=$get(v.VOb);Lb.id===v.TId+(this.yqa.length-1)?(Ic.disabled=!1,Sys.UI.DomElement.setVisible(Ic,!0),Ic.focus()):(Ic.disabled=!0,Lb.focus());this.YK(1,this.validate())}}static get Iu(){return n.AFrameworkApplication.sa.Qa.tv&&n.AFrameworkApplication.sa.Qa.ssd}}v.Gud=y.Gud;v.oAi="ListRadioBox";v.TId="radiobox";
v.VOb="txtJustification";v.iconName="Info_32x32x32";v.id="JustificationDialog";Object(c.a)(v,"JustificationDialog",t.a,[]);class C extends t.a{constructor(Lb,Ic,Ob){super(!1,!1,!0);if(Lb&&Ob){var Kc={["id"]:"MandatoryLabellingDialog"};this.Mvg=Ob;this.TOc=Ic;if(!n.AFrameworkApplication.fa.pa("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||this.TOc&&""!==this.TOc)Kc.learnMoreLink={["type"]:"AppLinkProps",["id"]:"mandatoryLabellingLearnMoreLink",["text"]:CommonUIStrings.l_LearnMore,["handler"]:{["href"]:this.TOc,
["target"]:"_blank"},["customTooltip"]:CommonUIStrings.L_LearnMoreTooltip};Ic={["sections"]:[],["shouldAutoOpen"]:!1};Array.add(Ic.sections,{["id"]:"mandatoryLabellingFlyoutMenuSection",["controls"]:Lb});Kc.labelFlyout={["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabellingFyout",["label"]:"Pick a label",["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!0,["menuDefinition"]:Ic};Lb={["id"]:"MandatoryLabellingDialog",["bodyControls"]:Kc};Kc.initialLabelText=CommonUIStrings.l_MandatoryLabellingDialogInitialLabelText;
Kc.descriptionText=CommonUIStrings.l_MandatoryLabellingDialogDescriptionText;this.initializeAndShow(CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,Object(e.a)(this,this.xGi,"mandatoryLabellingDialogHandler"),Lb)}else b.ULS.sendTraceTag(560547850,306,10,"MandatoryLabelingDialog was triggered with invalid inputs")}xGi(Lb,Ic){1===Lb&&Ic.selectedLabel&&(Lb=Ic.selectedLabel,""!==Lb&&this.Mvg(Lb))}}Object(c.a)(C,"MandatoryLabellingDialog",t.a,[]);class x{constructor(){this.gkb=!!n.AFrameworkApplication.sa&&
n.AFrameworkApplication.sa.Qa.tv}Deh(Lb,Ic,Ob){this.gkb&&new C(Lb,Ic,Ob)}static get instance(){return x.La||(x.La=new x)}}x.La=null;Object(c.a)(x,"MandatoryLabellingDialogFactory",null,[768]);class B{}B.FOj="sbProtectForm14";B.HOj="SBStatusBarMarkAsReadOnly14";B.zzi="Info_16x16x32";B.irb="QuickSearchCompletedToday_16x16x32";B.tJd="CommonControlCheckboxCheck_16";B.ofg="On";B.visible="Visible";B.cJh="ImageIsVisible";B.KF="SourceControlId";B.menuItemId="MenuItemId";B.menu="Menu";B.OYc="AppLockId";B.value=
"Value";B.gi="LabelText";B.alt="Alt";B.Mdf="Image16by16";B.W5a="Image16by16Class";B.EOj="SBProtectForm_16";B.GOj="SBStatusBarMarkAsReadOnly_16";B.icon="Icon";B.iconColor="IconColor";B.customTooltip="CustomTooltip";B.jdj="MipTagDynamicFillWithOutline_20";B.kdj="MipTagLockDynamicFillWithOutline_20";B.idj="MipTagErrorOutline_20";B.ldj="MipTagQuestionOutline_20";B.EZd="transparent";B.JXj="UILocation";Object(c.a)(B,"PolicyConstants",null,[]);class H extends t.a{constructor(Lb,Ic,Ob){super(!1,!1,H.Iu);
this.EXb=Lb;this.IWa=Ic;this.OD=Ob;this.Ob=1;this.pe=H.id;this.p0(1);this.p0(0)}pVd(){const Lb={["id"]:"UserDefinedPermissionsDialog"};H.Iu&&this.initializeAndShow("Defined Permissions",Object(e.a)(this,this.v3j,"userDefinedPermissionsDialogHandler"),Lb)}v3j(Lb){1!==Lb&&this.OD(Lb,this.EXb,"",this.IWa)}static get Iu(){return n.AFrameworkApplication.sa.Qa.tv&&n.AFrameworkApplication.sa.Qa.ssd}}H.id="UserDefinedPermissionsDialog";Object(c.a)(H,"UserDefinedPermissionsDialog",t.a,[]);var I=a(583),U=a(379),
S=a(315),G=a(567),D=a(99),E=a(145),N=a(562),M=a(559),L=a(146),aa=a(434),V=a(135),P=a(88),ba=a(175),Y=a(332),Z=a(83),ea=a(108),ra=a(25),O=a(70),da=a(55);class xa{constructor(Lb,Ic,Ob,Kc){this.uOc=this.vOc=null;this.rbe=this.NNc=this.fOc=this.jkb=this.xce=this.Xde=this.LJc=!1;this.yVa=this.bfa=this.Tfa=this.xpa=this.IWa=this.Gs=this.K1=this.jf=null;this.fvg=this.FHc=0;this.r9d=this.bOc=this.RHc=null;this.Ma=Lb;this.Ye=Ic;this.mb=Ob;this.ah=Kc;this.Ukb={};this.Vge={};this.Yde={};this.jAb=Ob.pa("WacApplyManualPolicyLabelIsEnabled");
this.ah.value.Lre(Object(e.a)(this,this.kId,"processAutoSensitivityLabel"));this.ah.value.SXc(Object(e.a)(this,this.kId,"processAutoSensitivityLabel"));this.ah.value.R_b(Object(e.a)(this,this.W0i,"onUpdateLabelInfo"));n.AFrameworkApplication.sa&&n.AFrameworkApplication.sa.NNg(Object(e.a)(this,this.Wej,"refreshDocumentPolicyLabelsOnModeChange"));Ob.pa("SupportsPolicies")&&Ob.Wa("AppliedPolicyId")&&(this.vOc=Ob.Wa("IrmPolicyTitle"),this.uOc=Ob.Wa("IrmPolicyDescription"));this.xRc=Ob.pa("ProtectedFile");
this.ttg=this.mb.vd("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",6);this.utg=this.mb.vd("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5E3)}get t7a(){return n.AFrameworkApplication.t7a||!!this.bOc&&this.bOc()}Ag(){this.Ma.Nb(ra.a.FKf,ea.a.frame,Object(e.a)(this,this.oNe,"documentLabelPaneHandler"));this.Ma.Oe(ra.a.tbb,ea.a.frame,Object(e.a)(this,this.tbb,"queryPolicyLabel"),96);this.Ma.Nb(ra.a.KTa,ea.a.frame,Object(e.a)(this,this.KTa,"toggleSensitivity"));this.Ma.Nb(ra.a.jza,ea.a.frame,Object(e.a)(this,
this.jza,"populateSensitivityFlyout"));this.Ma.Nb(ra.a.setSensitivity,ea.a.frame,Object(e.a)(this,this.setSensitivity,"setSensitivity"));this.Ma.Oe(ra.a.ubb,ea.a.frame,Object(e.a)(this,this.ubb,"querySensitivity"),96);this.Ma.Nb(ra.a.A6,ea.a.frame,Object(e.a)(this,this.A6,"querySensitivityToggleButton"));this.Ma.Nb(ra.a.z6,ea.a.frame,Object(e.a)(this,this.z6,"querySensitivitySubFlyout"));this.vnb(ra.a.KTa)||this.Ma.zdb(ra.a.KTa,4);this.vnb(ra.a.jza)||this.Ma.zdb(ra.a.jza,4);this.vnb(ra.a.setSensitivity)||
this.Ma.zdb(ra.a.setSensitivity,4);this.vnb(ra.a.A6)||this.Ma.zdb(ra.a.A6,4);this.vnb(ra.a.z6)||this.Ma.zdb(ra.a.z6,4);this.Ye.updateCommandUI();n.AFrameworkApplication.fa&&n.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&L.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")&&this.ah.value.xkj(Object(e.a)(this,this.PTf,"registerActionsHandler"))}PTf(){this.Ag()}NPb(){this.Ma.xD(ra.a.FKf,
ea.a.frame,Object(e.a)(this,this.oNe,"documentLabelPaneHandler"));this.Ma.xD(ra.a.tbb,ea.a.frame,Object(e.a)(this,this.tbb,"queryPolicyLabel"));this.Ma.xD(ra.a.KTa,ea.a.frame,Object(e.a)(this,this.KTa,"toggleSensitivity"));this.Ma.xD(ra.a.jza,ea.a.frame,Object(e.a)(this,this.jza,"populateSensitivityFlyout"));this.Ma.xD(ra.a.setSensitivity,ea.a.frame,Object(e.a)(this,this.setSensitivity,"setSensitivity"));this.Ma.xD(ra.a.ubb,ea.a.frame,Object(e.a)(this,this.ubb,"querySensitivity"));this.Ma.xD(ra.a.A6,
ea.a.frame,Object(e.a)(this,this.A6,"querySensitivityToggleButton"));this.Ma.xD(ra.a.z6,ea.a.frame,Object(e.a)(this,this.z6,"querySensitivitySubFlyout"))}KTa(){return 32}t0e(Lb){const Ic="mandatoryLabelling_"+Lb.Id;this.Yde[Ic]=Lb.Id;return{["type"]:"AppToggleButtonProps",["id"]:Ic,["label"]:Lb.DisplayName,["hideLabel"]:!1,["customTooltip"]:Lb.Tooltip}}nNa(){return this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPEnabled",!1)}HYh(){const Lb=[],Ic=this.K1;for(let Kc in Ic){var Ob=Ic[Kc];
const Ac=this.Gs[Kc];if(Ac&&Ac.Enabled&&!Ac.HasUserDefinedPermissions)if(Ob.count){const Yc={["sections"]:[],["shouldAutoOpen"]:!1},td={["id"]:"mandatoryLabelling_flyoutMenuSection_"+Ac.Id,["controls"]:[]};for(let $d of Ob)(Ob=this.Gs[$d])&&Ob.Enabled&&!Ob.HasUserDefinedPermissions&&Array.add(td.controls,this.t0e(Ob));Array.add(Yc.sections,td);Array.add(Lb,{["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabelling_"+Ac.Id,["label"]:Ac.DisplayName,["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!1,
["menuDefinition"]:Yc})}else Array.add(Lb,this.t0e(Ac))}return Lb}jza(Lb,Ic,Ob,Kc,Ac){if(1===Ob||!this.ah.value.Zga(!0))return 32;Ac.MenuItems=Object.assign(new N.a,{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0});Array.add(Ac.MenuItems.MenuSectionList,this.Ec(!this.isReactRibbonEnabled()));this.jf.CustomUrl&&Array.add(Ac.MenuItems.MenuSectionList,this.seh(this.isReactRibbonEnabled()?this.jf.CustomUrl:u.a.We(this.jf.CustomUrl)));this.isReactRibbonEnabled()||(Ac.PopulationXML=S.q(Ac.MenuItems));
return 32}ubb(Lb,Ic,Ob,Kc,Ac){if(1===Ob||!Ac||!this.jAb)return 32;this.jf=this.ah.value.Zm;if(this.ah.value.Zga(!0)&&(Ac[B.visible]=!0,this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelsAvailableActivityControlEnabled",!1)?this.xce||(E.a("MipLabelsAvailable"),this.xce=!0):E.a("MipLabelsAvailable"),this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelTUIEnabled",!1)&&this.jf&&this.jf.AreLabelsAvailable&&(Lb=Z.a.instance.Tb("Common.ISystemInitiatedFeedback")))){const Yc=
xa.lh(this.jf.AppliedPolicyId)?"LouderLabel_NoLabelAppliedOnLoadActivity":"LouderLabel_LabelExistsOnLoadActivity";Lb.execute(td=>{td.logActivity(Yc,null)})}return 32}A6(Lb,Ic,Ob,Kc,Ac){if(1===Ob||!Ac)return 32;let Yc,td;Ac[B.ofg]=!!(Yc=Ac[B.menuItemId])&&!!(td=this.Ukb[Yc])&&td===this.jf.AppliedPolicyId;return 32}z6(Lb,Ic,Ob,Kc,Ac){if(1===Ob||!Ac)return 32;let Yc,td,$d;Lb=!!(Yc=Ac[B.KF])&&!!(td=this.Ukb[Yc])&&!!($d=this.K1[td])&&$d.contains(this.jf.AppliedPolicyId);Ac[B.cJh]=Lb;Ac[B.ofg]=Lb;return 32}setSensitivity(Lb,
Ic,Ob,Kc,Ac){if(1===Ob||!Ac)return 32;Lb=this.Ukb[Ac[B.KF]];Ic=this.KXj(Ac[B.JXj]);Ob=new O.a;Ob.name="SensitivityPickerLocation";Ob.int64=Ic;E.a("SensitivityPickerUsage",void 0,void 0,[Ob]);return this.Jna(Lb,Ac,2)}Hhc(){return!!n.AFrameworkApplication.sa&&1===n.AFrameworkApplication.sa.mode}Wej(){this.NNc&&!this.Hhc()&&(this.NNc=!1,this.ah.value.Vej())}lgg(){this.jf.DefaultLabelId&&this.jf.MandatoryLabelingEnforced?this.LJc||this.Hhc()?this.jf.AppliedPolicyId?this.$$c(""):(this.ah.value.yti(this.ah.value.iDb)||
this.Hhc())&&this.RPe():this.A4f():this.jf.DefaultLabelId?this.A4f():this.jf.MandatoryLabelingEnforced&&(this.jf.AppliedPolicyId?this.$$c(""):this.RPe())}fkf(){return this.jf.MandatoryLabelingEnforced?this.jf&&this.jf.AreLabelsAvailable?this.mb.pa("TestOverrideIsReactDialogEnabled")||this.Ye&&this.Ye.Qa&&this.Ye.Qa.tv?!0:(b.ULS.sendTraceTag(539109065,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"),!1):(b.ULS.sendTraceTag(539109064,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"),
!1):(b.ULS.sendTraceTag(539109063,306,50,"Mandatory labelling not invoked b/c user did not have policy!"),!1)}RPe(){!this.fkf()||n.AFrameworkApplication.W4||this.Xde||(this.Xde=n.AFrameworkApplication.W4=!0,b.ULS.sendTraceTag(562837517,306,50,"Mandatory labelling is invoked successfully."),this.ah.value.OQf("",1),this.ah.value.LWc(37,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarButton,
()=>{this.vGi()}))}$$c(Lb){this.fkf()&&n.AFrameworkApplication.W4&&(n.AFrameworkApplication.W4=!1,b.ULS.sendTraceTag(562837518,306,50,"Mandatory labelling is escaped successfully."),this.ah.value.wLd(),this.ah.value.OQf(Lb,2))}vGi(){x.instance.Deh(this.HYh(),this.jf.CustomUrl,Object(e.a)(this,this.wGi,"mandatoryLabellingDialogCallback"))}wGi(Lb){this.$$c(this.Yde[Lb])}Rwe(){return this.mb.pa("CoAuthForProtectedFilesEnabled")&&this.mb.pa("SupportsOfficeClientCoauthoring")&&this.mb.pa("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&
!!this.r9d&&this.t7a}Jna(Lb,Ic,Ob,Kc=null){this.ah.value.Rbj(Ob);let Ac=32,Yc=!1,td=!0;const $d=2===Ob||8===Ob||16===Ob,be=Lb===this.jf.AppliedPolicyId;if(this.RHc&&this.RHc(Lb,$d))b.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",Ob),this.Ye.updateCommandUI();else if(Ic&&B.OYc in Ic&&this.ah.value.bAj(Ic[B.OYc]),Lb)if(this.ah.value.pmf()||this.Rwe()&&this.fOc)b.ULS.sendTraceTag(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",
Ob),this.Ye.updateCommandUI(),$d&&this.C0b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityQuickApplicationErrorMessage);else if(this.mb.pa("HasDocumentEditRights"))if(this.ah.value.A1g(Lb))if(!this.nNa()&&this.Gs[Lb]&&this.Gs[Lb].HasUserDefinedPermissions&&!be)b.ULS.sendTraceTag(540608323,306,50,"UDP label cannot be applied during UDP in WAC Phase 1. ApplyLabelFlag: {0}",Ob),1!==Ob&&4!==Ob&&this.CQg();else if($d&&this.jf.MandatoryLabelingEnforced&&be)b.ULS.sendTraceTag(570972054,
306,50,"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",Ob),this.C0b(CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogTitle,CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogDescriptionText);else{if($d&&this.mb.pa("WacLabelingJustificationDialogIsEnabled")&&this.jf.RequiredDowngradeJustification&&(be||this.Gs[Lb].RequiredDowngradeJustification)&&(this.nNa()?!this.rbe&&!Kc:!this.IWa))return b.ULS.sendTraceTag(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",
Ob),this.SUd(Lb),Ac;if(this.nNa()&&this.Gs[Lb].HasUserDefinedPermissions&&!be)return b.ULS.sendTraceTag(523019968,306,50,"UDP Label is selected. ApplyLabelFlag: {0}",Ob),this.pVd(Lb,Kc),Ac;if(this.Rwe()&&!this.r9d())this.FHc<this.ttg?(b.ULS.sendTraceTag(577356770,306,50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this.FHc,Ob),this.fOc=!0,this.FHc++,da.Task.delay(this.utg).continueWith(()=>{this.fOc=!1;this.Jna(Lb,Ic,Ob)})):(b.ULS.sendTraceTag(577356771,
306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",Ob),Yc=1!==Ob,td=!1,Ac=8);else{if(this.gsi(Lb)&&(b.ULS.sendTraceTag(553911752,306,15,"Policy label cannot be set because the selected label is a parent label. ApplyLabelFlag: {0}",Ob),1===Ob||8===Ob||4===Ob))return Ac;b.ULS.sendTraceTag(570972056,306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",Ob);this.setPolicyLabel(be?"":Lb,this.nNa()?Kc:this.IWa,"",Ob);return Ac}}else b.ULS.sendTraceTag(42796169,
306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",Ob),this.Ye.updateCommandUI(),$d&&this.C0b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityCoauthApplicationErrorMessage);else b.ULS.sendTraceTag(558892739,306,50,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",Ob),this.Ye.updateCommandUI(),$d&&this.C0b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityNoEditRightsErrorMessage);
else b.ULS.sendTraceTag(42796167,306,15,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",Ob),this.Ye.updateCommandUI(),Yc=$d,td=!1,Ac=8;this.ah.value.iJd(0,Ob,Yc,td);return Ac}JZa(Lb,Ic,Ob=null,Kc=!1){D.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",0,"wordclpfc",null);this.mb.pa("SupportsOfficeClientCoauthoring")&&this.mb.pa("CoAuthForProtectedFilesIsEnabled")?(this.jkb=!1,(this.jf=this.ah.value.Zm)&&!this.jf.AppliedPolicyId?this.jkb=!0:this.jf&&
this.jf.PolicyLabelAssignmentMethod&&(this.jkb=ba.e(this.jf.PolicyLabelAssignmentMethod)===ba.e("standard"))):this.jkb=Kc;Lb=xa.lh(Lb)?null:this.Gs[Lb];(Ic=xa.lh(Ic)?null:this.Gs[Ic])?this.Tfa=new l(Ic,!0,Ob):(this.ah.value.sda(29),this.bfa=null);Lb?this.xpa=new l(Lb,!1):this.yVa=null;this.kId(null,null);return 32}CSg(Lb){""!==this.jf.AppliedPolicyId?this.ah.value.iJd(14,16,!0):this.Jna(Lb,null,16)}p5f(){this.Gs={};if(this.jf=this.ah.value.Zm)for(const Lb of this.jf.SensitivityLabels)this.Gs[Lb.Id]=
Lb}gsi(Lb){if(this.K1&&Lb in this.K1){Lb=this.K1[Lb];for(let Ic of Lb)if((Lb=this.Gs[Ic])&&Lb.Enabled)return!0}return!1}W5f(){this.K1={};if(this.jf=this.ah.value.Zm){for(const Lb of this.jf.SensitivityLabels)Lb.ParentId||(this.K1[Lb.Id]=new d.a);for(const Lb of this.jf.SensitivityLabels){if(this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RemoveDisabledLabelsFromChildLabel",!1)){if(!(Lb.ParentId&&Lb.ParentId in this.K1&&Lb.Enabled))continue}else if(!(Lb.ParentId&&Lb.ParentId in this.K1))continue;
this.K1[Lb.ParentId].add(Lb.Id)}}}iQf(){if(this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)){this.jf=this.ah.value.Zm;const Lb=this.jAb&&this.isReactRibbonEnabled()&&this.ah.value.Zga();xa.MQa(Lb)}else this.jAb&&this.isReactRibbonEnabled()?(this.jf=this.ah.value.Zm,this.ah.value.Zga()?(xa.MQa(!0),appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!1))):xa.MQa(!1)):xa.MQa(!1)}rfj(Lb){this.RHc=Lb}jgj(Lb){this.bOc=Lb}A4f(){if(this.mb.pa("WacApplyDefaultPolicyLabelIsEnabled"))if(this.Hhc())this.NNc=
!0;else if(!this.LJc)if(this.LJc=!0,this.jf=this.ah.value.Zm,this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultLabelForSPODocLibEnabled",!1)){if(this.jf&&this.jf.DefaultLabelId)if(!this.jf.AppliedPolicyId)b.ULS.sendTraceTag(509732190,306,50,"Default labeling triggered. DefaultLabelType: {0}",this.jf.DefaultLabelType),this.Jna(this.jf.DefaultLabelId,null,1);else if(h.a.Oi().equals(this.jf.DefaultLabelType,"documentLibraryDefault")){const Lb=this.Gs[this.jf.AppliedPolicyId],Ic=this.Gs[this.jf.DefaultLabelId];
this.jf.AppliedPolicyId!==this.jf.DefaultLabelId&&h.a.Oi().equals(this.jf.PolicyLabelAssignmentMethod,"standard")&&Lb.Order<Ic.Order&&(b.ULS.sendTraceTag(509732189,306,50,"Default labeling triggered. DefaultLabelType: {0}",this.jf.DefaultLabelType),this.Jna(this.jf.DefaultLabelId,null,1))}}else this.jf&&this.jf.DefaultLabelId&&!this.jf.AppliedPolicyId&&(b.ULS.sendTraceTag(593774210,306,50,"Default labeling triggered. DefaultLabel: {0}",this.jf.DefaultLabelId),this.Jna(this.jf.DefaultLabelId,null,
1))}kId(){if(!this.ah.value.pmf()){var Lb=this.Gs[this.jf.AppliedPolicyId];this.jkb&&this.xpa&&this.yVa!==this.xpa.id&&(!Lb||Lb.Order<this.xpa.sensitivityLabel.Order)&&(Lb=this.Jna(this.xpa.id,{},4),32!==Lb?b.ULS.sendTraceTag(50868813,306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+Lb):(this.yVa=this.xpa.id,this.bfa&&(Lb=this.Gs[this.bfa])&&Lb.Order<=this.xpa.sensitivityLabel.Order&&(this.ah.value.sda(29),this.bfa=null)));Lb=this.Gs[this.ah.value.Zm.AppliedPolicyId];
if(this.Tfa&&this.bfa!==this.Tfa.id&&(!Lb||Lb.Order<this.Tfa.sensitivityLabel.Order)){const Ic=this.Tfa.id;this.ah.value.sda(29);this.ah.value.h_b(29,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelRecommendationMessage,this.$hd(this.Tfa.sensitivityLabel))+" "+this.Tfa.Udj,CommonUIStrings.l_PolicyLabelRecommendationButton,()=>{this.Jna(Ic,{},8)});this.bfa=this.Tfa.id}this.Tfa=this.xpa=null}}setPolicyLabel(Lb,Ic,Ob,Kc=2){this.nNa()?Ic&&(this.rbe=!0):this.IWa=Ic;
this.ah.value.setPolicyLabel(Lb);this.Ye.updateCommandUI();Ob=new k(Kc,this.$hd(this.Gs[Lb]));this.ah.value.cSd(Lb,this.nNa()?Ic:this.IWa,Ob)}o$g(Lb,Ic,Ob,Kc){1===Lb&&this.setPolicyLabel(Ic,Kc,Ob)}n$g(Lb,Ic,Ob){1===Lb?this.nNa()?this.Jna(Ic,null,2,Ob):this.setPolicyLabel(Ic===this.jf.AppliedPolicyId?"":Ic,Ob,""):this.Ye.updateCommandUI()}SUd(Lb){(new v(Lb,Object(e.a)(this,this.n$g,"continueToSetPolicyLabelFromJustificationDialog"))).SUd()}pVd(Lb,Ic){(new H(Lb,Ic,Object(e.a)(this,this.o$g,"continueToSetPolicyLabelFromUDPDialog"))).pVd()}C0b(Lb=
"",Ic=""){const Ob=new V.StandardDialog;Ob.pt=n.AFrameworkApplication.pAb;Ob.Ob=0;Ob.tc(1,CommonUIStrings.l_DialogClose);Ob.YR(Lb,Ic,null)}zWg(Lb){1===Lb&&this.ah.value.Wbj()}CQg(){const Lb=new V.StandardDialog;Lb.pt=n.AFrameworkApplication.pAb;Lb.Ob=1;Lb.tc(1,CommonUIStrings.l_OICDownLoadACopyDialogOpenButton);Lb.tc(0,CommonUIStrings.l_DialogClose);Lb.YR(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityBlockUDPSetLabelMessage,Object(e.a)(this,this.zWg,"blockUDPSetLabelHandler"))}isReactRibbonEnabled(){return!!this.Ye&&
!!this.Ye.Qa&&this.Ye.Qa.Di}njc(){return this.Ye&&this.Ye.Qa?this.Ye.Qa.njc:!1}oNe(){return 32}tbb(Lb,Ic,Ob,Kc,Ac){if(1===Ob)return 32;this.jf=this.ah.value.Zm;if(!this.jf||!Ac)return 32;Ac[B.value]="";Ac[B.gi]="";Ac[B.alt]=null;Ac[B.Mdf]=null;Ac[B.W5a]=null;Ac[B.customTooltip]="";Ac[B.visible]=!1;Ac[B.iconColor]="";Ob=Ic=Lb=Ac[B.icon]="";if(!this.jf.AreLabelsAvailable){if(!this.vOc)return 32;Lb=this.vOc;Ob=B.EZd;this.uOc&&(Ic=this.uOc)}else if(this.jf.AppliedPolicyId){Kc=null;for(const Yc of this.jf.SensitivityLabels)if(Yc.Id.toLowerCase()===
this.jf.AppliedPolicyId.toLowerCase()){Kc=Yc;break}Kc&&(Lb=this.$hd(Kc),Ic=Kc.Tooltip,this.xRc=n.AFrameworkApplication.protectedFile=Kc.IsEndpointProtectionEnabled,Ob=this.u1e(Kc))}this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(Lb?(Ac[B.value]=Lb,Ac[B.gi]=Lb,Ac[B.customTooltip]=Ic,this.x5f(Ob,this.xRc,Ac)):this.mb.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.ClpUseOutlineImageForNoLabel")?(Ac[B.iconColor]=B.EZd,this.jf.MandatoryLabelingEnforced?
(Ac[B.value]=Ac[B.gi]=HeaderStrings.SelectASensitivityLabel,Ac[B.icon]=B.idj):(Ac[B.value]=Ac[B.gi]=HeaderStrings.NoSensitivityLabel,Ac[B.icon]=B.ldj)):(Ac[B.iconColor]="#000000",this.jf.MandatoryLabelingEnforced?(Ac[B.value]=Ac[B.gi]=HeaderStrings.SelectASensitivityLabel,Ac[B.icon]="MipTagErrorDynamicColor_20"):(Ac[B.value]=Ac[B.gi]=HeaderStrings.NoSensitivityLabel,Ac[B.icon]="MipTagQuestionDynamicColor_20")),Ac[B.visible]=!0):Lb&&(Ac[B.value]=Lb,Ac[B.gi]=Lb,this.njc()?Ac[B.customTooltip]=Ic:Ac[B.alt]=
Ic,this.x5f(Ob,this.xRc,Ac),Ac[B.visible]=!0);return 32}$hd(Lb){return Lb?this.Gs?Lb.ParentId&&this.Gs[Lb.ParentId]?this.Gs[Lb.ParentId].DisplayName+"\\"+Lb.DisplayName:Lb.DisplayName:(b.ULS.sendTraceTag(4282E4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),Lb.DisplayName):""}x5f(Lb,Ic,Ob){this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(Ob[B.icon]=this.l8e(Ic),Ob[B.iconColor]=this.m8e(Lb)):this.njc()?Ob[B.icon]=Ic?B.EOj:B.GOj:
(Ob[B.Mdf]=n.AFrameworkApplication.UA,Ob[B.W5a]=Ic?z.getImageClass(B.FOj):z.getImageClass(B.HOj))}seh(Lb){const Ic=this.MP("LearnMoreSection",!0);Lb=Object.assign(new U.a,{Id:"SensitivityLearnMore",ExternalId:"SensitivityLearnMore",MenuItemId:Lb,LabelText:CommonUIStrings.l_LearnMore,Command:"1959943459",Image16by16:n.AFrameworkApplication.UA,Image16by16Class:z.getImageClass(B.zzi),Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,KeyTip:"L"});Array.add(Ic.ControlList,Lb);return Ic}rJe(Lb,Ic,Ob=!1){let Kc;
Kc="Toggle_"+Lb.Id;Kc="Sensitivity_"+Kc;const Ac=Lb.DisplayName,Yc=Lb.Tooltip;var td=Lb.Id===this.jf.AppliedPolicyId,$d=Ob?u.a.We(Kc):Kc;this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(td=this.u1e(Lb),Ic=Object.assign(new aa.a,{Id:$d,ExternalId:$d,LabelText:Ob?u.a.We(Ac):Ac,Command:"2935633379",MenuItemId:$d,QueryCommand:"991261903",Visible:!0,Alt:Ob?u.a.We(Yc):Yc,AriaLabel:P.a.n1b,IconColor:this.m8e(td),KeyTip:Ic}),Ic.ExternalImageId=this.l8e(Lb.IsEndpointProtectionEnabled)):
($d=Object.assign(new I.a,{Id:$d,ExternalId:$d,LabelText:Ob?u.a.We(Ac):Ac,Command:"2935633379",MenuItemId:$d,QueryCommand:"991261903",CheckedImage:n.AFrameworkApplication.UA,Visible:!0,Alt:Ob?u.a.We(Yc):Yc,IsChecked:td,AriaLabel:P.a.n1b,KeyTip:Ic}),this.isReactRibbonEnabled()?($d.CheckedImageClass=z.getImageClass(B.tJd),$d.ExternalImageId=B.tJd):$d.CheckedImageClass=z.getImageClass(B.irb),Ic=$d);$d=Kc;this.Ukb[$d]=Lb.Id;this.Vge[Lb.Id]=$d;return Ic}MP(Lb,Ic=!1){return Object.assign(new M.a,{Title:"",
Id:Lb,DisplayMode:B.menu,ShowMenuSectionSeparator:Ic,ControlsId:"Ctrl_"+Lb,ControlList:[]})}rhh(Lb,Ic,Ob,Kc){Lb=xa.iXf()?this.MP(Lb+"Sub"):this.MP(Ic+"Sub");Ic=1;for(let Ac of Ob)(Ob=this.Gs[Ac])&&Ob.Enabled&&(Array.add(Lb.ControlList,this.rJe(Ob,Ic.toString(),Kc)),Ic++);return Lb}Ec(Lb=!1){const Ic=this.MP("SensitivitySection");let Ob=1;const Kc=this.K1;for(let Yc in Kc){const td=Kc[Yc],$d=this.Gs[Yc];if($d&&$d.Enabled){if(td.count){const be="Sensitivity_"+$d.Name;var Ac=Lb?u.a.We(be):be;Ac=xa.iXf()?
"Label"+this.fvg++:Ac;const ke=Object.assign(new G.a,{Id:Ac,ExternalId:Ac,LabelText:Lb?u.a.We($d.DisplayName):$d.DisplayName,Command:"798637440",QueryCommand:"2875864574",Menu:Object.assign(new N.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:P.a.n1b,KeyTip:Ob.toString(),Alt:Lb?u.a.We($d.Tooltip):$d.Tooltip});this.isReactRibbonEnabled()?ke.ExternalImageId=B.tJd:(ke.Image16by16=n.AFrameworkApplication.UA,ke.Image16by16Class=
z.getImageClass(B.irb));Array.add(ke.Menu.MenuSectionList,this.rhh(Ac,be,td,Lb));Array.add(Ic.ControlList,ke);this.Ukb[ke.Id]=$d.Id;this.Vge[$d.Id]=ke.Id}else Array.add(Ic.ControlList,this.rJe($d,Ob.toString(),Lb));Ob++}}return Ic}vnb(Lb){return!!this.Ma.Y3(Lb)&&!!this.Ma.Y3(Lb).flags&&!!this.Ma.Y3(Lb).flags.length}W0i(Lb,Ic){Ic.onSuccess&&this.Gs&&(Lb=this.Gs[this.ah.value.Zm.AppliedPolicyId])&&(this.bfa&&(Ic=this.Gs[this.bfa])&&Ic.Order<=Lb.Order&&(this.ah.value.sda(29),this.bfa=null),this.yVa&&
this.yVa!==Lb.Id&&(this.ah.value.sda(28),this.yVa=null))}l8e(Lb){return Lb?B.kdj:B.jdj}m8e(Lb){return Lb?Lb:B.EZd}u1e(Lb){if(Lb.Color||!Lb.ParentId)return Lb.Color;const Ic=this.Gs[Lb.ParentId];return Ic?Ic.Color:Lb.Color}KXj(Lb){switch(Lb){case 2:case 14:case 15:return 1;case 21:return 2;default:return 0}}static iXf(){if(null!=xa.gXb)return xa.gXb;n.AFrameworkApplication.ula("ce2ai523-t;6f627846-c");xa.gXb=n.AFrameworkApplication.fa?n.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.WordOnline.RenameCLPControlIds",
!1):!1;return xa.gXb}static MQa(Lb){n.AFrameworkApplication.fa&&n.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(Lb?(Y.a.wBd("ribbon","sensitivity"),Y.a.qBd("ribbon","sensitivity")):Y.a.vBd("ribbon","sensitivity"));n.AFrameworkApplication.fa&&n.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&L.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",
!Lb))}static lh(Lb){return Lb&&Lb.length?!1:!0}}xa.gXb=null;Object(c.a)(xa,"PolicyActor",null,[751]);var ia=a(648),Ma=a(98),Ta;(function(Lb){Lb[Lb.unknown=0]="unknown";Lb[Lb.boot=1]="boot";Lb[Lb.refresh=2]="refresh";Lb[Lb.selfSetPolicyLabel=3]="selfSetPolicyLabel"})(Ta||(Ta={}));Object(c.b)("GetPolicyLabelsReason",Ta);class Da extends Sys.EventArgs{constructor(Lb,Ic,Ob,Kc,Ac,Yc){super();this.tqb=Lb;this.title=Ic;this.message=Ob;this.buttonText=Kc;this.g$=Ac;this.MBb=Yc}}Object(c.a)(Da,"AddAutoPolicyBusinessBarEntryEventArgs",
Sys.EventArgs,[]);class fa extends Sys.EventArgs{constructor(Lb,Ic,Ob,Kc,Ac){super();this.tqb=Lb;this.title=Ic;this.message=Ob;this.buttonText=Kc;this.g$=Ac}}Object(c.a)(fa,"AddMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var ua;(function(Lb){Lb[Lb.none=0]="none";Lb[Lb.reasonDefaultLabel=1]="reasonDefaultLabel";Lb[Lb.reasonManual=2]="reasonManual";Lb[Lb.reasonAutomatic=4]="reasonAutomatic";Lb[Lb.reasonRecommended=8]="reasonRecommended";Lb[Lb.reasonMandatory=16]="reasonMandatory"})(ua||
(ua={}));Object(c.b)("ApplyLabelFlags",ua);class Fa extends Sys.EventArgs{constructor(Lb,Ic,Ob){super();this.PDe=Lb;this.ODe=Ic;this.existingLabelPriority=Ob}}Object(c.a)(Fa,"AutoCLPSecurityNodesEventArgs",Sys.EventArgs,[]);class ca extends Sys.EventArgs{constructor(){super()}}Object(c.a)(ca,"GetPolicyLabelEventArgs",Sys.EventArgs,[]);class ka extends Sys.EventArgs{constructor(){super()}}Object(c.a)(ka,"GetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class Ca{constructor(){this.AreLabelsAvailable=
!1;this.AppliedPolicyId=null;this.MandatoryLabelingEnforced=this.RequiredDowngradeJustification=!1;this.SensitivityLabels=this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.CustomUrl=this.DefaultLabelType=this.DefaultLabelId=null;this.AreLabelsAvailable=!1;this.AppliedPolicyId="";this.RequiredDowngradeJustification=!1;this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.DefaultLabelType=this.DefaultLabelId="";this.SensitivityLabels=[];this.MandatoryLabelingEnforced=!1;
this.CustomUrl=""}}Object(c.a)(Ca,"GetPolicyLabelsData",null,[]);class fb extends Sys.EventArgs{constructor(Lb=!1){super();this.onSuccess=Lb}}Object(c.a)(fb,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);class yb extends Sys.EventArgs{constructor(Lb,Ic){super();this.Yxa=Lb;this.Lte=Ic}}Object(c.a)(yb,"MandatoryLabellingAppHandlerEventArgs",Sys.EventArgs,[]);class mb extends Sys.EventArgs{constructor(Lb,Ic,Ob,Kc){super();this.title=Lb;this.bsc=Ic;this.buttonText=Ob;this.nAf=Kc}}Object(c.a)(mb,"PolicyTipEventArgs",
Sys.EventArgs,[]);class nb extends Sys.EventArgs{constructor(Lb,Ic){super();this.tqb=Lb;this.MBb=Ic}}Object(c.a)(nb,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class X extends Sys.EventArgs{constructor(){super()}}Object(c.a)(X,"RemoveMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);class R extends Sys.EventArgs{constructor(Lb,Ic){super();this.asc=Lb;this.YL=Ic}}Object(c.a)(R,"SetPolicyLabelEventArgs",Sys.EventArgs,[]);class wa extends Sys.EventArgs{constructor(Lb,Ic,
Ob,Kc=null,Ac=null,Yc=null,td=null){super();this.errorType=Lb;this.h$f=Ob;this.title=Kc;this.message=Ac;this.buttonText=Yc;this.g$=td}}Object(c.a)(wa,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class na extends Sys.EventArgs{constructor(){super()}}Object(c.a)(na,"SetPolicyLabelTriggeredEventArgs",Sys.EventArgs,[]);class Ba extends Sys.EventArgs{constructor(Lb){super();this.eGj=Lb}}Object(c.a)(Ba,"UDPLabelingAppHandlerEventArgs",Sys.EventArgs,[]);var Ra=a(109),qa=a(104),La=a(39),Yb=a(79),mc=
a(40);class Zb{constructor(Lb,Ic,Ob,Kc,Ac,Yc,td,$d=null,be=null,ke=!1,Pe=null,Dd=null,ge=null,ne=null,ce=!1,we=null,ve=null,Re=null,rf=null,We=null,Ye=null){this.url=Lb;this.j5j=Ic;this.body=Ob;this.headers=Kc;this.neb=Ac;this.priority=Yc;this.state=td;this.tng=$d;this.SN=be;this.dN=ke;this.Daj=Pe;this.nwj=Dd;this.name=ge;this.xHb=ne;this.Kdd=ce;this.pLf=we;this.A$b=ve;this.Ngc=Re;this.Vcb=rf;this.tdi=We;this.responseType=Ye}}Object(c.a)(Zb,"ClientRequest",null,[]);var qb=a(465),Ha=a(268);class Ya{static Fyj(Lb,
Ic){if(!Lb||!Ic||Lb.count!==Ic.count)return!1;for(let Ob of Lb)if(!Ic.contains(Ob))return!1;return!0}static toArray(Lb){if(!Lb)return null;const Ic=Array(Lb.count);let Ob=0;for(let Kc of Lb)Ic[Ob]=Kc,Ob++;return Ic}}Object(c.a)(Ya,"HashSetUtils",null,[]);var Gb=a(281),Ja=a(194);class Na{constructor(Lb,Ic,Ob,Kc=0,Ac=null){this.IJc=this.G8d=null;this.tra=this.Bjb=this.Djb=0;this.Z7="";this.dFa=this.yHc=this.Rae=this.tpa=this.fPc=null;this.sbe=!1;this.KCa=null;this.gMc=0;this.GWb=this.fFa=this.PDa=this.FWb=
null;this.Za=new Ma.a;this.DMb=this.Hxb=this.gx=null;this.WMc=!1;this.iDb=null;this.mb=Lb;this.ph=Ic;this.rh=Ob;this.HVb=Kc;this.Zm=new Ca;this.Uge=this.mb.Wa("PolicyHandlerEndpointName")||"PolicyHandler.ashx";this.MO=Ac;this.jAb=Lb.pa("WacApplyManualPolicyLabelIsEnabled");this.shc=Lb.pa("CoAuthForProtectedFilesIsEnabled");this.supportsOfficeClientCoauthoring=Lb.pa("SupportsOfficeClientCoauthoring");this.tui=!1;this.RAj=3E4;this.he=qa.a.instance;Lb.pa("SupportsPolicies")&&E.a("MipSupportsPolicies");
this.shc&&this.supportsOfficeClientCoauthoring&&E.a("MipSupportsOfficeClientCoauthoring")}get lpd(){return this.WMc}yre(Lb){this.Za.addHandler("PolicyTipEvent",Lb)}R_b(Lb){this.Za.addHandler("LabelInfoUpdateEvent",Lb)}xkj(Lb){this.Za.removeHandler("LabelInfoUpdateEvent",Lb)}Lre(Lb){this.Za.addHandler("SetPolicyLabelEventKey",Lb)}Jlj(Lb){this.Za.removeHandler("SetPolicyLabelEventKey",Lb)}SXc(Lb){this.Za.addHandler("SetPolicyLabelFailureEventKey",Lb)}Ilj(Lb){this.Za.removeHandler("SetPolicyLabelFailureEventKey",
Lb)}YMg(Lb){this.Za.addHandler("GetPolicyLabelEventKey",Lb)}XMg(Lb){this.Za.addHandler("GetPolicyLabelFailureEventKey",Lb)}VMg(Lb){this.Za.addHandler("GetAutoPolicyLabelEventKey",Lb);this.lpd&&(b.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),this.XId(new ca(0)))}ckj(Lb){this.Za.removeHandler("GetAutoPolicyLabelEventKey",Lb)}uMg(Lb){this.Za.addHandler("CreateAutoCLPSecurityNodesEventKey",Lb)}Ijj(Lb){this.Za.removeHandler("CreateAutoCLPSecurityNodesEventKey",
Lb)}lPg(Lb){this.Za.addHandler("UpdateAutoCLPLabelPriorityNodeEventKey",Lb)}Wlj(Lb){this.Za.removeHandler("UpdateAutoCLPLabelPriorityNodeEventKey",Lb)}mPg(Lb){this.Za.addHandler("UpdateAutoCLPSITNodesEventKey",Lb)}Xlj(Lb){this.Za.removeHandler("UpdateAutoCLPSITNodesEventKey",Lb)}eqe(Lb){this.Za.addHandler("AddAutoPolicyBusinessBarEntryEventKey",Lb)}Zij(Lb){this.Za.removeHandler("AddAutoPolicyBusinessBarEntryEventKey",Lb)}Are(Lb){this.Za.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",Lb)}rlj(Lb){this.Za.removeHandler("RemoveAutoPolicyBusinessBarEntryEventKey",
Lb)}fqe(Lb){this.Za.addHandler("AddMandatoryLabellingBusinessBarEntryEventKey",Lb)}ajj(Lb){this.Za.removeHandler("AddMandatoryLabellingBusinessBarEntryEventKey",Lb)}Bre(Lb){this.Za.addHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",Lb)}slj(Lb){this.Za.removeHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",Lb)}HNg(Lb){this.Za.addHandler("MandatoryLabellingAppHandlerEventKey",Lb)}Ikj(Lb){this.Za.removeHandler("MandatoryLabellingAppHandlerEventKey",Lb)}iPg(Lb){this.Za.addHandler("UDPLabelingAppHandlerEventKey",
Lb)}Ulj(Lb){this.Za.removeHandler("UDPLabelingAppHandlerEventKey",Lb)}get wqd(){if(!this.G8d)return!1;for(const Lb of this.G8d.n9j())if(!Lb.Capabilities||!Lb.Capabilities.SupportsClientIsMipTrusted)return!1;return!0}get Lti(){return!!this.gx}V3g(){return this.Rae?this.Rae():!1}nfj(Lb){this.yHc=Lb}jw(){return(new Date).getTime()}egd(){this.rh&&(this.FWb=this.rh.Gc("WebServiceCall","Call Get Policy Endpoint On Server"));var Lb=Gb.a.Wha(1,1);this.mb.pa("SendHostAttributionInfoForPolicyLabelEnabled")?
(Lb=new Zb(this.P4a("datalosspolicy"),1,null,null,!0,2,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Lb),this.ph.send(Lb).BKd(Object(e.a)(this,this.LBf,"onDataLossPolicySuccessCallback"),Object(e.a)(this,this.KBf,"onDataLossPolicyFailureCallback"))):this.ph.Jm(this.P4a("datalosspolicy"),1,null,null,!0,2,Object(e.a)(this,this.LBf,"onDataLossPolicySuccessCallback"),Object(e.a)(this,this.KBf,"onDataLossPolicyFailureCallback"),null);this.Djb++;b.ULS.sendTraceTag(25565151,
306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",this.Uge,this.Djb)}Vej(){this.dgd(this.Z7,2,this.tpa)}dgd(Lb,Ic=0,Ob=null,Kc=!1){D.Health.instance.recordKpiUsage("MipGetPolicyLabel",0,"officewebclp",this.tgd(void 0,Ic));this.Hxb=this.jw();const Ac=this.Y5c(Ic);this.hcc(Lb,Ac,Ob,Kc,Ic);this.XMd(!0)}LBf(Lb){this.ZMf();let Ic="";({data:Ic}=this.a_d(Lb)).returnValue&&(b.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),
this.Djb=0,this.rh&&(this.GWb=this.rh.Gc("Task","Parse and Handle Get Policy Response")),this.$3i(Ic),this.GWb&&(this.GWb.stop(),this.GWb=null))}KBf(Lb){this.ZMf();this.Djb<=this.HVb?this.egd():(b.ULS.sendTraceTag(25565154,306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",Lb?Lb.data?Lb.data.ZQa:null:null),this.Djb=0)}pmf(){return 0<this.tra}setPolicyLabel(Lb){this.Zm.AppliedPolicyId=Lb}cSd(Lb,Ic,Ob=null){const Kc=this.Wdh(Ob);this.QAj(Lb,Ic,Kc,Ob)}AIf(Lb){this.fFa&&
(this.fFa.stop(),this.fFa=null);let Ic,Ob;({y2f:Ic,c6f:Ob}=this.r7e(Lb));const Kc=Lb.data.state,Ac=Kc?Kc.YL:2;let Yc="";({data:Yc}=this.a_d(Lb)).returnValue?(b.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",Ac),this.tra=0,this.s4i(Yc,Ic,Ob,Kc)):this.EOd(Ac)}Rbj(Lb){D.Health.instance.recordKpiUsage("MipSetPolicyLabel",0,"officewebclp",this.tgd(Lb));this.DMb=this.jw();b.ULS.sendTraceTag(575947405,306,50,"Raising set policy label triggered event.");
this.Za.raiseEvent("SetPolicyLabelTriggeredEventKey",new na(Lb))}ZLi(){this.shc&&this.supportsOfficeClientCoauthoring&&this.Lti&&this.gx.Qda(12,null,!0)}zIf(Lb){this.fFa&&(this.fFa.stop(),this.fFa=null);let Ic;({y2f:Ob,c6f:Ic}=this.r7e(Lb));if(this.tra<=this.HVb)this.cSd(Ob,Ic);else{var Ob=(Ob=Lb.data.state)?Ob.YL:2;b.ULS.sendTraceTag(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",Lb?Lb.data?Lb.data.ZQa:null:null,Ob);this.iDb="WACServerConnectionFailed";
this.tra=0;this.EOd(Ob)}}yti(Lb){if(Lb&&("LabelNotSupported"===Lb||"LabelErrorRetryLater"===Lb||"CoherencyFailure"===Lb||"LabelIdNotFound"===Lb||"LabelDisabled"===Lb))return b.ULS.sendTraceTag(539103556,306,50,"LabelError is retriable: {0}",Lb),!0;b.ULS.sendTraceTag(539103557,306,50,"LabelError is not retriable: {0}",Lb);return!1}A1g(Lb){if(!Lb)return!1;let Ic=null,Ob=null;for(const Kc of this.Zm.SensitivityLabels)Kc.Id===Lb&&(Ic=Kc),Kc.Id===this.Z7&&(Ob=Kc);if(!Ic)return!1;if(this.shc&&this.supportsOfficeClientCoauthoring){if(this.yHc&&
this.yHc()||this.wqd)return!0}else if(n.AFrameworkApplication.Ty&&n.AFrameworkApplication.Ty.pwb||this.tpa&&this.tpa())return!0;return Ic.IsEndpointProtectionEnabled===(!!Ob&&Ob.IsEndpointProtectionEnabled)}h_b(Lb,Ic,Ob,Kc,Ac){28===Lb?this.wQf(new Da(Lb,Ic,Ob,Kc,Ac,!1)):this.wQf(new Da(Lb,Ic,Ob,Kc,Ac,!0))}sda(Lb){28===Lb?this.aRf(new nb(Lb,!1)):this.aRf(new nb(Lb,!0))}Taj(Lb,Ic,Ob){b.ULS.sendTraceTag(545280777,306,50,"Raising a CreateAutoCLPSecurityNodes event.");this.Za.raiseEvent("CreateAutoCLPSecurityNodesEventKey",
new Fa(Lb,Ic,Ob))}Xbj(Lb){b.ULS.sendTraceTag(545280778,306,50,"Raising a UpdateAutoCLPLabelPriorityNode event.");this.Za.raiseEvent("UpdateAutoCLPLabelPriorityNodeEventKey",new Fa(null,null,Lb))}Ybj(Lb,Ic){b.ULS.sendTraceTag(545280779,306,50,"Raising a UpdateAutoCLPSITNodes event.");this.Za.raiseEvent("UpdateAutoCLPSITNodesEventKey",new Fa(Lb,Ic,null))}OQf(Lb,Ic){b.ULS.sendTraceTag(572650527,306,50,"Raising a mandatory labelling"+(1===Ic?"Reading":"Edit")+" switch event.");this.Za.raiseEvent("MandatoryLabellingAppHandlerEventKey",
new yb(Lb,Ic))}LWc(Lb,Ic,Ob,Kc,Ac){37===Lb&&this.Iaj(new fa(37,Ic,Ob,Kc,Ac))}wLd(){this.Kbj(new X)}Wbj(){b.ULS.sendTraceTag(540608322,306,50,"Raising a UDP labeling event.");this.Za.raiseEvent("UDPLabelingAppHandlerEventKey",new Ba(!0))}Zga(Lb=!1){const Ic=!!this.Zm&&this.Zm.AreLabelsAvailable&&!!this.Zm.SensitivityLabels&&0<this.Zm.SensitivityLabels.length&&Ha.a.any(this.Zm.SensitivityLabels,Ob=>!!Ob&&Ob.Enabled);Ic||Lb||xa.MQa(!1);return Ic}LDf(Lb){this.PDa&&(this.PDa.stop(),this.PDa=null);var Ic=
"";this.XMd(!1);({data:Ic}=this.a_d(Lb)).returnValue?(b.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),this.Bjb=0,Ic=this.i4i(Ic),Lb=this.b6e(Lb.data),D.Health.instance.recordKpiSuccess("MipGetPolicyLabel",this.ubc(void 0,Lb,this.Hxb)),this.Hxb=null,Lb=new ca(Lb),this.gbj(Lb),this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?Ic&&this.LEj()?this.lpd?this.NZj():(this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",
!1)||this.vsb(),this.XId(Lb),this.WMc=!0):Ic||this.jtc():!this.lpd&&Ic&&this.mb.pa("WacApplyManualPolicyLabelIsEnabled")&&this.hve()?(this.XId(Lb),this.WMc=!0):Ic||this.jtc()):this.jtc()}LEj(){if(!this.mb.pa("WacApplyManualPolicyLabelIsEnabled"))return b.ULS.sendTraceTag(539877667,306,50,"ShouldAutoClassificationRun returned false - Manual Labeling is not enabled"),!1;if(!this.hve())return!1;if(""===this.Z7)return b.ULS.sendTraceTag(539877696,306,50,"ShouldAutoClassificationRun returned true - document is not labeled"),
!0;if(this.KCa===this.gMc)return b.ULS.sendTraceTag(539877697,306,50,"ShouldAutoClassificationRun returned false - Applied label already has the highest priority"),!1;b.ULS.sendTraceTag(539877698,306,50,"ShouldAutoClassificationRun returned true - document is labeled but not with the highest priority label");return!0}vsb(){this.Uig();b.ULS.sendTraceTag(545104324,306,50,"Creating AutoCLP Security nodes. HasSITs: {0}, LabelPriority: {1}",0<this.dFa.count,this.KCa);const Lb=Ya.toArray(this.dFa);this.Taj(Lb,
Lb,this.KCa)}NZj(){var Lb=this.dFa;this.Uig();Ya.Fyj(Lb,this.dFa)||(b.ULS.sendTraceTag(545104325,306,50,"Updating AutoCLP SIT nodes. HasSITs: {0}",0<this.dFa.count),Lb=Ya.toArray(this.dFa),this.Ybj(Lb,Lb));this.sbe&&(b.ULS.sendTraceTag(545104326,306,50,"Updating AutoCLP Label Priority node. LabelPriority: {0}",this.KCa),this.Xbj(this.KCa))}Uig(){const Lb=new ia.a(h.a.Oi());for(const Ic of this.Zm.SensitivityLabels)if(Ic&&Ic.AutoLabelingSensitiveTypeIds&&0<Ic.AutoLabelingSensitiveTypeIds.length)for(const Ob of Ic.AutoLabelingSensitiveTypeIds)Ob&&
Lb.add(Ob);this.dFa=Lb}KDf(Lb){const Ic=this.b6e(Lb.data);D.Health.instance.recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",!1,!1,this.ubc(void 0,Ic,this.Hxb));this.Hxb=null;this.PDa&&(this.PDa.stop(),this.PDa=null);if(this.Bjb<=this.HVb){if(this.mb.pa("SendHostAttributionInfoForPolicyLabelEnabled")){const Ob=Lb.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in Ob&&Ob[Gb.a.xPd]&&"HostAttributionInfo.ScenarioTypeParamName"in Ob&&Ob[Gb.a.yPd]){Lb.data.request.get_headers();
Lb.data.request.get_headers();Lb=this.Y5c(Ic);this.hcc(this.Z7,Lb,this.tpa,void 0,Ic);return}}this.dgd(this.Z7,Ic,this.tpa)}else b.ULS.sendTraceTag(34996494,306,15,"Request to get label policy failed with error response: {0}.",Lb?Lb.data?Lb.data.ZQa:null:null),this.jtc(),this.Bjb=0,this.XMd(!1)}b6e(Lb){return Lb.state?Lb.state:0}P4a(Lb,Ic=!1){let Ob=String.format("{0}{1}?action={2}&{3}",this.mb.Wa("PolicyHandlerWebServiceBase")||n.AFrameworkApplication.sa.Qa.t_,this.Uge,Lb,n.AFrameworkApplication.vi);
"setpolicylabel"===Lb&&n.AFrameworkApplication.Ty&&n.AFrameworkApplication.Ty.Bif&&(Ob=Yb.a.wl(Ob,"sl","1"));Ic&&(Ob=Yb.a.wl(Ob,"cbd","1"));return Ob}r7e(Lb){let Ic,Ob;Ic=Ob=null;Lb&&Lb.data&&Lb.data.request&&Lb.data.request.get_headers()&&(Ic=Lb.data.request.get_headers()[qb.a.z2f],Ob=Lb.data.request.get_headers()[qb.a.d6f]);return{y2f:Ic,c6f:Ob}}a_d(Lb){Lb=Lb?Lb.data?Lb.data.de:null:null;return Lb&&Lb.length&&!this.pui(Lb)?{returnValue:!0,data:Lb}:(b.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),
{returnValue:!1,data:Lb})}$3i(Lb){let Ic;try{Ic=La.b(Lb)}catch(Ob){b.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.");return}if(Ic)if(Ic.IsPolicyTipAvailable)switch(Ic.IsPolicyTipAvailable.toLowerCase()){case "false":b.ULS.sendTraceTag(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");break;case "true":b.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document.");this.IJc=Ic.NavigateUrl;this.ZJj(Ic.GeneralText,
Object(e.a)(this,this.XQi,"onDataLossPolicyOverrideButtonClick"));break;default:b.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",Ic.IsPolicyTipAvailable)}else b.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");else b.ULS.sendTraceTag(25565185,306,10,"policyData is null after deserializing DataLossPrevention response.")}gah(Lb){switch(Lb){case "CoherencyFailure":return 1;
case "DisabledByPolicy":return 2;case "FileCheckedOut":return 3;case "FileEncrypted":return 4;case "FileLocked":return 5;case "FileNotSupported":return 6;case "FileTooLarge":return 7;case "InvalidOperationOnZeroByteFile":return 8;case "LabelDisabled":return 9;case "LabelErrorRetryLater":return 10;case "LabelIdNotFound":return 11;case "LabelIrmDisabledByTenant":return 12;case "LabelNotSupported":return 13;case "MinorVersionLimitExceeded":return 15;default:return 0}}s4i(Lb,Ic,Ob,Kc){var Ac=Kc?Kc.YL:
2;let Yc=0,td="",$d;if(({ht:$d}=La.d(Lb)).returnValue)if($d){td="Success";Lb=this.Y5c(3);if($d.IsSuccessful){D.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.ubc(Ac,void 0,this.DMb));this.iDb=this.DMb=null;b.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",Ac);2===Ac&&this.sda(29);this.MBj(Ic,Ac);this.ZLi();this.sda(28);Kc&&4===Ac&&this.h_b(28,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,
Kc.displayName),CommonUIStrings.l_DialogOk,()=>{});E.a("MipAppliedLabels",void 0,void 0,[Object.assign(new O.a,{name:"SetPolicyLabelApplyFlag",string:ua[Ac]})]);this.hcc(Ic,Lb,this.tpa,void 0,3);return}b.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",Ac,$d.FailureReason);this.iDb=$d.FailureReason;this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ImproveSetLabelFailureErrMsg",
!1)?Yc=this.gah($d.FailureReason):"FileTooLarge"===$d.FailureReason?Yc=7:"LabelNotSupported"===$d.FailureReason?Yc=13:"LabelDisabled"===$d.FailureReason?Yc=9:"MinorVersionLimitExceeded"===$d.FailureReason&&(Yc=15);this.tui&&0<=$d.FailureReason.indexOf("InvalidOperationOnZeroByteFile")&&(Kc=new Ra.a(2,1,this.RAj,()=>{b.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",this.tra);this.tra<=this.HVb&&this.cSd(Ic,Ob)}),
this.he.fg(Kc));this.shc&&this.supportsOfficeClientCoauthoring&&this.hcc(this.Zm.AppliedPolicyId,Lb,this.tpa,!0,3)}else td="setPolicyLabelData null.",b.ULS.sendTraceTag(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",Ac);else td="TryDeserialize failed.",b.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",Ac);this.EOd(Ac,Yc);Ac=this.ubc(Ac,void 0,this.DMb);this.DMb=null;
Ac.extendedProperties.set("SetPolicyLabelDataFailureReason",this.iDb);Ac.extendedProperties.set("SetPolicyLabelDataParseStatus",td.toString());D.Health.instance.recordKpiFailure("MipSetPolicyLabel","SetPolicyLabelFailure",!1,!1,Ac)}EOd(Lb,Ic=0){const Ob=2===Lb||8===Lb||16===Lb;this.setPolicyLabel(this.Z7);this.MQf(new fb);this.iJd(Ic,Lb,Ob,!1)}MBj(Lb,Ic){this.setPolicyLabel(this.Z7=Lb);if(""===Lb)n.AFrameworkApplication.protectedFile=!1,n.AFrameworkApplication.enableMacrosForProtectedFile=!1;else for(const Ob of this.Zm.SensitivityLabels)if(Ob.Id===
Lb){n.AFrameworkApplication.protectedFile=Ob.IsEndpointProtectionEnabled;break}this.Qbj(new R(Lb,Ic))}M0j(){for(const Lb of this.Zm.SensitivityLabels)Lb&&Lb.Enabled&&(Lb.Id===this.Z7&&(this.sbe=this.KCa!==Lb.Order,this.KCa=Lb.Order),Lb.Order>this.gMc&&(this.gMc=Lb.Order))}i4i(Lb){if(!({ht:Lb}=La.d(Lb)).returnValue)return b.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1;if(!Lb)return b.ULS.sendTraceTag(42467542,306,10,"policyData is null after deserializing label policy data response."),
!1;if(!Lb.AreLabelsAvailable)return!1;this.Zm=Lb;this.Z7=Lb.AppliedPolicyId;this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&this.M0j();this.Zga()&&b.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call.");this.MQf(new fb(!0));return!0}hve(){if(!this.Zga())return b.ULS.sendTraceTag(539877699,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels to display"),!1;for(const Lb of this.Zm.SensitivityLabels)if(Lb&&
Lb.AutoLabelingSensitiveTypeIds&&0<Lb.AutoLabelingSensitiveTypeIds.length)return!0;b.ULS.sendTraceTag(539877700,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels with AutoClp SIT");return!1}MQf(Lb){b.ULS.sendTraceTag(35393610,306,50,"Raising label info update event.");this.Za.raiseEvent("LabelInfoUpdateEvent",Lb)}gbj(Lb){b.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event.");this.Za.raiseEvent("GetPolicyLabelEventKey",Lb)}jtc(){xa.MQa(!1);this.Za.raiseEvent("GetPolicyLabelFailureEventKey",
new ka)}XId(Lb){this.MO&&this.MO.execute(Ic=>{Ic=[Ic.isFeatureEnabled("MsoClpSpTwo",!0),Ic.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all(Ic).then(Ob=>{Ha.a.any(Ob,Kc=>Kc)&&(b.ULS.sendTraceTag(50944077,306,50,"Raising get auto policy label event."),this.Za.raiseEvent("GetAutoPolicyLabelEventKey",Lb),this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)&&this.vsb(),E.a("MipAutoClassificationEnabled"));return null})})}tgd(Lb=null,Ic=null){const Ob=
new Map;Ob.set("ClpCoauth",this.supportsOfficeClientCoauthoring.toString());null!=Lb&&Ob.set("ApplyLabelFlags",ua[Lb]);null!=Ic&&Ob.set("GetPolicyLabelsReason",Ta[Ic]);return Ob}ubc(Lb=null,Ic=null,Ob=null){const Kc=new Ja.a;Kc.extendedProperties=this.tgd(Lb,Ic);null!=Ob&&(Kc.durationMs=this.jw()-Ob);return Kc}Qbj(Lb){b.ULS.sendTraceTag(41799710,306,50,"Raising set policy label event.");this.Za.raiseEvent("SetPolicyLabelEventKey",Lb)}wQf(Lb){b.ULS.sendTraceTag(51128227,306,50,"Raising an add auto policy business bar entry event.");
Lb&&Lb.MBb&&E.a("MipRecommendations");this.Za.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",Lb)}aRf(Lb){b.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event.");this.Za.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",Lb)}Iaj(Lb){b.ULS.sendTraceTag(573842331,306,50,"Raising an add mandatory labelling business bar entry event.");this.Za.raiseEvent("AddMandatoryLabellingBusinessBarEntryEventKey",Lb)}Kbj(Lb){b.ULS.sendTraceTag(573842332,306,50,"Raising a remove mandatory labelling business bar entry event.");
this.Za.raiseEvent("RemoveMandatoryLabellingBusinessBarEntryEventKey",Lb)}ZJj(Lb,Ic=null){b.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user.");this.Za.raiseEvent("PolicyTipEvent",new mb(CommonUIStrings.l_PolicyBusinessBarTitle,Lb,CommonUIStrings.l_PolicyOverrideButton,Ic))}iJd(Lb,Ic,Ob,Kc=!0){b.ULS.sendTraceTag(42074656,306,Kc?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",Ic);Kc=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;let Ac=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,
Yc=null,td=null;switch(Lb){case 2:Kc=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarTitle;Ac=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarMessage;break;case 5:Ac=CommonUIStrings.l_SensitivityApplicationErrorFileLockedBusinessBarMessage;break;case 7:Kc=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle;Ac=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage;break;case 13:Kc=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle;
Ac=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage;break;case 9:Kc=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle;Ac=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage;break;case 10:Ac=CommonUIStrings.l_SensitivityApplicationErrorLabelErrorRetryLaterBusinessBarMessage;break;case 14:Kc=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle;Ac=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage;
break;case 15:Kc=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,Ac=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,Yc=CommonUIStrings.l_LearnMore,td=()=>{this.SAj()}}Lb=new wa(Lb,Ic,Ob,Kc,Ac,Yc,td);this.Za.raiseEvent("SetPolicyLabelFailureEventKey",Lb)}bAj(Lb){this.fPc=Lb}XQi(){this.IJc?(b.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),mc.a.FU(this.IJc)):b.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")}pui(Lb){if(!Lb.startsWith("<")||
-1===Lb.indexOf("Error")&&-1===Lb.indexOf("Unavailable"))return!1;b.ULS.sendTraceTag(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint.");return!0}ZMf(){this.FWb&&(this.FWb.stop(),this.FWb=null)}WNh(Lb){if(!Lb)return"manual";switch(Lb.YL){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";
default:return"manual"}}hPh(Lb){if(!Lb)return"privileged";Lb=Lb.YL;let Ic="privileged";if(4===Lb||1===Lb)Ic="standard";return Ic}hcc(Lb,Ic,Ob=null,Kc=!1,Ac=0){this.mb.pa("WacLabelingGetPolicyLabelsIsEnabled")&&(this.Z7=Lb,this.tpa=Ob,this.rh&&(this.PDa=this.rh.Gc("WebServiceCall","Call Get Policy Endpoint On Server")),Ob={},Ob[qb.a.qSg]=Lb,this.mb.pa("SendHostAttributionInfoForPolicyLabelEnabled")?(Lb=new Zb(this.P4a("getpolicylabels",Kc),1,null,Ob,!0,2,Ac,void 0,void 0,void 0,void 0,void 0,void 0,
void 0,void 0,void 0,void 0,void 0,void 0,Ic),this.ph.send(Lb).BKd(Object(e.a)(this,this.LDf,"onGetPolicyLabelsSuccessCallback"),Object(e.a)(this,this.KDf,"onGetPolicyLabelsFailureCallback"))):this.ph.Jm(this.P4a("getpolicylabels",Kc),1,null,Ob,!0,2,Object(e.a)(this,this.LDf,"onGetPolicyLabelsSuccessCallback"),Object(e.a)(this,this.KDf,"onGetPolicyLabelsFailureCallback"),Ac,void 0,void 0,void 0,void 0,"22"),this.Bjb++,b.ULS.sendTraceTag(34996492,306,50,"Policy label request sent to server. Policy call times: {0}",
this.Bjb))}QAj(Lb,Ic,Ob,Kc=null){if(this.jAb){this.rh&&(this.fFa=this.rh.Gc("WebServiceCall","Call Set Policy Endpoint On Server"));var Ac={};Ac[qb.a.z2f]=Lb;Ic&&(Ac[qb.a.d6f]=encodeURIComponent(Ic));this.fPc&&(Ac[qb.a.HRg]=this.fPc);Kc?(Ac[qb.a.a6f]=this.WNh(Kc),Ac[qb.a.b6f]=this.hPh(Kc),this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultLabelForSPODocLibEnabled",!1)&&1===Kc.YL&&this.Zm.DefaultLabelType&&(Ac[qb.a.PAj]=this.Zm.DefaultLabelType)):(Ac[qb.a.a6f]="manual",Ac[qb.a.b6f]=
"privileged");this.supportsOfficeClientCoauthoring&&this.Zm&&(Ac[qb.a.g6i]=this.Zm.PolicyLabelVersionToken);this.mb.pa("SendHostAttributionInfoForPolicyLabelEnabled")?(Lb=new Zb(this.P4a("setpolicylabel",!0),1,null,Ac,!0,2,Kc,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ob),this.ph.send(Lb).BKd(Object(e.a)(this,this.AIf,"onSetPolicyLabelSuccessCallback"),Object(e.a)(this,this.zIf,"onSetPolicyLabelFailureCallback"))):this.ph.Jm(this.P4a("setpolicylabel",!0),1,
null,Ac,!0,2,Object(e.a)(this,this.AIf,"onSetPolicyLabelSuccessCallback"),Object(e.a)(this,this.zIf,"onSetPolicyLabelFailureCallback"),Kc,void 0,void 0,void 0,void 0,"32");this.tra++;b.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this.tra)}else b.ULS.sendTraceTag(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.")}SAj(){const Lb=new V.StandardDialog,Ic=this.mb.Wa("BreadcrumbFolderUrl");Ic?
(Lb.Ob=11,Lb.tc(1,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoAction),Lb.tc(2,CommonUIStrings.l_DialogOk)):(Lb.Ob=0,Lb.tc(1,CommonUIStrings.l_DialogOk));Lb.Woe(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoHelpText,"0f6cd105-974f-44a4-aadb-43ac5bdfd247");Lb.iij();Lb.YR(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoMessage,
Ob=>{1===Ob&&Ic&&mc.a.gf(Ic,"_blank",void 0,"SetPolicyLabelFailureBusinessBarActionCallback.BreadcrumbFolderUrl")})}Y5c(Lb){switch(Lb){case 1:return Gb.a.Wha(1,1);case 2:return Gb.a.Wha(7,1);case 3:return Gb.a.Wha(8,1);default:return Gb.a.Wha(7,0)}}Wdh(Lb=null){if(!Lb)return Gb.a.Wha(8,0);switch(Lb.YL){case 1:case 16:return Gb.a.Wha(1,1);case 4:case 2:case 8:return Gb.a.Wha(8,1);default:return Gb.a.Wha(8,0)}}XMd(Lb){this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",
!1)&&appChrome.api.setAsyncRequestStatus("sensitivity",Lb)}}Object(c.a)(Na,"PolicyManager",null,[670]);var Qa=a(136),Oa=a(251);class bb{constructor(){this.d1=this.bra=this.$a=this.ah=null}get name(){return"Common.App.Policy"}init(){n.AFrameworkApplication.fa.pa("ShouldInitCommonPolicyPackage")&&(n.AFrameworkApplication.fa.pa("IsDataLossPreventionEnabledForUser")&&n.AFrameworkApplication.sa&&(this.ah=this.$a.resolve("Common.App.Policy.Contracts.IPolicyManager"),this.ah.yre(Object(e.a)(this,this.aVd,
"showPolicyBusinessBar")),b.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),Qa.a.get_instance().Lj(6,()=>{this.ah.egd()})),n.AFrameworkApplication.fa.pa("WacLabelingPoliciesIsEnabled")&&n.AFrameworkApplication.fa.pa("SupportsPolicies")?Qa.a.get_instance().Lj(6,Object(e.a)(this,this.$Ni,"onAfterRibbonBehaviorAttached")):xa.MQa(!1))}dispose(){}Bh(Lb){Lb.register(670,"Common.App.Policy.Contracts.IPolicyManager").qc().yc(()=>new Na(n.AFrameworkApplication.fa,n.AFrameworkApplication.Bd,
n.AFrameworkApplication.sa.HD,n.AFrameworkApplication.fa.vd("MaxGetPolicyRetries",1),Lb.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),n.AFrameworkApplication.sa.Qa.Oj));Lb.register(xa,"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").qc().yc(()=>new xa(n.AFrameworkApplication.rb,n.AFrameworkApplication.sa,n.AFrameworkApplication.fa,Lb.jOd("Common.App.Policy.Contracts.IPolicyManager")));this.$a=Lb}$Ni(){this.d1=this.$a.mg("CommonUI.BusinessBar");
this.ah||(this.ah=this.$a.resolve("Common.App.Policy.Contracts.IPolicyManager"));this.bra=this.$a.resolve("Common.App.Policy.PolicyActor");n.AFrameworkApplication.fa&&n.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&L.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")?this.ah.R_b(Object(e.a)(this.bra,this.bra.PTf,"registerActionsHandler")):this.bra.Ag();this.ah.R_b(Object(e.a)(this,
this.p0d,"updateLabelInfo"));n.AFrameworkApplication.fa.pa("WacApplyManualPolicyLabelIsEnabled")&&(this.ah.SXc(Object(e.a)(this,this.oai,"handleSetPolicyLabelFailure")),this.ah.eqe(Object(e.a)(this,this.h_b,"addAutoPolicyBusinessBarEntry")),this.ah.Are(Object(e.a)(this,this.sda,"removeAutoPolicyBusinessBarEntry")),this.ah.fqe(Object(e.a)(this,this.LWc,"addMandatoryLabellingBusinessBarEntry")),this.ah.Bre(Object(e.a)(this,this.wLd,"removeMandatoryLabellingBusinessBarEntry")))}p0d(){this.bra.W5f();
this.bra.p5f();this.bra.iQf();const Lb=this.ah.V3g();n.AFrameworkApplication.fa.pa("HasDocumentEditRights")&&!Lb?this.bra.lgg():b.ULS.sendTraceTag(558682911,306,50,"Default/Mandatory Labeling has been skipped because HasDocumentEditRights: {0}, IsClpBlockedByAppSpecificScenario: {1}",n.AFrameworkApplication.fa.pa("HasDocumentEditRights"),Lb);n.AFrameworkApplication.sa.updateCommandUI()}aVd(Lb,Ic){this.$5e(Ic.title,Ic.bsc,38,Ic.nAf,Ic.buttonText);b.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")}oai(Lb,
Ic){Ic.h$f&&(this.$5e(Ic.title,Ic.message,21,null,null,Ic.g$,Ic.buttonText),b.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user."))}sda(){}h_b(Lb,Ic){this.d1&&(this.ah.sda(Ic.tqb),Lb=new f.a(Ic.title,Ic.message,null),Lb.id=Ic.tqb,Lb.closeable=!0,Lb.image=3,Lb.addButton(Ic.buttonText,Ic.g$,Ic.buttonText,!0),this.d1.gE(Lb,!1))}LWc(Lb,Ic){this.d1&&(Lb=new f.a(Ic.title,Ic.message,null),Lb.id=Ic.tqb,Lb.closeable=!1,Lb.image=3,Lb.addButton(Ic.buttonText,
Ic.g$,Ic.buttonText,!1),this.d1.gE(Lb,!1))}wLd(){}$5e(Lb,Ic,Ob,Kc=null,Ac=null,Yc=null,td=null){Lb=new f.a(Lb,Ic,null);Lb.id=Ob;Lb.closeable=!0;Kc&&Lb.zJg(Ac,Kc);Yc&&Lb.addButton(td,Yc,td)}static main(){Oa.a.instance.ii(new bb)}}Object(c.a)(bb,"PackageManager",null,[3,4]);var Ga=a(9),tb=a(552),wb=a(226),lb=a(50),db=a(37),Pa=a(84),ja=a(38),Ka=a(376),ub=a(193),Kb=a(94),W=a(29),za=a(249),Sa=a(1),Wa=a(22),ab=a(282);class ma{constructor(){this.asc=this.q3f=null;this.YL=0}}Object(c.a)(ma,"ApplyPolicyContextParameters",
null,[]);var ha=a(7),eb=a(708),ta=a(565),ya=a(48),sb=a(44);class Qb{constructor(){this.vGa=this.annotationType=null;this.bMa=this.uw=!1}}Object(c.a)(Qb,"AnnotationActivationOptions",null,[]);var oc=a(60);const kb=(Lb,Ic,Ob,Kc,Ac,Yc,td=null)=>{td=Lb.Na(1,td);td.tenantId=Ic;return oc.g(Lb,"GetPolicyLabelId",td,Ob,Kc,Ac,Yc,4)},jb=(Lb,Ic,Ob,Kc,Ac,Yc,td,$d,be,ke,Pe=null)=>{Pe=Lb.Na(41,Pe);Pe.labelsInfoJson=Ic;Pe.appliedLabelId=Ob;Pe.tenantId=Kc;Pe.applyLabelFlag=Ac;Pe.skipApplyOutcomes=Yc;return oc.g(Lb,
"ApplyPolicyLabel",Pe,td,$d,be,ke,0)},Wb=(Lb,Ic,Ob,Kc,Ac,Yc,td=null)=>{td=Lb.Na(1,td);td.tenantId=Ic;return oc.g(Lb,"GetPolicyApplicationMethod",td,Ob,Kc,Ac,Yc,4)};var wc=a(736),Jc=a(713);class zc extends wc.a{constructor(){super();this.source=this.automatic=this.recommended=null;this.H_=Object.assign(new Jc.a,{T_:zc.getTypeName(),B_:zc.Kd()})}static getTypeName(){return"AugLoop_SecurityClp_LabellingAnnotation"}static Kd(){return["AugLoop_Core_Annotation"]}}Object(c.a)(zc,"LabellingAnnotation",wc.a,
[]);var gd=a(730);class Va extends gd.a{constructor(){super();this.fullDocSITs=this.partialDocSITs=null;this.H_=Object.assign(new Jc.a,{T_:Va.getTypeName(),B_:Va.Kd()})}static getTypeName(){return"AugLoop_SecurityShared_SecurityShared"}static Kd(){return[]}}Object(c.a)(Va,"SecurityShared",gd.a,[]);class Eb extends Va{constructor(){super();this.existingLabelPriority=null;this.H_=Object.assign(new Jc.a,{T_:Eb.getTypeName(),B_:Eb.Kd()})}static getTypeName(){return"AugLoop_SecurityShared_CLP"}static Kd(){return["AugLoop_SecurityShared_SecurityShared"]}}
Object(c.a)(Eb,"CLP",Va,[]);class hc extends wc.a{constructor(){super();this.source=this.automatic=this.recommended=null;this.H_=Object.assign(new Jc.a,{T_:hc.getTypeName(),B_:hc.Kd()})}static getTypeName(){return"AugLoop_Automatic_Clp_LabellingAnnotation"}static Kd(){return["AugLoop_Core_Annotation"]}}Object(c.a)(hc,"LabellingAnnotation",wc.a,[]);var Ab=a(991),Bb=a(884),ec=a(993);class Qd extends wc.a{constructor(){super();this.classificationId=null;this.H_=Object.assign(new Jc.a,{T_:Qd.getTypeName(),
B_:Qd.Kd()})}static getTypeName(){return"AugLoop_LinkedDataType_LinkedDataTypeAnnotation"}static Kd(){return["AugLoop_Core_Annotation"]}}Object(c.a)(Qd,"LinkedDataTypeAnnotation",wc.a,[]);class dc extends ja.a{constructor(Lb,Ic,Ob,Kc,Ac){super();this.Tuf=3;this.qA=this.augmentationLoopManager=null;this.b_a=!1;this.bab=[];this.vpf=new eb.a(ta.a.SJ());this.LHd=0;this.QHd=null;this.vsb=(Yc,td)=>{Yc=Object(ha.a)(new Ab.a,{parentPath:["session","doc","security"],items:[Object(ha.a)(new Bb.a,{id:"clp",
body:Object(ha.a)(new Eb,{existingLabelPriority:td.existingLabelPriority,partialDocSITs:td.PDe,fullDocSITs:td.ODe})})]});this.bab.push(Yc);this.Jzb()};this.Sig=(Yc,td)=>{Yc=Object(ha.a)(new ec.a,{parentPath:["session","doc","security"],items:[Object(ha.a)(new Bb.a,{id:"clp",body:Object(ha.a)(new Eb,{existingLabelPriority:td.existingLabelPriority})})]});this.bab.push(Yc);this.Jzb()};this.Tig=(Yc,td)=>{Yc=Object(ha.a)(new ec.a,{parentPath:["session","doc","security"],items:[Object(ha.a)(new Bb.a,{id:"clp",
body:Object(ha.a)(new Eb,{partialDocSITs:td.PDe,fullDocSITs:td.ODe})})]});this.bab.push(Yc);this.Jzb()};this.Y5=()=>{b.ULS.sendTraceTag(537154588,306,50,`AutoPolicyManager::OnApplicationModeChanged - isEditMode:${this.$.isEditMode}.`);this.$.isEditMode?Sa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.Jzb():this.jef():(this.businessBar.removeEntry(41),this.businessBar.removeEntry(40),this.Gjh())};this.Foc=()=>{b.ULS.sendTraceTag(537154587,306,50,"AutoPolicyManager::OnAugmentationLoopSessionClose called.");
this.uLe();this.augmentationLoopManager=null};this.pyi=(Yc,td)=>{var $d,be,ke,Pe,Dd;b.ULS.sendTraceTag(537154586,306,50,"AutoPolicyManager::LabellingAnnotationHandler called.");if(3===td.operationType)b.ULS.sendTraceTag(537154585,306,50,"AutoPolicyManager::LabellingAnnotationHandler Ignoring delete operation.");else{var ge=Yc=null,ne=null;if(this.$gc()){var ce=td.BG;if(!ce){b.ULS.sendTraceTag(537154584,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===
($d=ce.automatic)||void 0===$d?0:$d.id)Yc=ce.automatic.id;if(null===(be=ce.recommended)||void 0===be?0:be.id)ge=ce.recommended.id,ce.recommended.policyTip&&(ne=ce.recommended.policyTip)}else{$d=td.BG;if(!$d){b.ULS.sendTraceTag(537154583,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===(ke=null===(ce=$d.automatic)||void 0===ce?void 0:ce.sensitivityLabel)||void 0===ke?0:ke.id)Yc=$d.automatic.sensitivityLabel.id;if(null===(Dd=null===(Pe=$d.recommended)||
void 0===Pe?void 0:Pe.sensitivityLabel)||void 0===Dd?0:Dd.id)ge=$d.recommended.sensitivityLabel.id,$d.recommended.sensitivityLabel.policyTip&&(ne=$d.recommended.sensitivityLabel.policyTip)}this.applyPolicyLabel(Yc,ge,ne,1)}};this.lAi=(Yc,td)=>{b.ULS.sendTraceTag(537154582,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Handler called.");3===td.operationType?b.ULS.sendTraceTag(537154581,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received delete operation."):
(Yc=td.BG)?(Yc=Yc.classificationId,this.applyPolicyLabel(Yc,Yc,null,2)):b.ULS.sendTraceTag(537154580,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received an empty annotation.")};this.RUf=(Yc,td)=>{td?td.MBb&&this.businessBar.JG(41)?(this.businessBar.removeEntry(41),b.ULS.sendTraceTag(537154562,306,50,"Remove entry to RecommendedSensitivityLabelBusinessBarEntry succeeded.")):!td.MBb&&this.businessBar.JG(40)&&(this.businessBar.removeEntry(40),b.ULS.sendTraceTag(537154561,
306,50,"Remove entry to AutomaticSensitivityLabelBusinessBarEntry succeeded.")):b.ULS.sendTraceTag(537154563,306,15,"RemoveAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.v9f=(Yc,td)=>{td?td.MBb?(this.businessBar.mKj(td.title,td.message,td.buttonText,$d=>{td.g$($d);this.businessBar.JG(41)&&this.businessBar.removeEntry(41)}),b.ULS.sendTraceTag(537154531,306,50,"Add entry to RecommendedSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):
(this.businessBar.cIj(td.title,td.message,td.buttonText,$d=>{td.g$($d);this.businessBar.JG(40)&&this.businessBar.removeEntry(40)}),b.ULS.sendTraceTag(537154530,306,50,"Add entry to AutomaticSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):b.ULS.sendTraceTag(537154560,306,15,"ShowAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.yGd=Lb;this.policyManager=Ic;this.$=Ob;this.fa=Kc;this.businessBar=Ac;this.qfi();this.pfj();this.disposed=
!1}get Xb(){return!this.disposed&&this.$.ea.Xb}dispose(){this.disposed||(this.disposed=!0,this.vlh(),this.uLe(),this.yGd=this.policyManager=this.augmentationLoopManager=null,super.dispose())}JZa(Lb,Ic,Ob,Kc,Ac=!1){b.ULS.sendTraceTag(537154642,306,50,`AutoPolicyManager: ApplyAutoPolicyLabel called for LabellingSource ${Kc} with AutoLabelPresent: ${!!Lb}, RecommendedLabelPresent: ${!!Ic}, isStandard: ${Ac}.`);this.Xb?this.yGd&&(this.B1g(Ic,Kc)?(this.QHd=Ic,this.LHd=Kc,this.vpf.ia(Kc,Ic)):Ic=this.QHd,
Lb=this.yGd.JZa(Lb,Ic,Ob,Ac),b.ULS.sendTraceTag(537154640,306,50,`AutoPolicyManager::ApplyAutoPolicyLabel - policyActor.ApplyAutoPolicyLabel returned ${Lb}.`)):b.ULS.sendTraceTag(537154641,306,15,`AutoPolicyManager: ApplyAutoPolicyLabel failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Xb}.`)}B1g(Lb,Ic){if(!this.policyManager.Zga())return b.ULS.sendTraceTag(537154639,306,15,"CanShowRecommendedSensitivityLabel - Labels are not available."),!1;const Ob=this.policyManager.Zm;
let Kc;({value:Kc}=this.vpf.Fc(this.LHd));let Ac=null,Yc=null,td=null;for(const $d of Ob.SensitivityLabels)$d.Id===Lb&&(Ac=$d),$d.Id===Kc&&(Yc=$d),$d.Id===this.QHd&&(td=$d);return Yc&&Yc.Id===Lb?(b.ULS.sendTraceTag(537154638,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since it is same as last recommendation from current source."),!1):this.businessBar.JG(41)&&this.LHd!==Ic&&td&&(!Ac||td.Order>=Ac.Order)?(b.ULS.sendTraceTag(537154637,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since current label priority is lower than last label priority."),
!1):!0}$gc(){return Sa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)}Lgf(){return Sa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPSecurityNodeCreation",!1)}pfj(){this.policyManager.eqe(this.v9f);this.policyManager.Are(this.RUf);this.$.ea.l2(this.Y5);this.$gc()&&this.Lgf()&&(this.policyManager.uMg(this.vsb),this.policyManager.lPg(this.Sig),this.policyManager.mPg(this.Tig))}vlh(){this.businessBar.removeEntry(41);this.businessBar.removeEntry(40);
this.policyManager.Zij(this.v9f);this.policyManager.rlj(this.RUf);this.$.ea.K6(this.Y5);this.$gc()&&this.Lgf()&&(this.policyManager.Ijj(this.vsb),this.policyManager.Wlj(this.Sig),this.policyManager.Xlj(this.Tig))}qfi(){this.qA=new eb.a(ta.a.SJ());const Lb=this.$gc()?zc.getTypeName():hc.getTypeName();this.qA.add(1,Object(ha.a)(new Qb,{annotationType:Lb,vGa:this.pyi,uw:!1,bMa:!1}));this.qA.add(2,Object(ha.a)(new Qb,{annotationType:Qd.getTypeName(),vGa:this.lAi,uw:!1,bMa:!1}))}Icg(){for(let Lb of this.bab)this.augmentationLoopManager.submitOperation(Lb);
this.bab=[]}Stc(Lb){if(!this.qA.hb(Lb))return b.ULS.sendTraceTag(537154636,306,15,`AutoPolicyManager::RegisterAnnotation - AnnotationActivationOptions not available for LabellingSource ${Lb}.`),!1;if(this.qA.ma(Lb).uw)return b.ULS.sendTraceTag(537154635,306,15,`AutoPolicyManager::RegisterAnnotation - Annotations already registered for LabellingSource ${Lb}.`),!0;this.qA.ma(Lb).uw=!0;b.ULS.sendTraceTag(537154634,306,50,`AutoPolicyManager::RegisterAnnotation - Annotations registered for LabellingSource ${Lb}.`);
if(!this.$.isEditMode)return b.ULS.sendTraceTag(537154633,306,50,"AutoPolicyManager::RegisterAnnotation - Skipping AugmentationLoop initialization in view mode."),!0;Sa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.Jzb():this.jef();return!0}jef(){var Lb=!1;for(let Ic of this.qA)if(Lb=Ic.value.uw||Lb)break;Lb?this.augmentationLoopManager?(b.ULS.sendTraceTag(537154631,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop already initialized."),
this.EZb()):this.b_a?b.ULS.sendTraceTag(537154630,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop initialization in-progress."):(this.b_a=!0,Lb=this.$.ya.FlightingSettings.AutoCLPStartUpDelay,b.ULS.sendTraceTag(537154629,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - Initializing AugmentationLoop in ${Lb} milliseconds.`),ya.a.instance.create(()=>{this.sfi()},Lb,sb.a.Lwe,!0,!0)):b.ULS.sendTraceTag(537154632,306,
50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - no registered annotations.")}Jzb(){var Lb=0<this.bab.length;if(!Lb)for(let Ic of this.qA)if(Lb=Ic.value.uw||Lb)break;Lb?this.augmentationLoopManager?(b.ULS.sendTraceTag(537154627,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop already initialized."),this.EZb(),this.Icg()):this.b_a?b.ULS.sendTraceTag(537154626,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop initialization in-progress."):
(this.b_a=!0,Lb=this.$.ya.FlightingSettings.AutoCLPStartUpDelay,b.ULS.sendTraceTag(537154625,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessary - Initializing AugmentationLoop in ${Lb} milliseconds.`),ya.a.instance.create(()=>{this.tfi()},Lb,sb.a.Lwe,!0,!0)):b.ULS.sendTraceTag(537154628,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - no registered annotations and operations.")}tfi(){db.TaskExtensions.za(lb.GetServiceTaskFactory.Oa(this.$.da,328,327,1),Lb=>{this.augmentationLoopManager=
Lb.result;this.b_a=!1;this.augmentationLoopManager?(b.ULS.sendTraceTag(537154595,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.augmentationLoopManager.voe(this.Foc),this.$.isEditMode?(this.EZb(),this.Icg()):b.ULS.sendTraceTag(537154594,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):b.ULS.sendTraceTag(537154624,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},
this.la,3)}sfi(){db.TaskExtensions.za(lb.GetServiceTaskFactory.Oa(this.$.da,328,327,1),Lb=>{this.augmentationLoopManager=Lb.result;this.b_a=!1;this.augmentationLoopManager?(b.ULS.sendTraceTag(571479120,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.augmentationLoopManager.voe(this.Foc),this.$.isEditMode?this.EZb():b.ULS.sendTraceTag(537154592,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):b.ULS.sendTraceTag(537154593,
306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.la,3)}uLe(){for(let Lb of this.qA)Lb.value.uw&&this.ulh(Lb.key)}ulh(Lb){this.qA.ma(Lb).bMa&&this.sKe(Lb);this.qA.ma(Lb).uw=!1;b.ULS.sendTraceTag(537154591,306,50,`AutoPolicyManager::DeregisterAnnotation completed for LabellingSource ${Lb}.`)}EZb(){for(let Lb of this.qA)Lb.value.uw&&!Lb.value.bMa&&this.activateAnnotation(Lb.key)}activateAnnotation(Lb){this.augmentationLoopManager.yYa(this.qA.ma(Lb).annotationType);
this.augmentationLoopManager.g2(this.qA.ma(Lb).annotationType,this.qA.ma(Lb).vGa);this.qA.ma(Lb).bMa=!0;b.ULS.sendTraceTag(537154590,306,50,`AutoPolicyManager::ActivateAnnotation completed for LabellingSource ${Lb}.`)}Gjh(){for(let Lb of this.qA)Lb.value.bMa&&this.sKe(Lb.key)}sKe(Lb){this.augmentationLoopManager.zQa(this.qA.ma(Lb).annotationType,this.qA.ma(Lb).vGa);this.qA.ma(Lb).bMa=!1;b.ULS.sendTraceTag(537154589,306,50,`AutoPolicyManager::DeactivateAnnotation completed for LabellingSource ${Lb}.`)}applyPolicyLabel(Lb,
Ic,Ob,Kc){if(this.fa.pa("SupportsOfficeClientCoauthoring"))b.ULS.sendTraceTag(537154579,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is enabled."),this.JZa(Lb,Ic,Ob,Kc);else{b.ULS.sendTraceTag(537154578,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is disabled.");const Ac=Yc=>{this.JZa(Lb,Ic,Ob,Kc,0===Yc||1===Yc||4===Yc)};this.hid(Ac,()=>{Ac(2)},this.Tuf)}}TZc(Lb,Ic){let Ob=null,Kc=null;if(!({sensitivityLabel:Ob,xGa:Kc}=this.bhg(Lb)).returnValue)return b.ULS.sendTraceTag(537154577,
306,15,"AutoApplyOrRecommendPolicyLabel - Failed to set the sensitivity labels."),!1;if(Kc&&Kc.Order>=Ob.Order)return b.ULS.sendTraceTag(537154576,306,50,"AutoApplyOrRecommendPolicyLabel - The applied label has a higher sensitivty."),!1;this.applyPolicyLabel(Ob.Id,Ob.Id,null,Ic);return!0}UZc(Lb,Ic){Ic=!1;let Ob=null,Kc=null;if(!({sensitivityLabel:Ob,xGa:Kc}=this.bhg(Lb)).returnValue)return b.ULS.sendTraceTag(537154575,306,15,"AutoApplyOrRecommendPowerBILabel - Failed to set the sensitivity labels."),
{returnValue:!1,T6a:Ic};if(Kc&&Kc.ParentId&&Ob.ParentId&&Kc.ParentId===Ob.ParentId)return b.ULS.sendTraceTag(537154574,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label has a common parent with AppliedLabel."),{returnValue:!1,T6a:Ic};if(Kc&&Kc.Order>=Ob.Order)return b.ULS.sendTraceTag(537154573,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label does not have a higher priority than AppliedLabel."),{returnValue:!1,T6a:Ic};if(this.fa.pa("SupportsOfficeClientCoauthoring"))b.ULS.sendTraceTag(537154572,
306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is enabled."),Lb=this.policyManager.Zm,Lb=!Lb.AppliedPolicyId||!Lb.PolicyLabelAssignmentMethod||ba.e(Lb.PolicyLabelAssignmentMethod)===ba.e("standard"),this.$ue(Ob.Id,Lb);else{b.ULS.sendTraceTag(537154571,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is disabled.");const Ac=Yc=>{this.$ue(Ob.Id,0===Yc||1===Yc||4===Yc)};this.hid(Ac,()=>{Ac(2)},this.Tuf)}return{returnValue:!0,
T6a:Ic}}hid(Lb,Ic,Ob,Kc=0){if(this.Xb){var Ac=this.$.oa.xa.Wb();Wb(this.$.oa.xa,this.$.ya.DocumentHostInfo.TenantId,Yc=>{this.e0h(Yc,Lb)},()=>{this.d0h(Lb,Ic,Ob,Kc)},null,null,Ac)}else b.ULS.sendTraceTag(537154570,306,15,`AutoPolicyManager: GetPolicyApplicationMethod failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Xb}.`)}e0h(Lb,Ic){b.ULS.sendTraceTag(537154569,306,50,"AutoPolicyManager: GetPolicyApplicationMethod web service call was successful.");this.Xb?!Lb||za.a(Lb)?
b.ULS.sendTraceTag(537154567,306,15,Lb?"AutoPolicyManager: GetPolicyApplicationMethod result has non-status message.":"AutoPolicyManager: GetPolicyApplicationMethod result is null"):Ic(Lb.Result):b.ULS.sendTraceTag(537154568,306,50,`AutoPolicyManager: GetPolicyApplicationMethodSuccessCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Xb}.`)}d0h(Lb,Ic,Ob,Kc){b.ULS.sendTraceTag(537154566,306,15,"AutoPolicyManager: GetPolicyApplicationMethod web service call failed. Trying again");
this.Xb?Kc>=Ob?(b.ULS.sendTraceTag(537154564,306,15,"AutoPolicyManager: GetPolicyApplicationMethod max retries exhausted."),Ic()):this.hid(Lb,Ic,Ob,Kc+1):b.ULS.sendTraceTag(537154565,306,50,`AutoPolicyManager: GetPolicyApplicationMethodFailureCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Xb}.`)}$ue(Lb,Ic){Ic?this.JZa(Lb,null,null,3,!0):this.JZa(null,Lb,null,3,!1)}bhg(Lb){let Ic,Ob;Ob=Ic=null;if(!this.$.isEditMode)return{returnValue:!1,sensitivityLabel:Ic,xGa:Ob};
if(!this.policyManager.Zga())return b.ULS.sendTraceTag(537154529,306,15,"TryGettingSensitivityLabels - Labels are not available."),{returnValue:!1,sensitivityLabel:Ic,xGa:Ob};const Kc=this.policyManager.Zm;if(!Kc)return b.ULS.sendTraceTag(537154528,306,15,"TryGettingSensitivityLabels - GetPolicyLabelsData returned an invalid result."),{returnValue:!1,sensitivityLabel:Ic,xGa:Ob};if(Ha.a.lh(Kc.SensitivityLabels))return b.ULS.sendTraceTag(537154527,306,15,"TryGettingSensitivityLabels - Attempting to apply labels when there are no sensitivity labels available."),
{returnValue:!1,sensitivityLabel:Ic,xGa:Ob};const Ac=Kc.AppliedPolicyId;for(const Yc of Lb)for(const td of Kc.SensitivityLabels)td.Id===Yc&&(!Ic||Ic.Order<td.Order)&&(Ic=td),td.Id===Ac&&(Ob=td);return Ic?{returnValue:!0,sensitivityLabel:Ic,xGa:Ob}:(b.ULS.sendTraceTag(537154526,306,10,"TryGettingSensitivityLabels - None of the sensitivity labels matched."),{returnValue:!1,sensitivityLabel:Ic,xGa:Ob})}}Object(c.a)(dc,"AutoPolicyManager",ja.a,[2]);var dd=a(157),jd=a(12),md=a(13);class vd extends dd.ErrorDialog{constructor(Lb){super(Lb,
vd.pQ(Lb))}$p(){super.$p();if(this.error.Appearance&1&&this.$.qd&2){const Lb=this.getButton(0);jd.DOMElementExtensions.qRd(Lb.get_element(),md.a.instance.ga(1314));this.gP(()=>{0===this.returnValue&&this.$.qd&2&&(b.ULS.sendTraceTag(50373725,306,50,"BlockSenitivityLabelActionDialog : Opening the book in excel desktop."),db.TaskExtensions.za(lb.GetServiceTaskFactory.Oa(this.$.da,55,56,0),Ic=>{Ic.result.F4c()},this.$.la,3))})}}static pQ(Lb){return Lb.qd&2?W.a.ed(3,1,0,1974,0,-1237306487,"SensitivityLabelBlockApplyLabelOpenInDesktop"):
W.a.ed(1,1,0,1975,0,-313914360,"SensitivityLabelBlockApplyLabel")}}Object(c.a)(vd,"BlockSenitivityLabelActionDialog",dd.ErrorDialog,[]);class wd extends ja.a{constructor(Lb,Ic,Ob,Kc,Ac){super();this.statusBarManager=null;this.Q_c=!1;this.a$=null;this.AEc=!1;this.Yxa=this.GQd=null;this.ro=this.zGd=!1;this.kEa=this.Ofe=this.Dfa=this.Wge=this.Bp=null;this.tPe=()=>{b.ULS.sendTraceTag(537154520,306,50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Triggered EnableAutoLabellingInDocument");const Yc=
this.STf(1);b.ULS.sendTraceTag(537154519,306,50,`PolicyManagerWrapper::EnableAutoLabellingInDocument - Annotation registration result: ${Yc}.`)};this.aVd=(Yc,td)=>{td?(this.Bp=td.title,this.Wge=td.bsc,this.Dfa=td.buttonText,this.Ofe=td.nAf,this.h$.ih(27,null),b.ULS.sendTraceTag(537154509,306,50,"Add entry to BusinessBar succeeded. Message is shown to user.")):b.ULS.sendTraceTag(537154510,306,15,"ShowPolicyBusinessBar is called but PolicyTipventArgs is null.")};this.I$f=(Yc,td)=>{const $d=Object(Pa.a)(wa,
td);$d?$d.h$f?(b.ULS.sendTraceTag(537154508,306,15,`ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of ${$d.errorType}`),this.h$.tKj($d.title,$d.message,$d.buttonText,be=>{$d.g$&&(this.h$.JG(54)&&this.h$.removeEntry(54),$d.g$(be))})):b.ULS.sendTraceTag(537154506,306,50,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure ShowMessage is false"):(b.ULS.sendTraceTag(537154505,306,10,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure args is null"),this.h$.ih(48,
null))};this.p0d=(Yc,td)=>{this.w6&&(b.ULS.sendTraceTag(537154504,306,50,"PolicyManagerWrapper: UpdateLabelInfo called"),this.w6.W5f(),this.w6.p5f(),this.w6.iQf(),this.$.qd&64&&(td.onSuccess&&this.Yxa?this.BSg():this.w6.lgg()));this.fa.pa("SupportsOfficeClientCoauthoring")&&(Yc=this.ls.Zm,this.kEa=Yc.AppliedPolicyId,"null"===this.labelId&&(this.kEa=""),this.AEc&&(Yc=Yc.PolicyLabelAssignmentMethod&&ba.e(Yc.PolicyLabelAssignmentMethod)===ba.e("standard")?4:2,this.applyPolicyLabel(this.labelId,Yc,!0,
this.GQd)));this.fWe();this.rz()};this.JDf=()=>{this.zGd=!0;this.fWe()};this.yIf=(Yc,td)=>{b.ULS.sendTraceTag(42322116,306,50,`PolicyManagerWrapper.OnSetLabelSucceeded: Applying outcomes for change in policy label. ProtectedFile = ${n.AFrameworkApplication.protectedFile}, ApplyLabelFlag = ${td.YL}`);this.applyPolicyLabel(td.asc,td.YL,!1,null)};this.jOi=(Yc,td)=>{this.kEa=td.asc;if(W.a.qq(Yc.Errors)){var $d=W.a.L3(Yc.Errors,[2045508683]);0<$d.length&&(Yc.Errors=W.a.Fz(Yc.Errors,[2045508683],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),
this.$.ea.Tn(Yc.Errors));$d=W.a.L3(Yc.Errors,[2046680228]);0<$d.length&&(4===td.YL||1===td.YL)&&(Yc.Errors=W.a.Fz(Yc.Errors,[2046680228],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.ea.Tn(Yc.Errors));$d=Yc=null;for(var be of this.ls.Zm.SensitivityLabels)Wa.a.equals(this.labelId,be.Id,!1)&&(Yc=be),Wa.a.equals(td.q3f,be.Id,!1)&&($d=be);be={};be.ApplyLabelFlag=td.YL;Yc?(be.currentLabel="Set",be.currentLabelEnabled=Yc.Enabled,be.currentLabelName=Yc.Name?"Set":"NotSet",be.currentLabelParentId=
Yc.ParentId?"Set":"NotSet"):be.currentLabel="NotSet";$d?(be.serverLabel="Set",be.serverLabelEnabled=$d.Enabled,be.serverLabelName=$d.Name?"Set":"NotSet",be.serverLabelParentId=$d.ParentId?"Set":"NotSet"):be.serverLabel="NotSet";b.ULS.sendTraceTag(541638850,306,15,`PolicyManagerWrapper.OnApplyManualPolicyLabelSuccessCallback Failed. DiagnosticInfo : ${JSON.stringify(be)}`)}};this.xWg=(Yc,td)=>{if(!this.$.workbookContext.HasRoundTrippedHFPart)return!1;const $d=this.ls.Zm;if(!$d)return b.ULS.sendTraceTag(537154502,
306,15,"PolicyManagerWrapper.BlockSetSensitivityCall: policyLabelsData is null."),!1;let be=null;for(const ke of $d.SensitivityLabels)Wa.a.equals(ke.Id,Yc,!1)&&(be=ke);return be&&this.Xbi(be)?(b.ULS.sendTraceTag(50341186,306,50,"PolicyManagerWrapper.BlockSetSensitivityCall: selectedSensitivityLabel has watermark label action."),this.fIj(td),!0):!1};this.lli=()=>{let Yc=!1;!this.$.ya.IsNewWorkbook||this.labelId&&this.labelId.length||(Yc=!0);b.ULS.sendTraceTag(537154501,306,50,`PolicyManagerWrapper.IsANewFile: is this a new file : ${Yc}`);
return Yc};this.Juf=(Yc,td)=>{1===td.Lte?this.$.isEditMode?(b.ULS.sendTraceTag(537154500,306,50,"MandatoryLabellingHandler : Swtiching to view-mode."),this.$.Ia.Hb(new Kb.a(-723527778,0,this.$.xc,10,null))):b.ULS.sendTraceTag(537154499,306,50,"MandatoryLabellingHandler : App is already in view-mode."):(this.Yxa=td.Yxa,this.$.ea.l2(this.Vue),this.$.lgb(),b.ULS.sendTraceTag(537154498,306,50,"MandatoryLabellingHandler : Swtiching to edit-mode."),this.$.Ia.Hb(new Kb.a(-8805455,0,this.$.xc,10,null)))};
this.cpe=(Yc,td)=>{td?(Yc=!!(this.$.qd&64),b.ULS.sendTraceTag(537154496,306,50,`AddMandatoryLabellingBusinessBar User has edit permission : ${Yc}`),Yc&&(this.$.lgb(),this.h$.CJj(td.title,td.message,td.buttonText,$d=>{td.g$($d)}))):b.ULS.sendTraceTag(537154497,306,15,"AddMandatoryLabellingBusinessBar is called but MandatoryLabellingAppHandlerEventArgs is null.")};this.nVf=()=>{this.h$.JG(42)&&this.h$.removeEntry(42)};this.Chg=(Yc,td)=>{td.eGj&&(b.ULS.sendTraceTag(527716803,306,50,"PolicyManagerWrapper.udpLabelingAppHandler: Open the document in the client when the applied label is a UDP label."),
db.TaskExtensions.za(lb.GetServiceTaskFactory.Oa(this.$.da,55,56,0),$d=>{$d.result.F4c()},this.$.la,3))};this.Vue=()=>{this.Yxa&&this.$.isEditMode?(this.$.ea.K6(this.Vue),this.Qwb()):b.ULS.sendTraceTag(537154467,306,15,`ApplyMandatoryLabelOnEditMode : mandatoryPolicyId empty ${!this.Yxa} , edit mode : ${this.$.isEditMode}.`)};this.aka=()=>{const Yc=this.$.ea.Qn;Yc&&!Wa.a.equals(Yc.AppliedPolicyLabelId,this.labelId,!1)&&(b.ULS.sendTraceTag(537154464,306,50,"PolicyManagerWrapper.HandleWorkbookMetadataChanged: Calling GetPolicyLabels to update statusbar and ribbon control."),
b.ULS.shipAssertTag(537154463,306,this.$.isEditMode,"PolicyManagerWrapper.HandleWorkbookMetadataChanged policyId cannot change in read-only mode, this can happen if right policy id is not read from server."),this.fa.pa("SupportsOfficeClientCoauthoring")&&this.$.isEditMode&&(this.AEc=!0,this.GQd=Yc.AppliedPolicyLabelId),this.kEa=Yc.AppliedPolicyLabelId,this.Qwb())};this.wqd=()=>{let Yc=!0;if(!this.$.ea.amIAlone)for(const td of this.$.ea.uo)if(!td.SupportsClientIsMipTrusted){Yc=!1;break}b.ULS.sendTraceTag(537154462,
306,50,`PolicyManagerWrapper.IsEveryCoauthorInSessionClientMipTrusted : ${Yc}`);return Yc};this.QEf=()=>{b.ULS.sendTraceTag(537154461,306,50,"PolicyManagerWrapper.OnLabelUpdate: RTC notification received");this.AEc=!0;this.Qwb()};this.$=Kc;this.ls=Lb;this.h$=Ob;this.fa=Ac;this.ls.yre(this.aVd);this.w6=Ic}initialize(){this.fa.pa("SupportsPolicies")?(this.kEa=this.fa.Wa("AppliedPolicyId"),this.w6.Ag(),this.$.da.gb(29,Lb=>{this.statusBarManager=Lb;Lb.$I(this)}),this.rz(),Wa.a.lh(this.fa.Wa("HostUserId"))||
this.h6i(),this.w6.rfj(this.xWg),this.w6.jgj(this.lli),this.ls.nfj(this.wqd),this.ro=Sa.EwaSettings.isChangeGateEnabled("OfficeVSO:7568646_PressEnterToPaste")):Sa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&L.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!0));!Wa.a.lh(this.fa.Wa("HostUserId"))&&Sa.EwaSettings.ra(158)&&this.$.ea.wg.get(45)&&(b.ULS.sendTraceTag(537154524,306,50,"DataLossPrevention feature is Enabled and launched on Excel."),
this.YTh())}pq(Lb){this.addHandler("LabelInfoChangedKey",Lb)}Lq(Lb){this.removeHandler("LabelInfoChangedKey",Lb)}un(){return!0}Tr(Lb,Ic){if("QueryPolicyLabel"!==Lb)return!1;if(this.Una())return Ic.Visible=!1,!0;Ic.Visible=!0;return 32===n.AFrameworkApplication.rb.Vd(ra.a.tbb,2,Ic)}dispose(){this.statusBarManager&&(this.statusBarManager.yF(this),this.statusBarManager=null);this.w6.NPb();this.Q_c=!1;this.ls.Ilj(this.I$f);this.ls.Jlj(this.yIf);this.$.ea.Av(this.aka);if(this.fa.pa("SupportsOfficeClientCoauthoring")){const Lb=
this.$.da.Aa(292);Lb&&Lb.ykj(this.QEf)}this.ls.ajj(this.cpe);this.ls.slj(this.nVf);this.ls.Ikj(this.Juf);this.ls.Ulj(this.Chg);Sa.EwaSettings.ra(259)&&this.ls.ckj(this.tPe);this.a$&&(this.a$.dispose(),this.a$=null);super.dispose()}get title(){return this.Bp}get bsc(){return this.Wge}get linkText(){return this.Dfa}get rWi(){return this.Ofe}get labelId(){return this.kEa}TZc(Lb,Ic){if(!this.fa.pa("SupportsPolicies"))return b.ULS.sendTraceTag(537154523,306,15,"AutoApplyOrRecommendPolicyLabel - Called when SupportPolicies is disabled."),
!1;if(!this.zGd)return b.ULS.sendTraceTag(537154522,306,15,"AutoApplyOrRecommendPolicyLabel - PolicyData hasn't been received yet."),!1;if(Ha.a.lh(Lb))return!1;this.a$||this.Hnd();return this.a$.TZc(Lb,Ic)}rz(){this.raiseEvent("LabelInfoChangedKey")}YTh(){Qa.a.get_instance().Lj(10,()=>{this.ls.egd()})}h6i(){Qa.a.get_instance().Lj(10,()=>{this.ls.R_b(this.p0d);this.ls.YMg(this.JDf);this.ls.XMg(this.JDf);this.ls.SXc(this.I$f);this.ls.Lre(this.yIf);this.$.ea.$t(this.aka);this.ls.fqe(this.cpe);this.ls.Bre(this.nVf);
this.ls.HNg(this.Juf);this.ls.iPg(this.Chg);if(this.fa.pa("SupportsOfficeClientCoauthoring")){const Lb=this.$.da.Aa(292);Lb&&Lb.xNg(this.QEf)}Sa.EwaSettings.ra(259)&&(b.ULS.sendTraceTag(537154521,306,50,"PolicyManagerWrapper: ApplyAutomaticPolicyLabel enabled and registered GetAutoPolicyLabelHandler"),this.ls.VMg(this.tPe));this.FFh()});this.$.gSd("sensitivity",!0)}FFh(){this.fa.pa("SupportsOfficeClientCoauthoring")||this.labelId&&this.labelId.length?this.Qwb():this.aPh(this.$.ya.DocumentHostInfo.TenantId)}Hnd(){this.a$=
new dc(this.w6,this.ls,this.$,this.fa,this.h$)}STf(Lb){if(!this.fa.pa("SupportsPolicies"))return b.ULS.sendTraceTag(537154518,306,10,"PolicyManagerWrapper::RegisterAugmentationLoopAnnotations called when CLP is disabled."),!1;this.a$||this.Hnd();return this.a$.Stc(Lb)}UZc(Lb,Ic){if(!this.fa.pa("SupportsPolicies"))return b.ULS.sendTraceTag(537154517,306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when CLP is disabled."),{returnValue:!1,T6a:!1};if(!this.zGd)return b.ULS.sendTraceTag(537154516,
306,15,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called before PolicyData fetch is complete."),{returnValue:!1,T6a:!0};this.a$||this.Hnd();return this.a$.UZc(Lb,Ic)}aPh(Lb){b.ULS.sendTraceTag(537154514,306,50,`PolicyManagerWrapper: Doing GetPolicyLabelId web service call with tenantId length ${Lb.length}`);const Ic=this.$.oa.xa.Wb();kb(this.$.oa.xa,Lb,Ob=>{this.HPj(Ob)},null,null,null,Ic)}HPj(Lb){b.ULS.sendTraceTag(537154513,306,50,"PolicyManagerWrapper: GetPolicyLabelId web service call was successful");
Lb&&!za.a(Lb)&&(this.kEa=Lb.Result);this.Qwb();this.labelId?b.ULS.sendTraceTag(537154512,306,50,`PolicyManagerWrapper: Fetched LabelId length from custom.xml is ${this.labelId.length}`):b.ULS.sendTraceTag(537154511,306,50,"PolicyManagerWrapper: LabelId is invalid")}Qwb(){this.ls.dgd(this.labelId,void 0,void 0,!1)}fWe(){if(!this.Q_c){this.$.qf();this.Q_c=!0;this.h$.V$e();const Lb={};Lb.hasLabel=!!this.labelId&&0<this.labelId.length;Lb.isProtectedFile=this.fa.pa("ProtectedFile");Lb.SupportsPolicies=
this.fa.pa("SupportsPolicies");Lb.AreLabelsAvailableForDisplay=this.ls.Zga();Lb.SupportsOfficeClientCoauthoring=this.fa.pa("SupportsOfficeClientCoauthoring");Lb.IsAnonymousUser=this.fa.pa("IsAnonymousUser");b.ULS.sendTraceTag(51238051,306,50,`CLPUsage : ${JSON.stringify(Lb)}`)}}BSg(){this.w6.CSg(this.Yxa);this.Yxa=null}Xbi(Lb){for(const Ic of Lb.LabelActions)if(Wa.a.equals(Ic.Name,"ApplyWatermark",!1))return!0;return!1}fIj(Lb){Lb?(new vd(this.$)).kg():b.ULS.sendTraceTag(537154465,306,50,"PolicyManagerWrapper.showBlockApplyLabelDialogDialog: Watermark Dialog box called with showDialog set to false from autoapply.")}applyPolicyLabel(Lb,
Ic,Ob,Kc){const Ac=La.c(this.ls.Zm);if(void 0===Lb||null===Lb)Lb="";const Yc=new ma;Yc.asc=Lb;Yc.q3f=Kc;Yc.YL=Ic;const td=this.$.oa.xa;Ka.a(this.$.userOperationManager,($d,be,ke)=>jb(td,Ac,Lb,this.$.ya.DocumentHostInfo.TenantId,Ic,Ob,ab.b.call(null,this.jOi,$d),null,ke,Yc),$d=>new ub.a(222,0,$d),null);this.AEc=!1;this.GQd=null}Una(){const Lb=this.$.da.Aa(478);return this.ro&&Lb?Lb.ro():!1}}Object(c.a)(wd,"PolicyManagerWrapper",ja.a,[200,201,764]);class Pd extends wb.a{constructor(Lb){super();this.$=
Lb;this.Db()}create(){const Lb=lb.GetServiceTaskFactory.Oa(this.$.da,5,4,this.Xa),Ic=n.AFrameworkApplication.Bd,Ob=n.AFrameworkApplication.fa;db.TaskExtensions.za(Lb,()=>{try{const Kc=new tb.a(()=>new Na(Ob,Ic,n.AFrameworkApplication.sa.HD,this.$.ya.MaxGetPolicyRetries,Z.a.instance.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"))),Ac=new tb.a(()=>new xa(n.AFrameworkApplication.rb,n.AFrameworkApplication.sa,n.AFrameworkApplication.fa,Kc));let Yc=this.$.da.Aa(274);Yc||(Yc=new wd(Kc.value,
Ac.value,Lb.result,this.$,n.AFrameworkApplication.fa),this.$.da.Ha(274,Yc),Yc.initialize());this.nb(Yc)}catch(Kc){throw b.ULS.sendTraceTag(537154525,306,10,`PolicyManager was not created successfully [Exception: ${Kc.toString()}]`),Kc;}},this.la,3)}static ka(Lb){Lb.da.Ha(275,new Pd(Lb))}}Object(c.a)(Pd,"PolicyManagerFactory",wb.a,[]);var ic=a(709),cd=a(189);class Hd{constructor(Lb){this.$=Lb}Hc(){return!1}executeCommand(Lb,Ic,Ob){switch(Ic.command){case ra.a.setSensitivity:return this.$.workbookContext.FileCoauthorable||
(Ob[B.OYc]=this.$.workbookContext.ExclusiveLockId),Lb=n.AFrameworkApplication.rb.Vd(ra.a.setSensitivity,2,Ob),da.Task.Sa(32===Lb);case ra.a.z6:return Lb=n.AFrameworkApplication.rb.Vd(ra.a.z6,2,Ob),da.Task.Sa(32===Lb);case ra.a.A6:return Lb=n.AFrameworkApplication.rb.Vd(ra.a.A6,2,Ob),da.Task.Sa(32===Lb);default:return cd.a(Ic.command)}}wc(Lb,Ic){switch(Ic.command){case ra.a.setSensitivity:case ra.a.z6:case ra.a.A6:return!0;default:return!1}}Nc(Lb,Ic,Ob){switch(Ic){case "PopulateSensitivityFlyout":return 32===
n.AFrameworkApplication.rb.Vd(ra.a.jza,2,Ob);default:return!1}}}Object(c.a)(Hd,"SensitivityCommandHandler",null,[222]);class he extends ic.a{constructor(Lb){super(Lb)}hd(){this.$c([new Hd(this.$)])}static ka(Lb){ic.a.Md(316,new he(Lb))}}Object(c.a)(he,"SensitivityCommandHandlerFactory",ic.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.Policy.Contracts");Type.registerNamespace("Common.App.Policy");bb.main();(()=>{Ga.a.Fa(Lb=>{Pd.ka(Lb);he.ka(Lb)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.policy.js.map/828007fa9fc9548a53fcb98db325b4a9/EwaDSEsNext.policy.js.map