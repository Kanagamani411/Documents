'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[11],{1008:function(r,F,a){a.d(F,"a",function(){return c});r=a(0);class c{}c.Nrb="CommentPaneTextbox";c.HEe="CommentDeleteButton";c.OEe="CommentSaveButton";c.NEe="CommentReplyButton";c.GEe="CommentCancelButton";c.Q3c="CommentTextEntry";c.y7g="TaskPaneClose";c.u7g="CommentPaneCloseButton";c.O3c="CommentTabHelp";Object(r.a)(c,"CommentManagerConstants",null,[])},1349:function(r,F,a){a.d(F,"a",function(){return y});r=
a(0);var c=a(85),b=a(1350),e=a(264),f=a(4),d=a(178),h=a(317),l=a(878),k=a(586),t=a(463),n=a(879),z=a(176),w=a(135),m=a(108),u=a(25);class y{constructor(v){this.ufa=this.Fy=this.bA=null;this.sib=0;this.dDa=this.dA=this.Zb=null;this.Kje=!1;this.dJc=null;this.a5c=!0;this.Ma=v;this.Ag()}get Yg(){return this.bA}get model(){return this.Fy}get vjh(){return f.AFrameworkApplication.vEj}get uSj(){return f.AFrameworkApplication.S7f}get Zkh(){return CommonUIStrings.l_DeleteCommentConfirm}get $cg(){return!1}get vnh(){return!1}get iLi(){return!1}get evj(){return!1}get N2a(){return this.dA}set N2a(v){this.dA=
v}get mode(){return this.sib}set mode(v){v!==this.sib&&(this.sib=v,-1!==this.sib&&(this.bA.F9a(),this.Fy.F9a()))}get Ona(){return this.Kje}set Ona(v){this.Kje=v}get Gij(){return!1}get D9f(){return!0}dispose(){this.bA&&(this.bA.dispose(),this.bA=null);this.Fy&&(this.Fy.dispose(),this.Fy=null);this.ufa&&(this.ufa.dispose(),this.ufa=null)}selectComment(v,C=1){const x=this.Fy.nt(v);!x||2===this.mode&&1!==x.commentType||(this.Fy.selectComment(x),this.ufa.highlightComment(x,!0),this.bA.selectComment(x,
C),1===C&&this.Ona&&this.dA.selectComment(v))}bO(){const v=this.Fy.bO();v&&(this.ufa.highlightComment(v,!0),this.bA.selectComment(v),this.Ona&&this.dA.selectComment(v.id))}PR(){const v=this.Fy.PR();v&&(this.ufa.highlightComment(v,!0),this.bA.selectComment(v),this.Ona&&this.dA.selectComment(v.id))}m2f(v){v?this.selectComment(v,0):this.bA.EAd&&this.MJ().ef.Fl(this.bA.EAd)}av(){this.Fy.av();this.Ona&&this.dA.selectComment(null)}paneClosing(){this.vnh||(2===this.sib?(this.av(),this.deleteComment(this.Fy.rt)):
this.av())}bob(v){if(1===this.mode){v=b.a.Veh(v);var C=({anchor:x}={returnValue:0,anchor:null}).returnValue;if(x&&0===C)this.addComment(v,x);else{switch(C){case 1:v=CommonUIStrings.l_NewCommentError;break;case 2:v=CommonUIStrings.l_NewCommentInvalidContent;break;default:v=CommonUIStrings.l_NewCommentError}var x=new w.StandardDialog;x.Ob=0;x.Zna(CommonUIStrings.l_DefaultDialogTitle,v,null)}}}addComment(v){0!==this.mode&&(this.Fy.IIg(v),this.bA.uXf(v),0===v.commentType||this.iLi||this.selectComment(v.id),
this.Ma.processAction(u.a.KEe,2))}editComment(v,C){1===this.mode&&v&&(this.Fy.H9c(v,C),this.bA.oXf(v),this.selectComment(v.id))}I1g(v){this.Fy.uAe();this.bA.oXf(v)}addReply(v,C){1===this.mode&&(v=this.Fy.fbh(v,C),this.bA.uXf(v),this.selectComment(v.id,0),this.Ma.processAction(u.a.commentReply,2))}deleteComment(v){if(1!==this.mode)if(2===this.mode){if(1!==v.commentType)return;this.mode=1}else return;this.D9f&&1!==v.commentType?(this.dDa=v,v=new w.StandardDialog,v.Ob=4,v.p0(2),v.A$f(CommonUIStrings.l_DefaultDialogTitle,
this.Zkh,Object(c.a)(this,this.clh,"deleteDialogHandler"))):this.A7b(v)}Ag(){this.Ma.Oe(u.a.n7g,m.a.frame,d.ActionManager.gg,64);this.Ma.Oe(u.a.o7g,m.a.frame,d.ActionManager.gg,64);this.Ma.Oe(u.a.p7g,m.a.frame,d.ActionManager.gg,64);this.Ma.Nb(u.a.K3c,m.a.frame,d.ActionManager.gg);this.Ma.Nb(u.a.commentDelete,m.a.frame,d.ActionManager.gg);this.Ma.Nb(u.a.IEe,m.a.frame,d.ActionManager.gg);this.Ma.Oe(u.a.r7g,m.a.frame,d.ActionManager.gg,64);this.Ma.Oe(u.a.s7g,m.a.frame,d.ActionManager.gg,64);this.Ma.Nb(u.a.KEe,
m.a.frame,d.ActionManager.gg);this.Ma.Nb(u.a.LEe,m.a.frame,d.ActionManager.gg);this.Ma.Nb(u.a.commentReply,m.a.frame,d.ActionManager.gg);this.Ma.Oe(u.a.v7g,m.a.frame,d.ActionManager.gg,64);this.Ma.Oe(u.a.x7g,m.a.frame,d.ActionManager.gg,64);this.Ma.Oe(u.a.w7g,m.a.frame,d.ActionManager.gg,64);this.Ma.Nb(u.a.QEe,m.a.frame,d.ActionManager.gg);this.Ma.Nb(u.a.a$a,m.a.frame,()=>{this.a$a();return 32})}clh(v){1===v?this.A7b(this.dDa):(this.dDa&&this.selectComment(this.dDa.id),this.dDa=null)}A7b(v){const C=
v.jk;1===v.commentType?this.Ma.processAction(u.a.K3c,2):this.Ma.processAction(u.a.commentDelete,2);this.dDa=null;this.Ona||this.av();v=this.Fy.deleteComment(v);this.bA.gLd(v);for(let x=0;x<v.length;x++)v[x].dispose();this.m2f(C)}y3b(v,C){0!==this.mode&&(this.Ma.processAction(C?u.a.IEe:u.a.QEe,2),this.Fy.y3b(v,C))}HHa(v){this.Fy.HHa(v);this.mode=1;this.Ma.processAction(u.a.LEe,2)}GHa(v){this.Fy.GHa(v);this.mode=1}U3c(v,C){this.Fy.Cej(v,C)}n7(v,C,x,B,H){return this.bA.n7(v,C,x,B,H)}Ffb(v,C,x,B,H){return this.bA.Ffb(v,
C,x,B,H)}MJ(){var v=this.Zb.IM(e.AFrame.Ro);if(!v){const C=this.Zb.pi(e.AFrame.Ro);v=new h.DOMFocusListing(()=>this.Yg.ks);v.ecb=!0;v.ao(3);v.ao(2);v.ao(4);v.ao(1);v.ao(6);v.ao(5);this.Zb.Asa(()=>this.Yg.ks,C,v);v=this.Zb.IM(e.AFrame.Ro);v.wJb();v.i_=!0;v.NHa=!0;C.yk(this.Zb.S1);C.yk(this.Zb.T1)}return v}a$a(){z.UISurfaces.hH().then(v=>{var C=Object.assign(new l.a,{target:this.evj?'[data-unique-id*="ShowCommentsTopBar"]':'[data-unique-id~="ShowCommentsTopBar"]',showCloseIcon:!0,content:CommonUIStrings.l_DeepLinkedCommentDoesNotExistNotification,
calloutProps:Object.assign(new n.a,{directionalHint:6,gapSpace:4,isBeakVisible:!1})});C=v.callout(C);const x=Object.assign(new t.a,{expirationOptions:Object.assign(new k.a,{displayTimeoutSeconds:10,onExpire:Object(c.a)(this,this.dismiss,"dismiss")})});this.dJc=v.addNotification(C,x)})}dismiss(){z.UISurfaces.hH().then(v=>{v.removeNotification(this.dJc);return this.dJc=null})}static get instance(){return y.La||(y.factory?y.La=y.factory():null)}static set instance(v){y.La=v}}y.La=null;y.factory=null;
Object(r.a)(y,"CommentManager",null,[389,390,2])},1350:function(r,F,a){a.d(F,"a",function(){return e});r=a(0);var c=a(4),b=a(653);class e{constructor(){this.Xe=null;this.Ii=[];this._changes=[];this.YO=this.dga=this.Jl=null}get tAa(){return this.Jl}get rt(){return this.YO}initialize(f){this.Xe=f}dispose(){const f=this.Ii.length;for(let d=0;d<f;d++)this.Ii[d].dispose();this.Ii=[]}F9a(){this.Jl&&this.Jl.F9a();this.dga&&this.dga.F9a()}selectComment(f){this.av();f.wAa=1;this.Jl=f;if(f.jk){var d=Array.indexOf(this.Ii,
f);for(--d;0<=d;d--){const h=this.Ii[d];if(h.id===f.jk){h.wAa=2;this.dga=h;break}}}c.AFrameworkApplication.sa&&c.AFrameworkApplication.sa.Qa.vw&&b.ShyRibbon.fJ(1,0)}bO(){if(!this.Ii.length)return null;let f;f=this.Jl?this.Iwb(this.Jl,!0):this.Ii[0];this.selectComment(f);return f}PR(){if(!this.Ii.length)return null;let f;f=this.Jl?this.Wbc(this.Jl,!0):this.Ii[this.Ii.length-1];this.selectComment(f);return f}av(){this.Jl&&(this.Jl.wAa=0,this.Jl=null);this.dga&&(this.dga.wAa=0,this.dga=null)}H9c(f,d){this.Xe.mode=
3;f.commentType=2;f.idb=0;f.ju=d;this.YO=f}uAe(){this.YO=null;this.Xe.mode=1}fbh(f,d){var h=this.nt(f);this.Xe.mode=2;this.YO=f=a(873).Comment.P5b(c.AFrameworkApplication.userName,f,h.n5a,d);for(d=this.Ii.length-1;0<=d;d--)if(h=this.Ii[d],h.jk===f.jk||h.id===f.jk){Array.insert(this.Ii,d+1,f);break}return f}HHa(f){this.TEe(f,2)}GHa(f){this.TEe(f,4)}deleteComment(f){const d=[],h=Array.indexOf(this.Ii,f);for(;h<this.Ii.length;){const l=this.Ii[h];if(l.id===f.id||l.jk===f.id)Array.removeAt(this.Ii,h),
Array.add(d,l);else break}this.aJb(d,3);-1<Array.indexOf(d,this.YO)&&(this.YO=null,this.Xe.mode=1);return d}y3b(f,d){const h=[];let l=Array.indexOf(this.Ii,f);for(;l<this.Ii.length;){const k=this.Ii[l];if(k.id===f.id||k.jk===f.id)k.done=d,Array.add(h,k),l++;else break}this.aJb(h,d?0:1)}owb(){return Array.clone(this.Ii)}mld(){return!!this.Ii&&!!this.Ii.length}nt(f){for(let d=0;d<this.Ii.length;d++){const h=this.Ii[d];if(h.id===f)return h}return null}Iwb(f,d){f=Array.indexOf(this.Ii,f);return f===this.Ii.length-
1?d?this.Ii[0]:null:this.Ii[f+1]}Wbc(f,d){return(f=Array.indexOf(this.Ii,f))?this.Ii[f-1]:d?this.Ii[this.Ii.length-1]:null}TEe(f,d){const h=[];f.commentType=0;Array.add(h,f);this.aJb(h,d);this.YO=null}static Veh(f){return a(873).Comment.P5b(c.AFrameworkApplication.userName,null,a(873).Comment.A3i,f)}}Object(r.a)(e,"CommentModel",null,[2,483])},1475:function(r,F,a){a.r(F);r=a(512);F=a(778);var c=a(873),b=a(897),e=a(806),f=a(0),d=a(709),h=a(15),l=a(4),k=a(653),t=a(425),n=a(189),z=a(21),w=a(52),m=a(25),
u=a(55),y=a(1),v=a(140),C=a(33);class x{constructor(da,xa,ia){this.excelCommentManager=da;this.commentTaskPane=xa;this.$=ia}dispose(){this.commentTaskPane=this.excelCommentManager=null}Hc(da,xa){da=!0;switch(xa){case 467845448:case -1667294294:case -189526492:case -1213022552:da=this.excelCommentManager.isCommentOperationEnabled(x.D1e(xa));break;case 557817481:da=this.excelCommentManager.Eih&&e.a.Us(this.$);break;case 2041505397:da=!this.excelCommentManager.hasCommentAtActiveCell&&e.a.Us(this.$);
break;case -560890829:da=!this.excelCommentManager.hasCommentAtActiveCell;break;case -865270283:da=!!this.excelCommentManager.Rm&&this.excelCommentManager.Rm.yld&&(!y.EwaSettings.isChangeGateEnabled("OfficeVSO:7063228_SheetProtectionPasteBugFix")||(new v.a(this.$.va)).Pd(1));break;case 1627476102:da=this.excelCommentManager.Rm.WE;break;case -1565161385:da=this.excelCommentManager.Rm.WE&&e.a.Us(this.$)}return!da}executeCommand(da,xa){var ia=!1;da=xa.command;switch(da){case -1460047381:this.$.workbookContext.NavigationContentFound||
(ia=t.a.WI.notificationBar.M$(CommonUIStrings.l_CommentDeepLinkingCommentNotExists,!1),C.a.JBb()?ia.image=2:ia.image=0,t.a.WI.notificationBar.gE(ia));(ia=z.h(this.$).Pb(null))?(this.excelCommentManager.nxc(ia.range),this.$.workbookContext.NavigationContentFound&&this.excelCommentManager.ZIj()):(h.ULS.sendTraceTag(537167438,12,50,"Deep linking to the comments pane since the target cell was not found"),this.n7(xa,!0,this.$.workbookContext.NavigationContentFound));ia=!0;break;case 600686207:case 999391620:this.n7(xa,
!1,!1);ia=!0;break;case -1667294294:ia=this.excelCommentManager.Fcg(x.D1e(da),xa);break;case 467845448:this.excelCommentManager.$kh(xa);ia=!0;break;case -189526492:this.excelCommentManager.ILb(!0);ia=!0;break;case -1213022552:this.excelCommentManager.ILb(!1);ia=!0;break;case 557817481:this.excelCommentManager.v$i();ia=!0;break;case 2041505397:case -560890829:!this.excelCommentManager.Rm.WE&&e.a.Us(this.$)?this.excelCommentManager.Rm.l6c():this.excelCommentManager.Rm.WE&&this.excelCommentManager.Rm.V8b();
ia=!0;break;case -865270283:this.excelCommentManager.Rm.p8c();ia=!0;break;case 634192287:case 2023967433:this.excelCommentManager.Rm.BHh(634192287===da);ia=!0;break;case 1627476102:this.excelCommentManager.Rm.QJj();ia=!0;break;case -2078523262:this.excelCommentManager.Rm.showOrHideAllNotes();ia=!0;break;case -1565161385:this.excelCommentManager.Rm.I$g(),ia=!0}x.MLi.has(da)&&l.AFrameworkApplication.sa.Qa.vw&&k.ShyRibbon.fJ(1,2);return ia?u.Task.Sa(!0):n.a(da)}wc(da,xa){switch(xa.command){case -1460047381:case 600686207:case 999391620:case -1667294294:case 467845448:case -189526492:case -1213022552:case 557817481:case 2041505397:case -560890829:case -865270283:case 634192287:case 2023967433:case 1627476102:case -2078523262:case -1565161385:da=
!0;break;default:da=!1}return da}Nc(){return!1}n7(da,xa,ia){this.pEi(da,xa,ia);this.excelCommentManager.VI.K_(m.a.Ffb,null,2,null,null)}pEi(da,xa,ia){const Ma={};Ma.a=this.$.ya.UserSessionId;Ma.b=1===da.method&&!da.tabName;Ma.c=!this.commentTaskPane.isVisible;Ma.d=xa;Ma.e=ia;w.b().Se(31,Ma)}static D1e(da){switch(da){case -1667294294:return 1;case 467845448:return 3;case -189526492:return 4;case -1213022552:return 5;default:return 0}}}x.MLi=new Set([557817481,2041505397,-560890829,-865270283,634192287,
2023967433,1627476102,-2078523262,-1565161385]);Object(f.a)(x,"CommentPaneCommandHandler",null,[222,2]);var B=a(50),H=a(422),I=a(37);class U extends d.a{constructor(da){super(da);this.GY=null;this.hd()}hd(){if(!this.GY){this.GY=B.GetServiceTaskFactory.create(this.$.da,89,this.la,this.Xa);var da=B.GetServiceTaskFactory.create(this.$.da,155,this.la,this.Xa);const xa=H.a(this.$);da=[da,this.GY,xa,B.GetServiceTaskFactory.Oa(this.$.da,349,350,this.Xa)];I.TaskExtensions.za(I.TaskExtensions.Fd(da,this.la),
()=>{const ia=this.GY.result;C.a.Ad(this.$)||xa.result.GQ(ia);this.$c([new x(ia.excelCommentManager,ia,this.$)])},this.la)}}static ka(da){da.da.Ha(81,new U(da))}}Object(f.a)(U,"CommentPaneCommandHandlerFactory",d.a,[]);d=a(226);var S=a(7),G=a(1346),D=a(239);class E{}E.Quh="ewa-ctp";E.X2="CommentPane";Object(f.a)(E,"CssClassNames",null,[]);var N=a(5),M=a(263);class L{constructor(){this.type="SharedCommentsTaskPaneProps";this.focusCallback=null}}Object(f.a)(L,"ExcelSharedCommentsTaskPaneProps",null,
[]);var aa=a(757),V=a(250),P=a(12),ba=a(13),Y=a(719);const Z=a(19).a.LAh;class ea extends D.a{constructor(da,xa,ia){super(da);this.Wmf=this.wBb=!1;this.Hv=0;this.fxa=!1;this.CDa=null;this.uc=(Ma,Ta)=>{Ta.Bf||(this.excelCommentManager.endCommentSession(!0),this.excelCommentManager.N0a())};this.$=xa;this.taskPaneManager=ia;M.a(xa).Yh(this);this.$.nj(this.uc);C.a.Ad(this.$)&&(this.isVisible=!1)}qT(da){this.get_events().addHandler("commentTaskPaneRemoved",da)}mW(da){this.get_events().removeHandler("commentTaskPaneRemoved",
da)}kE(da){this.addHandler("commentTaskPaneVilibilityChanged",da)}BF(da){this.removeHandler("commentTaskPaneVilibilityChanged",da)}get isVisible(){return C.a.Ad(this.$)?this.Wmf:super.isVisible}set isVisible(da){if(C.a.Ad(this.$))this.Wmf=da,this.wBb&&this.raiseEvent("commentTaskPaneVilibilityChanged");else{const xa=super.isVisible;super.isVisible=da;xa!==da&&this.raiseEvent("commentTaskPaneVilibilityChanged")}}get Ff(){return this.isVisible}get Xd(){return V.a.z7g}get Jh(){return 7}get ek(){return Z}get AQ(){return ba.a.instance.ga(1071)}get titleText(){return ba.a.instance.ga(1071)}get Vp(){return 300}get isResizable(){return!1}get jc(){return this.domElement}get height(){return this.taskPaneManager.rO.offsetHeight}get excelCommentManager(){return this.CDa}get nr(){return P.DOMElementExtensions.nr+
",div[tabindex]"}get Vzi(){return this.taskPaneManager.Vua(this.jc,this.titleText,this.Vp,this.isResizable,()=>{this.isVisible=this.wBb=!0},()=>{this.wBb=this.isVisible=!1},()=>{this.isVisible=!0},()=>{this.isVisible=!1},this.Vp)}get FB(){return C.a.qmf(this.$)?Object(S.a)(new G.a,{title:this.titleText,width:this.Vp,hideHeader:!1,location:2,contentProps:Object(S.a)(new L,{focusCallback:()=>{this.raiseEvent("commentTaskPaneVilibilityChanged")}}),enableResize:this.isResizable,onOpen:()=>{this.isVisible=
this.wBb=!0},onClose:()=>{this.wBb=this.isVisible=!1},onShow:()=>{this.isVisible=!0},onHide:()=>{this.isVisible=!1},minResizeWidth:this.Vp}):this.Vzi}Cq(){return C.a.Ad(this.$)?this.fxa:this.fxa||!y.EwaSettings.isChangeGateEnabled("OfficeVSO:4465901_HideCommentsTaskPaneButtonOnClosePane")&&1<this.taskPaneManager.GD.length}wt(){return this.fxa}IV(da){this.excelCommentManager.XRi(da)}dispose(){this.$&&this.$.ol(this.uc);this.CDa=this.taskPaneManager=this.$=null;super.dispose()}ag(da,xa){return this.excelCommentManager.setFocus(da,
xa)}sh(da){return P.DOMElementExtensions.Af(this.jc,da)}rj(){}dk(){}TU(da,xa){const ia=P.DOMElementExtensions.rm(this.domElement.querySelectorAll(this.nr));return da.Ea.target===ia&&da.Ea.shiftKey&&(da=P.DOMElementExtensions.PA(xa.querySelectorAll(this.nr)))?(P.DOMElementExtensions.setFocus(da),!0):!1}Kg(da){this.fxa=da;const xa=this.taskPaneManager;if(C.a.Ad(this.$))da?xa.q6("CommentTaskPane",this.FB):xa.hideTaskPane("CommentTaskPane");else{var ia=P.DOMElementExtensions.isVisible(xa.iL),Ma=1===xa.GD.length&&
!!xa.Ch&&xa.Ch.taskPane===this;da&&!ia?(xa.HB(),h.ULS.sendTraceTag(537167436,12,50,"Comment pane opened.")):!da&&Ma?(xa.HB(),this.raiseEvent("commentTaskPaneVilibilityChanged")):this.isVisible=da;da&&0<xa.GD.length&&(!xa.Ch||7!==xa.Ch.taskPane.Jh||xa.isCollapsed)&&xa.hI(this,!0);this.$.qf()}}static awe(da,xa,ia){let Ma=null;da.Jb&&(Ma=da.Jb.zg("ComponentAttach","AttachCommentTaskPane"),Ma.start());var Ta=da.Bb,Da=document.getElementById(Ta+N.a.P3c);Da||(Da=ea.gYg(da),C.a.Ad(da)||(Ta=document.getElementById(Ta+
N.a.AV),void 0!==Ta&&null!==Ta?Ta.appendChild(Da):h.ULS.sendTraceTag(537167435,0,10,`CommentTaskPane.AttachCommentTaskPane: couldn't find novTaskPaneBodyDiv. IsAppUnloading: ${da.YC}`)));Ta=da.da;xa=Ta.Aa(52)||Ta.Ha(52,new ea(Da,da,xa));xa.excelCommentManager||(Da=z.h(da),xa.CDa=aa.ExcelCommentManager.ka(da,Da,Da.ha,xa,da.ea,ia));Ma&&Ma.stop();return xa}static gYg(da){return Y.a("div",da.Bb+N.a.P3c,E.Quh)}}Object(f.a)(ea,"CommentTaskPane",D.a,[154,2,262,54]);class ra extends d.a{constructor(da){super();
this.Yg=this.$h=null;this.$=da;this.Db()}get pD(){if(!this.$h)if(y.EwaSettings.isChangeGateEnabled("OfficeVSO:7536466_NoteManagerNullReferenceFix")){const da=B.GetServiceTaskFactory.Oa(this.$.da,389,390,this.Xa),xa=H.a(this.$);this.$h=I.TaskExtensions.za(I.TaskExtensions.Fd([xa,da],this.la),()=>{this.Yg=ea.awe(this.$,xa.result,da.result)},this.la,3)}else this.$h=I.TaskExtensions.za(H.a(this.$),da=>{this.Yg=ea.awe(this.$,da.result,null)},this.la,3);return this.$h}BAi(){const da=B.GetServiceTaskFactory.create(this.$.da,
203,this.la,this.Xa),xa=B.GetServiceTaskFactory.create(this.$.da,155,this.la,this.Xa);return[da,xa]}create(){I.TaskExtensions.za(I.TaskExtensions.ts(I.TaskExtensions.Fd(this.BAi(),this.la),()=>this.pD,this.la),()=>{this.nb(this.Yg)},this.la,3)}dispose(){this.Yg=this.$h=this.$=null;super.dispose()}static ka(da){da.da.Ha(89,new ra(da))}}Object(f.a)(ra,"CommentTaskPaneFactory",d.a,[]);var O=a(9);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.CommentPane");Type.registerNamespace("_Ewa");
r.a.Bi(".ewa-ctp .CommentPane{background-color:#fff;overflow:auto;z-index:991}.ewa-ctp .CommentPane p{margin:0}.ConvertCommentText{max-width:300px}");Type.registerNamespace("Common.Comments");Type.registerNamespace("Common.App.CommentsSmartReply");F.a.prototype.toString=c.Comment.prototype.toString;b.a.prototype.toString=c.Comment.prototype.toString;e.a.prototype.toString=c.Comment.prototype.toString;(()=>{O.a.Fa(da=>{ra.ka(da);U.ka(da)})})()},757:function(r,F,a){a.r(F);var c=a(0),b=a(7),e=a(15),
f=a(1349),d=a(174),h=a(27),l=a(110),k=a(14),t=a(108),n=a(1422),z=a(4),w=a(192),m=a(421);class u{}u.beginDraftingAsync="OSC:BDA";u.YIh="OSC:FEQ";u.selectComment="OSC:SC";Object(c.a)(u,"CommentTaskNames",null,[]);class y{constructor(va){this.rFi=va;this.jFi=[]}get handler(){return this.rFi}get yU(){return this.jFi}}Object(c.a)(y,"RegisteredListener",null,[]);class v{constructor(va,rb){this.type=0;this.payload=null;this.type=va;this.payload=rb}}Object(c.a)(v,"OfficeSharedCommentsEvent",null,[959]);class C{constructor(){this.eventType=
0;this.newViewContainer=null;this.viewContainerVisibilityState=1}}Object(c.a)(C,"ViewContainerEvent",null,[959]);var x=a(305);class B{constructor(va){this.Vxd=!1;this.xV=new w.a;this.Fmc=va}Rfj(va){va=new y(va);this.xV.add(va)}nig(va){for(let rb=0;rb<this.xV.count;++rb)if(this.xV.ma(rb).handler===va){this.xV.removeAt(rb);break}}e0(va=!1){const rb=()=>{if(z.AFrameworkApplication.rg)e.ULS.sendTraceTag(40420181,201,50,"Skipped processing comment pane events since app is shutting down.");else for(let hd=
0;hd<this.xV.count;++hd){const xd=this.xV.ma(hd);for(;0<xd.yU.length;){var fc=Array.dequeue(xd.yU);if(Object(m.a)(C,fc)){var Nc=xd.handler;Nc(fc)}else Object(m.a)(v,fc)&&(Nc=xd.handler,Nc(fc.type,fc.payload))}}};va?rb():this.Vxd||(this.Vxd=!0,x.a.QYa(this.Fmc,()=>{rb();this.Vxd=!1},u.YIh))}}Object(c.a)(B,"GenericEventHost",null,[]);class H{constructor(){this.numberOfThreads=this.numberOfComments=0;this.contextDetails=this.changes=this.commentId=this.comment=this.comments=null;this.virtualized=!1;
this.index=0;this.tempId=this.threadIds=null;this.errorType=0;this.tasks=null;this.richTextCapabilityFlags=this.modelCapabilityFlags=0;this.rehydrationDrafts=this.contextDrafts=this.smartReplies=null}}Object(c.a)(H,"BasicEventPayload",null,[960]);class I{constructor(va){this.nextPopulatedContextDetails=0;this.commentThreadCounts=null;this.isReadOnly=!1;this.isReadOnly=va}}Object(c.a)(I,"CommentContextDetails",null,[]);class U{constructor(){this.numberOfThreads=this.numberOfComments=0;this.contextDetails=
null;this.selectedThreadIndex=0;this.virtualized=!1;this.rehydrationDrafts=this.contextDrafts=null}}Object(c.a)(U,"ContextChangeWithSelectedThreadIndex",null,[960]);class S{constructor(){this.tasks=this.comments=null}}Object(c.a)(S,"LoadCommentsNoVirtualization",null,[960]);class G extends B{constructor(va){super(va);this.Eie=0}lgj(va,rb,fc,Nc,hd,xd,ae=0){va=new y(va);xd&&Array.enqueue(va.yU,this.rHe(xd,this.Eie));xd=rb?rb.length:0;Array.enqueue(va.yU,this.xHe(xd,fc,Nc,ae,null));xd&&Array.enqueue(va.yU,
this.hIe(rb,hd));this.xV.add(va);this.e0()}rig(va){this.nig(va)}mvj(va,rb,fc,Nc=0,hd=null){this.uka(this.xHe(va,rb,fc,Nc,hd));this.e0()}nvj(va,rb,fc,Nc,hd=0,xd=null){this.uka(this.wch(va,rb,fc,Nc,hd,xd));this.e0()}ovj(va,rb,fc){this.uka(this.zch(va,rb,fc));this.e0()}Jvj(va,rb){this.uka(this.hIe(va,rb));this.e0()}selectComment(va){this.uka(this.YIe(va,6));this.e0()}highlightComment(va){this.uka(this.YIe(va,7));this.e0()}e1j(va,rb){this.uka(this.bfh(va,rb));this.e0()}$0j(va){this.uka(this.rHe(va,this.Eie));
this.e0()}MGd(va,rb){this.uka(this.hhh(va,rb));this.e0()}rHe(va,rb=0){const fc=new H;fc.modelCapabilityFlags=va;fc.richTextCapabilityFlags=rb;return new v(12,fc)}xHe(va,rb,fc,Nc,hd=null){const xd=new H;xd.numberOfComments=va;xd.numberOfThreads=rb;xd.contextDetails=Object.assign(new I(fc),{nextPopulatedContextDetails:Nc});xd.contextDrafts=hd;xd.rehydrationDrafts=null;return new v(0,xd)}wch(va,rb,fc,Nc,hd,xd=null){const ae=new U;ae.numberOfComments=va;ae.numberOfThreads=rb;ae.selectedThreadIndex=fc;
ae.contextDetails=Object.assign(new I(Nc),{nextPopulatedContextDetails:hd});ae.contextDrafts=xd;ae.rehydrationDrafts=null;return new v(0,ae)}zch(va,rb,fc){const Nc=new H;Nc.comments=va;Nc.numberOfThreads=rb;Nc.tasks=fc;return new v(2,Nc)}hIe(va,rb){const fc=new S;fc.comments=va;fc.tasks=rb;return new v(1,fc)}YIe(va,rb){const fc=new H;fc.commentId="";va&&(fc.commentId=va);return new v(rb,fc)}bfh(va,rb){const fc=new H;fc.changes=[];fc.contextDetails=Object.assign(new I(rb),{nextPopulatedContextDetails:va});
return new v(10,fc)}hhh(va,rb){const fc=new H;fc.commentId=va;fc.smartReplies=rb;return new v(15,fc)}uka(va){for(let rb=0;rb<this.xV.count;++rb)Array.enqueue(this.xV.ma(rb).yU,va)}}Object(c.a)(G,"OfficeSharedCommentsEventHost",B,[165]);var D=a(104),E=a(85);class N{constructor(){this.actionBehavior=this.actionType=0}}Object(c.a)(N,"CommentUIActionPayload",null,[]);var M=a(259);class L extends M.ScriptSharpLegacyMap{constructor(){super()}}Object(c.a)(L,"UIntDictionary",M.ScriptSharpLegacyMap,[]);class aa{constructor(va,
rb){this.Ma=va;this.ECa=rb;this.EGc=new L;for(let fc of this.ECa)this.EGc.ia(fc.value.canvasActionId,fc.key),va=fc.value,va.delayActionsUntilRegistration||this.Nb(va)}Nb(va){va.withFlags?this.Ma.Oe(va.canvasActionId,va.canvasContextId,Object(E.a)(this,this.actionHandler,"actionHandler"),97):this.Ma.Nb(va.canvasActionId,va.canvasContextId,Object(E.a)(this,this.actionHandler,"actionHandler"))}sQa(va,rb){this.ECa.hb(va)&&(this.ECa.ma(va).delayActionsUntilRegistration&&this.Nb(this.ECa.ma(va)),this.ECa.ma(va).registeredCallback=
rb)}K_(va,rb,fc,Nc,hd){return this.actionHandler(va,rb,fc,Nc,hd)}actionHandler(va,rb,fc,Nc,hd){if(this.EGc.hb(va)){var xd=this.EGc.ma(va);if(!this.ECa.hb(xd))return 8;const ae=this.ECa.ma(xd);if(ae.preCallback){const Wd=ae.preCallback(va,rb,fc,Nc,hd);if(2!==Wd)return Wd}if(!ae.registeredCallback)return 1===fc?8:2;xd=Object.assign(new N,{actionType:xd});1===fc&&(xd.actionBehavior=1);xd=ae.registeredCallback(xd);return ae.postCallback?ae.postCallback(xd,va,rb,fc,Nc,hd):xd?32:8}return 2}}Object(c.a)(aa,
"OfficeSharedCommentsActionHost",null,[900]);var V=a(545);class P{static Gcc(va){return va===P.create?0:va===P.reply?1:va===P.edit?2:va===P.metadata?3:null}}P.create="CREATE";P.reply="REPLY";P.edit="EDIT";P.metadata="METADATA";Object(c.a)(P,"CommentSessionType",null,[]);class ba{constructor(va,rb){this.CommentId=va;this.ResolveState=rb}}Object(c.a)(ba,"CommentProperties",null,[]);var Y=a(264),Z=a(268),ea=a(25),ra=a(178);class O{}Object(c.a)(O,"CommentActivityData",null,[]);var da=a(151);class xa{constructor(va,
rb,fc,Nc,hd,xd,ae,Wd,Ne,Ue=null,xe=null){this.joe={["CancelCommentCreateThreadAction"]:ea.a.RSd,["CommitComment"]:ea.a.SSd,["CommitDraftAction"]:ea.a.TSd,["CommitDraftCreateAction"]:ea.a.Tyc,["CommitDraftEditAction"]:ea.a.Uyc,["CommitDraftReplyAction"]:ea.a.Syc,["CreateReplyAction"]:ea.a.Syc,["CreateReplyWithMentions"]:ea.a.USd,["CreateReplyWithTaskAssigned"]:ea.a.VSd,["CreateThreadAction"]:ea.a.Tyc,["CreateThreadWithMentions"]:ea.a.WSd,["CreateThreadWithTaskAssigned"]:ea.a.XSd,["DeletePostAction"]:ea.a.YSd,
["DeleteThreadAction"]:ea.a.ZSd,["DeleteThreadWithTask"]:ea.a.$Sd,["DiscardDraftAsync"]:ea.a.aTd,["PresentLinkToCommentAction"]:ea.a.G7f,["ResolveThreadAction"]:ea.a.eTd,["ResolveThreadWithTask"]:ea.a.fTd,["ReopenThreadAction"]:ea.a.bTd,["ReopenThreadWithTask"]:ea.a.cTd,["RequestInitCommentSession"]:ea.a.dTd,["SelectCommentAction"]:ea.a.gTd,["UpdateCommentBodyAction"]:ea.a.Uyc};this.dataCenter=this.ring=this.sessionId=this.releaseChannel=this.releaseAudience=this.appVersion=this.appName=null;this.disableUpload=
!1;this.sovereignEnvironmentName=null;this.appName=va;this.appVersion=rb;this.releaseAudience=fc;this.releaseChannel=Nc;this.sessionId=hd;this.ring=xd;this.dataCenter=ae;this.disableUpload=Wd;this.sovereignEnvironmentName=xe;this.Ma=Ne;this.Fge=Ue;this.Iii()}Iii(){this.Ma.Nb(ea.a.RSd,t.a.frame,ra.ActionManager.gg);this.Ma.Nb(ea.a.SSd,t.a.frame,ra.ActionManager.gg);this.Ma.Nb(ea.a.TSd,t.a.frame,ra.ActionManager.gg);this.Ma.Nb(ea.a.Syc,t.a.frame,ra.ActionManager.gg);this.Ma.Nb(ea.a.USd,t.a.frame,ra.ActionManager.gg);
this.Ma.Nb(ea.a.VSd,t.a.frame,ra.ActionManager.gg);this.Ma.Nb(ea.a.Tyc,t.a.frame,ra.ActionManager.gg);this.Ma.Nb(ea.a.WSd,t.a.frame,ra.ActionManager.gg);this.Ma.Nb(ea.a.XSd,t.a.frame,ra.ActionManager.gg);this.Ma.Nb(ea.a.YSd,t.a.frame,ra.ActionManager.gg);this.Ma.Nb(ea.a.ZSd,t.a.frame,ra.ActionManager.gg);this.Ma.Nb(ea.a.$Sd,t.a.frame,ra.ActionManager.gg);this.Ma.Nb(ea.a.aTd,t.a.frame,ra.ActionManager.gg);this.Ma.Nb(ea.a.G7f,t.a.frame,ra.ActionManager.gg);this.Ma.Nb(ea.a.eTd,t.a.frame,ra.ActionManager.gg);
this.Ma.Nb(ea.a.fTd,t.a.frame,ra.ActionManager.gg);this.Ma.Nb(ea.a.bTd,t.a.frame,ra.ActionManager.gg);this.Ma.Nb(ea.a.cTd,t.a.frame,ra.ActionManager.gg);this.Ma.Nb(ea.a.dTd,t.a.frame,ra.ActionManager.gg);this.Ma.Nb(ea.a.gTd,t.a.frame,ra.ActionManager.gg);this.Ma.Nb(ea.a.Uyc,t.a.frame,ra.ActionManager.gg)}sendULSTrace(va,rb,fc,Nc){e.ULS.sendTraceTag(va,rb,fc,Nc)}recordActivity(va){this.joe[va]&&this.Ma.processAction(this.joe[va],2)}sendOtelEvent(va){da.a.sendOtelEvent(va)}recordPerfData(va,rb){this.Fge&&
(va=Object.assign(new O,{durationMs:rb,name:va}),this.Fge.ZH(va))}}Object(c.a)(xa,"OfficeSharedCommentsTelemetry",null,[]);var ia=a(97),Ma=a(84),Ta=a(6),Da=a(38),fa=a(60);const ua=(va,rb,fc,Nc,hd,xd,ae,Wd,Ne,Ue=null)=>{Ue=va.Na(9,Ue);Ue.options=rb;Ue.content=fc;Ue.anchor=Nc;Ue.commentId=hd;return fa.g(va,"ApplyComment",Ue,xd,ae,Wd,Ne,0)},Fa=(va,rb,fc,Nc,hd,xd,ae,Wd,Ne,Ue,xe,Ze,tf=null)=>{tf=va.Na(9,tf);tf.options=rb;tf.content=fc;tf.anchor=Nc;tf.commentId=hd;tf.parentCommentId=xd;tf.isResolved=ae;
tf.taskHistoryRecords=Wd;return fa.g(va,"ApplyThreadedComment",tf,Ne,Ue,xe,Ze,0)},ca=(va,rb,fc,Nc,hd,xd,ae=null)=>{ae=va.Na(9,ae);ae.commentId=rb;return fa.g(va,"UpgradeLegacyComments",ae,fc,Nc,hd,xd,0)},ka=(va,rb,fc,Nc,hd,xd,ae,Wd=null)=>{Wd=va.Na(1,Wd);Wd.activeCell=rb;Wd.findNext=fc;return fa.g(va,"FindNextOrPreviousComment",Wd,Nc,hd,xd,ae,4)},Ca=(va,rb,fc,Nc,hd,xd,ae,Wd=null)=>{Wd=va.Na(1,Wd);Wd.activeCell=rb;Wd.findNext=fc;return fa.g(va,"FindNextOrPreviousNoteCrossSheet",Wd,Nc,hd,xd,ae,4)},
fb=(va,rb,fc,Nc,hd,xd,ae,Wd,Ne,Ue=null)=>{Ue=va.Na(1,Ue);Ue.objectMetadataType=rb;Ue.currentSheetName=fc;Ue.version=Nc;Ue.startIndex=hd;return fa.g(va,"GetObjectMetadataFromStartIndex",Ue,xd,ae,Wd,Ne,4)};var yb=a(89),mb=a(266),nb=a(150),X=a(190);class R{static get T$g(){return nb.a.zq(R.qGe,X.a.Ta(438),X.a.ga(1318))}static get u$g(){return nb.a.zq(R.qGe,X.a.Ta(439),X.a.ga(1318))}}R.qGe="<div class='WACDialogRowNoBreak' id='CCHeaderId'> <label id='ConvertTextContentId' class='ConvertCommentText WACDialogLabel' >{0}</label> </div> <div class='WACDialogRowNoBreak' id='CCHeaderId'> <a id='ConvertHelpLinkId' class='ConvertHelpLink' href=\"#\" target='_self' >{1}</a> </div>";
Object(c.a)(R,"ConvertLegacyCommentDialogHtml",null,[]);var wa=a(560),na=a(11),Ba=a(13);class Ra extends mb.a{constructor(va,rb,fc,Nc){super(va);this.bB=null;this.F$g=hd=>{1===hd?(e.ULS.sendTraceTag(25249740,0,50,"ConvertLegacyCommentDialog Continue button pressed."),void 0!==this.dcb&&null!==this.dcb&&this.dcb("InitCommentSession was cancelled by LegacyConvertDialog (Convert Comments)."),this.Qf.upgradeLegacyComments(this.commentId)):(e.ULS.sendTraceTag(25249741,0,50,"ConvertLegacyCommentDialog Cancel button pressed."),
void 0!==this.dcb&&null!==this.dcb&&this.dcb("InitCommentSession was cancelled by LegacyConvertDialog (Cancel)."))};this.Dca=()=>{na.HelperMethods.LV(this.$.WF,"XLWAEndUser_CommentsConvertLegacy",this.$.mS)};this.Qf=rb;this.dcb=Nc;this.commentId=fc;this.og=this.MU();va=this.$fd();this.p0(1);this.tc(1,Ba.a.instance.Ta(440));this.initializeAndShow(va,this.F$g,null);(va=document.getElementById("ConvertHelpLinkId"))?(this.bB=wa.a.create(va),this.bB.m2(this.Dca)):e.ULS.sendTraceTag(537167434,0,10,"ConvertLegacyComment Dialog help link not found.");
e.ULS.sendTraceTag(537167433,0,50,"ConvertLegacyComment Dialog opened.")}get kc(){return"ConvertLegacyCommentDialog"}dispose(){this.bB&&this.bB.tda(this.Dca);yb.a.pc([this.bB]);this.bB=null;super.dispose()}MU(){return this.commentId?R.T$g:R.u$g}$fd(){return Ba.a.instance.Ta(this.commentId?436:437)}}Object(c.a)(Ra,"ConvertLegacyCommentDialog",mb.a,[]);var qa=a(778);class La{constructor(){this.OJc={};this.OJc.ops=[]}insertImage(va,rb){va=this.m6c(va,{});const fc={};fc.base64=rb.base64;rb={};rb.image=
fc;va.optional=rb;Array.add(this.OJc.ops,va)}insertHyperLink(va,rb){const fc={};fc.link=rb.link;this.qBj(fc,rb);Array.add(this.OJc.ops,this.m6c(va,fc))}m6c(va,rb){const fc={};fc.insert=va;fc.attributes=rb;return fc}qBj(va,rb){this.PRa(rb.weight>=La.HIi,va,"weight",rb.weight);this.PRa(rb.italic,va,"italic",!0);this.PRa(rb.underline,va,"underline",!0);this.PRa(rb.strikethrough,va,"strikethrough",!0);this.PRa(!!rb.highlight,va,"highlight",rb.highlight);this.PRa(!!rb.color,va,"color",rb.color);this.PRa(!!rb.paragraph,
va,"paragraph",rb.paragraph)}PRa(va,rb,fc,Nc){va&&(rb[fc]=Nc)}static k2e(va){return Sys.Serialization.JavaScriptSerializer.deserialize(va,!0)}}La.HIi=700;Object(c.a)(La,"DeltaFormatCreator",null,[191]);class Yb{static get BHi(){return 50}static $_h(va){if(""===va)return"";let rb=0,fc="";try{const Nc=La.k2e(va);for(const hd of Nc.ops)if(Yb.Zli(hd))rb||(fc+=Yb.qVh(hd.attributes.atmention.fullName)),rb+=1;else{const xd=hd.insert?hd.insert:"";" "!==xd&&0<xd.length&&(rb=0,fc+=xd)}}catch(Nc){e.ULS.sendTraceTag(558428681,
327,10,"Comment formatString could not be deserialized since it is not in a proper Delta Format.")}return fc}static TRh(va){va=Yb.$_h(va);return 0<va.length&&va.split(" ").length<=Yb.BHi?va:null}static qVh(va){let rb="";va&&(va=va.split(" "),0<va.length&&(rb=va[0]));return rb}static Zli(va){return!!va.attributes&&!!va.attributes.atmention}}Object(c.a)(Yb,"BaseCommentSmartReplyHelpers",null,[]);class mc extends Yb{constructor(){super()}static Ffd(va,rb,fc=!1){if(!va)return null;va=va.text&&0<va.text.length?
va.text[0]:"";rb=!rb||!rb.jk||""===rb.jk;return 0<va.length&&rb&&!fc?Yb.TRh(va):null}}Object(c.a)(mc,"CommentSmartReplyHelpers",Yb,[]);class Zb{constructor(){this.insertIndex=0;this.author=this.updatedSessionParams=this.anchorHintText=this.authorIdentity=this.authorName=null}}Object(c.a)(Zb,"InitCommentSessionResult",null,[]);class qb extends Zb{constructor(){super();this.updatedDraftSessionConfiguration=null}}Object(c.a)(qb,"BeginDraftingHostResult",Zb,[]);var Ha=a(574);class Ya{constructor(va,rb=
"",fc="",Nc="",hd=!1){this.Email=this.DisplayName=this.Provider=this.UserId=null;this.IsCurrentUser=!1;this.UserId=va;this.Provider=rb;this.DisplayName=fc;this.Email=Nc;this.IsCurrentUser=hd}}Object(c.a)(Ya,"OfficeSharedCommentUser",null,[]);var Gb=a(83),Ja=a(94),Na=a(1),Qa=a(101);class Oa{constructor(va,rb,fc,Nc,hd,xd,ae,Wd,Ne=null){this.Qf=va;this.F7f=rb;this.VDj=fc;this.taskManager=Nc;this.$=hd;this.u6=xd;this.Ge=ae;this.Wsa=Wd;this.PEe=Ne}beginDraftingAsync(va){if(!va)return new Promise((hd,xd)=>
{xd(x.a.dt(-2130915327))});const rb=new qb;var fc=P.Gcc(va.sessionType);if(void 0===fc||null===fc)return new Promise((hd,xd)=>{xd(x.a.dt(-2130915317))});const Nc=this.Qf.mode;if(1!==Nc)return e.ULS.sendTraceTag(537167432,327,10,`Create InitCommentSession Failed. CommentingMode=${Nc}`),new Promise((hd,xd)=>{xd(x.a.dt(-2130915325))});0===fc&&this.Qf.hasCommentAtActiveCell&&(e.ULS.sendTraceTag(537167431,12,50,"Converting Create into Reply"),fc=this.Qf.sC,va.sessionType=P.reply,va.threadId=fc.jk||fc.id,
rb.updatedSessionParams=va,fc=1);ia.FocusManager.instance().Qj(Y.AFrame.Ro);switch(fc){case 0:fc=this.M5b(rb,()=>{rb.insertIndex=this.Qf.Afi(va)});break;case 1:if(!va.threadId||!va.threadId.length)return new Promise((Wd,Ne)=>{Ne(x.a.dt(-2130915324))});const hd=this.Ge.nt(va.threadId);if(null===hd||void 0===hd?0:hd.done)return new Promise((Wd,Ne)=>{Ne(x.a.dt(-2130915320))});if(this.Qf.prd(va.threadId))return this.c8i(va.threadId);const xd=Na.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartRepliesIsEnabled",
!1),ae=xd?this.Ge.Iwb(hd,!1):null;fc=this.M5b(rb,()=>{rb.insertIndex=this.Qf.ggi(va.threadId,va);if(xd&&this.PEe&&hd){const Wd=mc.Ffd(hd,ae,hd.isCurrentUser);Wd&&this.PEe.invoke(va.threadId,Wd)}});break;case 2:if(!va.commentId||!va.commentId.length)return new Promise((Wd,Ne)=>{Ne(x.a.dt(-2130915324))});if(!this.Ge.nt(va.commentId))return new Promise((Wd,Ne)=>{Ne(x.a.dt(-2130915323))});fc=this.M5b(rb,()=>{rb.insertIndex=this.Qf.Cfi(va.commentId,va)});break;case 3:e.ULS.shipAssertTag(537167430,12,this.Qf.GAb,
"Metadata session type start without document tasks enabled.");if(this.Qf.prd(va.threadId))throw new Ra(this.$,this.Qf,va.threadId,null),x.a.dt(-2130915316);fc=this.M5b(rb,()=>{rb.insertIndex=this.Qf.Sfi(va.threadId,va)});break;default:return new Promise((Wd,Ne)=>{Ne(x.a.dt(-2130915322))})}return fc}commit(va,rb,fc){const Nc=this.Ge.rt;if(!Nc)throw e.ULS.sendTraceTag(537167429,12,10,"VSO3351297: InvalidCommentDataState- Commiting a draft when InProgressComment is null"),x.a.dt(-2130915320);const hd=
Nc.ju;if(!hd)throw e.ULS.sendTraceTag(537167428,12,10,"VSO3351297: InvalidCommentDataState- Commiting a draft when DraftSessionConfiguration is null"),x.a.dt(-2130915320);const xd=P.Gcc(hd.sessionType);if(void 0===xd||null===xd)throw x.a.dt(-2130915317);if(va!==hd.draftId)throw x.a.dt(-2130915327);rb&&(rb.endsWith('\\n"}]}')?rb=rb.substring(0,rb.length-6)+'"}]}':e.ULS.sendTraceTag(537167427,12,10,"Comment delta text is expected to end with a newline character."));Nc.text=3===xd?null:[rb];fc&&fc.Task&&
this.Qf.U3c(Nc,fc.Task);switch(xd){case 0:this.Qf.HHa(Nc);this.wgg(fc);this.vgg();break;case 1:this.Qf.HHa(Nc);this.wgg(fc);this.vgg();break;case 2:this.Qf.GHa(Nc);break;case 3:e.ULS.shipAssertTag(537167426,12,!rb,"Metadata session type has comment text.");Nc.mkf=!0;this.Qf.F7g(Nc,fc.Resolve);break;default:throw x.a.dt(-2130915322);}return Nc.id}endCommentSession(va){const rb=this.Ge.rt;if(rb&&rb.ju&&rb.ju.draftId!==va)throw x.a.dt(-2130915327);this.Qf.endCommentSession(!1)}deleteComment(va){this.Qf.elh(va)}selectComment(va){this.Qf.hqd(va)?
this.Qf.CKi():this.Qf.WPd(va,0)}highlightComment(){}setThreadResolvedState(va,rb){if(this.Qf.prd(va))throw new Ra(this.$,this.Qf,va,null),x.a.dt(-2130915316);this.Qf.setThreadResolvedState(va,rb)}selectFirstThreadInNextCommentContext(){this.Qf.selectFirstThreadInNextCommentContext()}selectLastThreadInPreviousCommentContext(){this.Qf.selectLastThreadInPreviousCommentContext()}presentLinkToComment(va){const rb={SourceControlId:"LinkToComment"};rb.navId=this.uUh(va);va=new Ja.a(869186573,2,this.$.xc,
this.Qf.commentTaskPane.isVisible?12:9,null);this.$.Ia.Hb(va,rb)}uUh(va){const rb=this.Yxb(this.$.va.na);va=btoa("10_{"+va+"}_"+rb);va=va.replace(RegExp("\\+","g"),"-");va=va.replace(RegExp("\\/","g"),"_");return va=va.replace(RegExp("\\=+$","g"),"")}registerForCommentEvents(va){this.Wsa.N4e().then(rb=>{this.F7f.lgj(va,this.Qf.adc(),this.Qf.Nhd(),0===this.Qf.mode,this.Qf.e_h(),rb,this.Qf.p1a)})}unregisterForCommentEvents(va){this.F7f.rig(va)}registerForAction(va,rb){this.VDj.sQa(va,rb)}unregisterForAction(){}loadThreads(){e.ULS.sendTraceTag(537167425,
12,10,"LoadThreads incorrectly called on unsupported platform.")}checkAtMentionCapability(){return this.$.uBb()?new Promise(va=>{va(!1)}):this.u6?this.u6.atMentionsEnabledAsync():(e.ULS.sendTraceTag(537167424,12,10,"AtMentionEnabled called before initialization."),new Promise(va=>{va(!1)}))}resolveSupported(){return!0}d8i(va){var rb=this.Ge.rt;if(null===rb||void 0===rb?0:rb.ju){const fc=Na.EwaSettings.isChangeGateEnabled("OfficeVSO:5703292_ExcelPlumbEmailThroughCG")?Ha.a.CJa(rb.authorIdentity||""):
"";rb=new Ya(rb.authorIdentity,rb.Bwe,rb.author,fc,!0);va.author=rb}va.authorName=z.AFrameworkApplication.userName;va.authorIdentity=""}M5b(va,rb){return new Promise((fc,Nc)=>{x.a.QYa(this.taskManager,()=>{try{rb()}catch(hd){Nc(hd);return}this.d8i(va);fc(va)})})}c8i(va){let rb=null;const fc=new Promise((Nc,hd)=>{rb=hd});new Ra(this.$,this.Qf,va,rb);return fc}Yxb(va){return(va=Object(Ma.a)(Qa.a,va))?va.sheetId:null}wgg(va){if(Na.EwaSettings.isChangeGateEnabled("OfficeVSO:5065546_CommentsTasksFpsIsEnabled")&&
(null===va||void 0===va?0:va.Task))try{const rb=Gb.a.instance.Tb("Common.ISystemInitiatedFeedback");rb&&rb.execute(fc=>{fc.logActivity("ExcelWebCommitTaskActivity","CommentsTasksFpsIsEnabled")})}catch(rb){e.ULS.sendTraceTag(537167395,12,10,`Exception thrown while triggering ExcelWebCommitTaskActivity. Exception: ${rb}`)}}vgg(){if(Na.EwaSettings.isChangeGateEnabled("OfficeVSO:4995535_CommentsFpsIsEnabled"))try{const va=Gb.a.instance.Tb("Common.ISystemInitiatedFeedback");va&&va.execute(rb=>{rb.logActivity("ExcelWebCommitNewCommentActivity",
"CommentsFpsIsEnabled")})}catch(va){e.ULS.sendTraceTag(537167394,12,10,`Exception thrown while triggering ExcelWebCommitNewCommentActivity. Exception: ${va}`)}}}Object(c.a)(Oa,"ExcelCommentAPI",null,[486,487]);class bb{}Object(c.a)(bb,"ExcelCommentAnchorInfo",null,[485]);class Ga{constructor(va,rb){this.excelCommentManager=va;this.$=rb}initialize(){}dispose(){this.$=this.excelCommentManager=null}highlightComment(va){va&&!this.excelCommentManager.rni(va)&&(this.excelCommentManager.nxc(va.anchor),va.focus())}static createInstance(va,
rb,fc,Nc,hd){return new Ga(va,rb,fc,Nc,hd)}}Object(c.a)(Ga,"ExcelCommentHintManager",null,[484,2]);var tb=a(1350),wb=a(195),lb=a(897);class db{constructor(va,rb,fc,Nc,hd,xd){this.commentType=0;this.parentCommentId=this.commentId=this.anchor=this.content=null;this.isResolved=!1;this.commentType=va;this.content=rb;this.anchor=fc;this.commentId=Nc;this.parentCommentId=hd;this.isResolved=xd}getContent(){return this.content}}Object(c.a)(db,"MacroRecorderWorkbookCommentedPayload",null,[162]);var Pa=a(127),
ja=a(41),Ka=a(193),ub=a(249),Kb=a(282),W=a(128),za=a(52);class Sa extends tb.a{constructor(va,rb,fc,Nc){super();this.i7d=0;this.QMb=null;this.BKc="";this.pOi=(hd,xd,ae)=>{ub.a(hd)?(this.Lzf(null,xd,ae),this.ea.Tn(hd.Errors)):(1===this.uPa&&xd&&e.ULS.shipAssertTag(537167321,12,!!this.nt(xd),"can't find the newly created comments."),this.KBi(this.uPa,xd));this.Tse(xd);this.BKc=""};this.Lzf=(hd,xd)=>{if(this.excelCommentManager.Fta||!xd)e.ULS.shipAssertTag(537167320,12,!!xd||3===this.uPa,"Only comment deletion can pass an invalid commentId.");
else switch(hd=this.nt(xd),this.uPa){case 2:hd?(e.ULS.shipAssertTag(537167319,12,!!hd,"can't find the edited comments."),hd.text=hd.KRj):W.b(this.$).rd(Pa.a.J7g,{["Location"]:"floatie"},void 0,!0);break;case 1:e.ULS.shipAssertTag(537167318,12,!!hd,"can't find the inserted comments.");this.Xe.A7b(hd);break;case 3:e.ULS.shipAssertTag(537167317,12,!hd,"The deleted comment should not exist."),this.excelCommentManager.cLg(xd)}this.excelCommentManager.ngb(!0);this.Tse(xd)};this.excelCommentManager=va;this.$=
rb;this.ha=fc;this.ea=Nc;this.uPa=0}get p1a(){return this.i7d}get BU(){return this.BKc}set BU(va){this.BKc=va}IIg(va){this.Vnb(va,!0)}Vnb(va,rb){rb&&(this.Xe.mode=2,this.YO=va);if(va.jk)for(rb=this.Ii.length-1;0<=rb;rb--){const fc=this.Ii[rb];if(fc.jk===va.jk||fc.id===va.jk){this.Ii.splice(rb+1,0,va);break}}else rb=va.anchor,e.ULS.shipAssertTag(537167360,12,!!rb,"Fail to get valid range for newly inserted comment!"),rb=this.C1e(rb),this.Ii.splice(~rb,0,va)}zea(va,rb){this.Ii.length=0;this.Ii=va;this.QMb&&
(this.QMb.length=0);this.QMb=rb;this.Jl&&(this.Jl=this.nt(this.Jl.id));this.dga&&(this.dga=this.nt(this.dga.id));this.F0j()}Sid(){return this.QMb?[...this.QMb]:[]}x_j(va,rb,fc,Nc){this.zea(va,rb);this.v8g(fc,!!va&&0<va.length,Nc)}wkd(va){let rb=null;this.ha.qa.h5&&(rb=this.excelCommentManager.sC,!rb&&this.excelCommentManager.Rm.WE&&e.ULS.shipAssertTag(537167331,12,!1,"Not expecting to reach here when there is a separate button for DeleteNote."));this.applyComment(3,rb,va)}aJb(va,rb){if(0!==this.uPa)e.ULS.sendTraceTag(537167330,
12,15,"RecordChanges: Attempting to commit a note/comment change while another operation is in progress.");else{var fc=Object(Ma.a)(qa.a,va[0]);if(1!==fc.commentType||3!==rb){switch(rb){case 3:1<va.length&&fc.jk&&(fc=Object(Ma.a)(qa.a,this.nt(fc.jk)));va=3;break;case 2:va=1;break;case 4:va=(va=Object(Ma.a)(378,fc))&&va.mkf?7:2;break;case 0:case 1:va=6;break;default:return}this.applyComment(va,fc,null)}}}Cej(va,rb){if(this.excelCommentManager.GAb){const Nc=!rb.taskId;if(!Nc||va.ju.sessionType===P.create||
Na.EwaSettings.isChangeGateEnabled("OfficeVSO:4017579_DocumentTasksCreateFromReply")&&va.ju.sessionType===P.reply){var fc=null;va.ju.sessionType!==P.metadata&&(fc=va.id);rb=Na.EwaSettings.isChangeGateEnabled("OfficeVSO:4084663_DocumentTasksDefaultTitleEnabled")&&va.text&&0<va.text.length?this.excelCommentManager.sbd.Myf.D_e(fc,rb,Nc,va.text[0]):this.excelCommentManager.sbd.Myf.D_e(fc,rb,Nc);va.Yre=rb}else e.ULS.shipAssertTag(537167325,12,!1,"Attempted to create task with invalid session type : "+
va.ju.sessionType)}}bO(){return this.ILb(!0)}PR(){return this.ILb(!1)}nKa(va){if(0<this.Ii.length&&(e.ULS.shipAssertTag(537167324,12,!!va,"invalid comment range"),va=this.C1e(va),0<=va)){va=this.Ii[va];if(null===va||void 0===va?0:va.jk)va=this.nt(va.jk);return va}return null}C1e(va){return Sa.i4e(va,this.Ii)}Jwb(va){let rb=0;va&&(rb=Array.indexOf(this.Ii,va));return rb}Tse(va){va&&(va=this.nt(va))&&(va.idb=2);this.Xe.mode=1;this.uPa=0}ILb(va){if(!this.Ii.length)return null;let rb=null;if(this.Jl||
(rb=this.Ii[va?0:this.Ii.length-1]).Wgc){const fc=this.Jl||rb;rb=fc;do rb=va?this.Iwb(rb,!0):this.Wbc(rb,!0);while((null===rb||void 0===rb?0:rb.Wgc)&&rb!==fc)}this.selectComment(rb);return rb}applyComment(va,rb,fc){rb&&(rb.idb=1);this.Xe.mode=4;this.uPa=va;const Nc=(null===rb||void 0===rb?0:rb.text)&&0<rb.text.length?rb.text[0]:null,hd=rb?ja.q(rb.anchor,this.$):ja.r(this.ha.qa.selectedRanges,this.$),xd=rb?rb.id:null,ae=rb?rb.done:!1;let Wd=null;rb&&void 0!==rb.jk&&null!==rb.jk&&0<rb.jk.length&&(Wd=
rb.jk);var Ne=Object(Ma.a)(378,rb);e.ULS.shipAssertTag(537167322,12,!rb||rb.e7a||!!Ne,"Apply threaded comment operation must have a threaded comment or a note");let Ue;Ue=Ne?this.excelCommentManager.sbd.dVj(Ne.Yre):null;Ne=new Ka.a(181,0,(xe,Ze,tf)=>Fa(this.$.oa.xa,va,Nc,hd,xd,Wd,ae,Ue,Kb.b(xe,this.pOi),Kb.a(Ze,this.Lzf),tf,rb?rb.id:null),1,()=>new db(va,Nc,hd,xd,Wd,ae));this.$.userOperationManager.Jc(Ne,fc)}KBi(va,rb){const fc={};fc.a=this.$.ya.UserSessionId;fc.b=va;fc.c=rb;fc.d=this.Ii.length;za.b().Se(32,
fc)}v8g(va,rb,fc){this.i7d=fc?va||rb?3:2:va?4:rb?5:1}F0j(){if(this.YO){var va=this.nt(this.YO.id),rb=this.$.va.na,fc=P.Gcc(this.YO.ju.sessionType);e.ULS.shipAssertTag(537167316,12,!(void 0===fc||null===fc),"Invalid comment draft");va?(e.ULS.shipAssertTag(537167315,12,2===fc,"Expecting an edit draft"),va.ju=this.YO.ju,this.YO=va):rb&&this.BU===rb.sheetId&&this.Vnb(this.YO,!1)}}static createInstance(va,rb,fc,Nc){return new Sa(va,rb,fc,Nc)}static Weh(va,rb,fc){return qa.a.P5b(z.AFrameworkApplication.userName,
va,rb,fc)}static Xeh(va,rb,fc){const Nc={};Nc.DisplayName=z.AFrameworkApplication.userName;Nc.UserId=z.AFrameworkApplication.fa.Wa("PresenceUserId");Nc.Provider=z.AFrameworkApplication.fa.Wa("PresenceProvider");return lb.a.Chh(Nc,va,rb,fc)}static Yeh(va,rb,fc,Nc){const hd={};hd.DisplayName=z.AFrameworkApplication.userName;hd.UserId=z.AFrameworkApplication.fa.Wa("PresenceUserId");hd.Provider=z.AFrameworkApplication.fa.Wa("PresenceProvider");return lb.a.Dhh(hd,va,rb,fc,Nc)}static i4e(va,rb){const fc=
new wb.a(rb);return na.HelperMethods.Xu(fc,0,rb.length,va,Sa.c8g)}static Ihd(va,rb,fc){va=Sa.i4e(va,fc);0<=va?va+=rb?1:-1:(va=~va,rb||--va);return{returnValue:0<=va&&va<fc.length?fc[va]:null,efi:va}}static c8g(va,rb){const {ExcelCommentManager:fc}=a(757);return fc.Urb(va.anchor,rb)}}Object(c.a)(Sa,"ExcelCommentModel",tb.a,[482,483]);var Wa=a(552);class ab{constructor(){this.Gje=this.Uke=!1;this.SFg=[]}get Ofb(){return this.SFg}get oTa(){return this.Uke}set oTa(va){this.Uke=va;for(const rb of this.Ofb)rb.oTa=
va}get bSa(){return this.Gje}set bSa(va){this.Gje=va;for(const rb of this.Ofb)rb.bSa=va}Doa(va){for(const rb of this.Ofb)va=rb.Doa(va);return va}}Object(c.a)(ab,"AggregateCommentTaskPersonTransformer",null,[973]);class ma{constructor(va,rb,fc,Nc,hd=!1){this.priority=this.completion=-1;this.type=va;this.user=rb;this.time=fc;this.recordId=Nc;this.isLossy=hd}}Object(c.a)(ma,"HistoryRecord",null,[]);class ha{constructor(va,rb){this.Xzg=new Wa.a(()=>rb.Doa(va.value))}iTh(){return new Date}Vha(va,rb,fc){if(0===
va)throw e.ULS.sendTraceTag(594650201,327,10,"CreateBlankHistoryRecord: we do not expect user to be able to create a record of type Unknown in the browser."),Error.argument("recordType");const Nc=d.a.create().toString();fc=new ma(va,this.Xzg.value,fc,Nc,!1);fc.commentId=rb;e.ULS.sendTraceTag(42796192,327,50,"History Record Generated. [RecordType: {0}]",va);return fc}}Object(c.a)(ha,"HistoryRecordFactory",null,[975]);class eb{constructor(){this.endDate=this.startDate=null}}Object(c.a)(eb,"CommentTaskSchedule",
null,[]);class ta{constructor(va,rb,fc,Nc,hd,xd){this.isLossy=va;this.title=rb;this.assignees=fc;this.schedule=Nc;this.completion=hd;this.priority=xd}}Object(c.a)(ta,"CommentTaskState",null,[]);class ya{constructor(){this.commentId=null}}Object(c.a)(ya,"HistoryItem",null,[]);class sb{constructor(va,rb,fc,Nc,hd,xd,ae){this.hNc=!1;if(1!==rb.type)throw Error.argument("createRecord");this.Cib=fc;this.Aib=Nc;this.Bib=hd;this.bfe=1;this.vUb=va;this.LAg=xd;this._state=new ta(!1,this.Cib,ae,new eb,this.Bib,
this.Aib);this._history=[];this.qIe(rb)}k1a(va,rb){if(1!==va.type)throw Error.argument("createRecordTemplate");const fc=sb.I4h(va,this.bfe);this.bfe++;return Object.assign(new ma(rb,va.user,va.time,fc),{commentId:va.commentId})}get dpf(){return this.history[this.history.length-1]}get Qaf(){return this.state.completion===this.Bib}get Paf(){return this.state.priority===this.Aib}get Raf(){return(void 0===this.state.schedule.startDate||null===this.state.schedule.startDate)&&(void 0===this.state.schedule.endDate||
null===this.state.schedule.endDate)}get Saf(){return this.state.title===this.Cib}qIe(va){va=Object.assign(new ya,{commentId:va.commentId,records:[va]});this.history.push(va)}w0e(va){let rb=-1;for(let fc=0;fc<this.state.assignees.length;fc++)if(this.vUb.equals(this.state.assignees[fc],va)){rb=fc;break}return rb}yEj(va){const rb=this.dpf,fc=rb.records[rb.records.length-1];return this.vUb.equals(fc.user,va.user)&&rb.commentId===va.commentId&&fc.time.getTime()===va.time.getTime()?!0:!1}O2j(va){switch(va.type){case 2:-1===
this.w0e(va.assignee)&&this.state.assignees.push(va.assignee);break;case 3:const rb=this.w0e(va.assignee);0<=rb&&this.state.assignees.splice(rb,1);break;case 4:Array.clear(this.state.assignees);break;case 5:this.state.schedule=va.schedule;break;case 6:this.state.completion=va.completion;break;case 9:this.state.title=va.title;break;case 10:this.state.priority=va.priority;break;case 0:this.state.isLossy=!0;break;case 1:e.ULS.sendTraceTag(595198540,327,10,"Create record passed for state evaluation");
break;case 7:this.hNc=!0;break;case 8:this.hNc=!1;break;case -1:e.ULS.sendTraceTag(51139905,327,10,"Undo record passed for state evaluation");break;default:this.state.isLossy=!0}va.isLossy&&(this.state.isLossy=!0);this.yEj(va)?this.dpf.records.push(va):this.qIe(va)}get isDeleted(){return this.hNc}get state(){return this._state}get history(){return this._history}SWh(va){if(!va)return this.history;const rb=Array.clone(this.history),fc=rb[0],Nc=fc.records.shift();if(!this.LAg){var hd=this.k1a(Nc,4);
fc.records.unshift(hd)}!va.Qaf&&this.Qaf&&(hd=this.k1a(Nc,6),hd.completion=this.Bib,fc.records.unshift(hd));!va.Paf&&this.Paf&&(hd=this.k1a(Nc,10),hd.priority=this.Aib,fc.records.unshift(hd));!va.Raf&&this.Raf&&(hd=this.k1a(Nc,5),hd.schedule=new eb,fc.records.unshift(hd));!va.Saf&&this.Saf&&(hd=this.k1a(Nc,9),hd.title=this.Cib,fc.records.unshift(hd));va.isDeleted&&(va=this.k1a(Nc,8),fc.records.unshift(va));return rb}static I4h(va,rb){return"Synthesized-"+va.recordId+"-"+rb}}Object(c.a)(sb,"CommentTaskStateBuilder",
null,[]);var Qb=a(1288);class oc{constructor(va,rb,fc,Nc){this.id=va;this.commentId=rb;this.currentState=fc;this.history=Nc}}Object(c.a)(oc,"CommentTaskItem",null,[]);class kb{constructor(va,rb="",fc="",Nc=""){this.IsCurrentUser=!1;this.UserId=va;this.Provider=rb;this.DisplayName=fc;this.Email=Nc}}Object(c.a)(kb,"CommentTaskPerson",null,[972]);const jb=va=>{const rb=new kb(va.UserId,va.Provider,va.DisplayName,va.Email);rb.IsCurrentUser=va.IsCurrentUser;return rb};var Wb=a(1230);a(271);class wc{constructor(va){this.extensions=
va}}Object(c.a)(wc,"ExtensionList",null,[]);class Jc{static clone(va){va=Jc.Y5g(va.extensions);return new wc(va)}static rDe(va){return va?Jc.clone(va):null}static isEmpty(va){return!va.extensions||!va.extensions.count}static lh(va){return!va||Jc.isEmpty(va)}static Y5g(va){if(!va)return null;const rb=new Wb.a;va.forEach((fc,Nc)=>{rb.add(fc,Nc);return!0});return rb}}Object(c.a)(Jc,"ExtensionListExtensions",null,[]);class zc{static clone(va){var rb=jb(va.user);rb=new ma(va.type,rb,va.time,va.recordId,
va.isLossy);rb.commentId=va.commentId;rb.anchorExtensionList=Jc.rDe(va.anchorExtensionList);rb.recordExtensionList=Jc.rDe(va.recordExtensionList);va.assignee&&(rb.assignee=jb(va.assignee));if(va.schedule){var fc=va.schedule;const Nc=new eb;Nc.startDate=fc.startDate;Nc.endDate=fc.endDate;rb.schedule=Nc}rb.completion=va.completion;rb.title=va.title;rb.priority=va.priority;rb.undoId=va.undoId;return rb}}Object(c.a)(zc,"HistoryRecordExtensions",null,[]);class gd{constructor(va,rb,fc,Nc,hd,xd,ae,Wd=!1){this.vUb=
va;this.BWb=rb;this.a9=fc;this.Wug=Nc;this.Cib=hd;this.Aib=xd;this.Bib=ae;this.UUb=Wd}xhh(va,rb,fc,Nc=null){if(!va)throw e.ULS.sendTraceTag(42796181,327,10,"taskId cannot be null."),Error.argumentNull("taskId");if(!rb)throw e.ULS.sendTraceTag(42796182,327,10,"parentCommentId cannot be null."),Error.argumentNull("parentCommentId");if(!fc||!fc.length)throw e.ULS.sendTraceTag(42796183,327,10,"records cannot be null or empty."),Error.argumentNull("records");if(1!==fc[0].type)throw e.ULS.sendTraceTag(42796184,
327,10,"First record must be a Create record."),Error.argument("First record must be a Create record.");var hd=[],xd=null,ae=this.h$i(fc);for(var Wd of fc)if(!ae.contains(Wd.recordId))if(fc=this.G8e(Wd.commentId,Nc),fc=this.CNh(Wd,fc),1===fc.type){let Ue=[];this.UUb&&xd&&xd.state&&(Ue=xd.state.assignees);xd=new sb(this.vUb,fc,this.Cib,this.Aib,this.Bib,this.UUb,Ue);hd.push(xd)}else if(xd)xd.O2j(fc);else throw e.ULS.sendTraceTag(595198539,327,10,"Undo resulted in ignoring of Task creation without also ignoring records after the create record."),
Error.argument("Undo resulted in ignoring of Task creation without also ignoring records after the create record.");ae=null;Wd=[];if(xd){xd.isDeleted||(ae=xd.state);xd=null;for(var Ne of hd)hd=Ne.SWh(xd),Array.addRange(Wd,hd),xd=Ne}Ne=this.G8e(rb,Nc);ae&&(ae.completion=this.u8g(rb,Nc,ae.completion));return new oc(va,Ne,ae,Wd)}D_e(va,rb,fc,Nc=null){if(!rb)throw e.ULS.sendTraceTag(42796185,327,10,"update cannot be null."),Error.argumentNull("update");if(fc&&!va)throw e.ULS.sendTraceTag(42796187,327,
10,"CommentId must be specified for task creation."),Error.argument("commentId");const hd=[],xd=this.a9.iTh();if(fc){var ae=this.a9.Vha(1,va,xd);hd.push(ae)}ae=null;if(rb.assigneeUpdate){if(!rb.assigneeUpdate.assigneesToAdd||!rb.assigneeUpdate.assigneesToRemove)throw e.ULS.sendTraceTag(536999254,327,15,"Invalid AssigneeUpdate."),Error.argument("Schedule","Invalid AssigneeUpdate.");for(var Wd=0;Wd<rb.assigneeUpdate.assigneesToAdd.length;Wd++){var Ne=this.rIe(2,rb.assigneeUpdate.assigneesToAdd[Wd],
va,xd);Ne&&hd.push(Ne)}for(Wd=0;Wd<rb.assigneeUpdate.assigneesToRemove.length;Wd++)(Ne=this.rIe(3,rb.assigneeUpdate.assigneesToRemove[Wd],va,xd))&&hd.push(Ne)}else rb.assignee&&(fc||(ae=this.a9.Vha(4,va,xd),hd.push(ae)),Wd=this.a9.Vha(2,va,xd),ae=this.BWb.Doa(rb.assignee),Wd.assignee=ae,hd.push(Wd));rb.title?(Nc=this.a9.Vha(9,va,xd),Nc.title=rb.title,hd.push(Nc)):fc&&Nc&&(Wd=this.a9.Vha(9,va,xd),Wd.title=this.Wug.Q5h(Nc,ae),hd.push(Wd));if(rb.schedule){if(rb.schedule.startDate>rb.schedule.endDate)throw e.ULS.sendTraceTag(42796188,
327,10,"Invalid schedule."),Error.argument("Schedule","Invalid schedule.");Nc=this.a9.Vha(5,va,xd);Nc.schedule=rb.schedule;hd.push(Nc)}if(void 0!==rb.completion&&null!==rb.completion){Nc=rb.completion;if(0>Nc||100<Nc)throw e.ULS.sendTraceTag(42796189,327,10,"Invalid completion state."),Error.argumentOutOfRange("completion");fc||e.ULS.sendTraceTag(595198538,327,50,"Task progress change. [Progress: {0}]",Nc);fc=this.a9.Vha(6,va,xd);fc.completion=Nc;hd.push(fc)}if(void 0!==rb.priority&&null!==rb.priority){rb=
rb.priority;if(0>rb||10<rb)throw e.ULS.sendTraceTag(42796190,327,10,"Invalid priority state."),Error.argumentOutOfRange("priority");va=this.a9.Vha(10,va,xd);va.priority=rb;hd.push(va)}return hd}rIe(va,rb,fc,Nc){if(2!==va&&3!==va)return e.ULS.sendTraceTag(0,327,10,"Assignee field should only be used for an Assign or Unassign HistoryRecord."),null;va=this.a9.Vha(va,fc,Nc);va.assignee=this.BWb.Doa(rb);return va}h$i(va){const rb=new Qb.a,fc=new Qb.a;for(let Nc=va.length-1;0<=Nc;Nc--){const hd=va[Nc],
xd=fc.contains(hd.recordId);xd||-1!==hd.type||(fc.contains(hd.undoId)?e.ULS.sendTraceTag(578670598,327,50,"Multiple Undo records attempting to undo the same record."):fc.add(hd.undoId));if(xd||-1===hd.type)rb.contains(hd.recordId)?e.ULS.sendTraceTag(578670599,327,50,"Record was already added to records to ignore. There must be multiple records with same ID."):rb.add(hd.recordId)}return rb}CNh(va,rb){const fc=zc.clone(va);fc.commentId=rb;fc.user=this.BWb.Doa(va.user);fc.assignee=this.BWb.Doa(va.assignee);
return fc}u8g(va,rb,fc){let Nc=fc;va&&rb&&(({value:rb}=rb.Fc(va)).returnValue?(Nc=rb.ResolveState?100:100===fc?0:fc,Nc!==fc&&e.ULS.sendTraceTag(592719873,327,50,"Task completion state has been changed to match comment resolution state for comment {0}",va)):e.ULS.sendTraceTag(592719874,327,50,"Comment {0} not found in translation map. Completion unchanged",va));return Nc}G8e(va,rb){let fc=va;va&&rb&&(({value:rb}=rb.Fc(va)).returnValue?fc=rb.CommentId:(e.ULS.sendTraceTag(42796191,327,50,"Id not found in translation map. Possible Orphan task candidate [CommentId: {0}]",
va),fc=va));return fc}}Object(c.a)(gd,"CommentTaskTranslatorImpl",null,[974]);class Va{static initialize(va){Va.pk=va;Sys.UI.DomElement.addCssClass(Va.pk,"HtmlScratchPad");Va.HRd(!1)}static reset(){Va.pk=null}static K2h(){let va=Va.Olg.WordBreakUtils;va||(va=Va.pk.ownerDocument.createElement("div"),Va.pk.appendChild(va),Va.Olg.WordBreakUtils=va);return va}static TVg(){Va.YRb++;1===Va.YRb&&Va.HRd(!0)}static psh(){Va.YRb--;Va.YRb||Va.HRd(!1)}static HRd(va){va?Sys.UI.DomElement.removeCssClass(Va.pk,
"Hidden"):Sys.UI.DomElement.addCssClass(Va.pk,"Hidden")}static get isInitialized(){return!!Va.pk}}Va.pk=null;Va.Olg={};Va.YRb=0;Object(c.a)(Va,"HtmlScratchPadProvider",null,[]);var Eb=a(30);class hc{constructor(va,rb){this.ssb=va;this.Png=rb}}Object(c.a)(hc,"WordBreak",null,[]);class Ab{constructor(){this.wordCount=0}}Object(c.a)(Ab,"WordCountFromWordBreaksResult",null,[]);class Bb{constructor(){Bb.MWb=null}o3e(va,rb){rb=this.n3e(va,rb);return!rb||0===rb.Png&&(rb=this.n3e(va,rb.ssb),!rb)?va.length:
rb.ssb}C0e(va,rb){rb=this.B0e(va,rb);return!rb||0===rb.Png&&(rb=this.B0e(va,rb.ssb),!rb)?0:rb.ssb}n3e(va,rb){return this.WVh(va,rb,va.length)}B0e(va,rb){return this.tPh(va,rb)}WVh(va,rb,fc){if(rb>=fc-1)return null;let Nc=rb;for(;Nc<fc;){const hd=this.Sja(va,Nc);switch(hd){case 2:return va=this.L0e(va,rb,!0),!va||va.ssb>=fc?null:va;case 3:case 1:case 0:case 5:case 6:if(Nc>=fc-1)return null;const xd=Nc+1,ae=this.Sja(va,xd);if(hd!==ae&&this.a8f(hd,ae)&&(2!==ae||!Bb.cdg))return new hc(xd,ae)}Nc+=1}return null}tPh(va,
rb){if(1>=rb)return null;let fc=rb;for(;0<fc;){const Nc=this.Sja(va,fc-1);switch(Nc){case 2:return(va=this.L0e(va,rb,!1))?va:null;case 3:case 1:case 0:case 5:case 6:if(1>=fc)return null;const hd=fc-1,xd=this.Sja(va,hd-1);if(Nc!==xd&&this.a8f(Nc,xd)&&(2!==xd||!Bb.cdg))return new hc(hd,Nc)}--fc}return null}a8f(va,rb){return 5===va&&3!==rb||3===va&&5!==rb||1===va||6===va||0===va}Ish(){Bb.RCa||(Bb.RCa=Va.K2h(),Bb.RCa.className="WACWordBreakSurface")}E_j(va){Bb.tX!==va&&(Bb.RCa.innerText=va,Bb.tX=va)}L0e(va,
rb,fc){this.Ish();this.E_j(va);let Nc=-1;var hd=!1;h.a.xXd?(Nc=this.RRj(rb,fc),rb!==Nc&&(hd=!0)):h.a.fdg&&(Nc=this.scj(rb,fc),rb!==Nc&&(hd=!0));hd||(Nc=this.vLi(rb,fc));hd=-1;fc?Nc>=Bb.tX.length?Nc=-1:Nc===rb?hd=4:Nc<rb&&(Nc=-1):(0>=Nc&&(Nc=-1),Nc>=rb&&(Nc=-1));if(-1===Nc)return null;-1===hd&&(hd=this.Sja(va,Nc));return new hc(Nc,hd)}RRj(va,rb){z.AFrameworkApplication.Gn.Fzb(Bb.o3d);Bb.zra||(Bb.zra=document.body.createTextRange());Bb.zra.moveToElementText(Bb.RCa);Bb.zra.collapse();Bb.zra.move("character",
va);rb?Bb.zra.moveEnd("word",1):Bb.zra.moveStart("word",-1);var fc=Bb.zra.text.length;fc=rb?va+fc:va-fc;if(0>fc||fc>Bb.tX.length)fc=va;return fc=this.IGe(va,fc,rb)}scj(va,rb){z.AFrameworkApplication.Gn.Fzb(Bb.o3d);Va.TVg();const fc=Bb.RCa.firstChild,Nc=Bb.RCa.ownerDocument.createRange();Nc.setStart(fc,va);Nc.setEnd(fc,va);Nc.expand("word");let hd=rb?Nc.endOffset:Nc.startOffset;hd===va&&!rb&&0<va&&(Nc.setStart(fc,va-1),Nc.setEnd(fc,va-1),Nc.expand("word"),hd=Nc.startOffset);hd=this.IGe(va,hd,rb);Va.psh();
return hd}IGe(va,rb,fc){return va===rb?rb:fc?this.Eah(va,rb):this.Dah(va,rb)}Eah(va,rb){let fc=!1;for(;va<rb;va++){const Nc=this.Sja(Bb.tX,va);if(fc){if(1===Nc||0===Nc)return z.AFrameworkApplication.Gn.Fzb(Bb.p3d),va}else 2===Nc&&(fc=!0)}return rb}Dah(va,rb){let fc=!1;for(--va;va>=rb;va--){const Nc=this.Sja(Bb.tX,va);if(fc){if(1===Nc||0===Nc)return z.AFrameworkApplication.Gn.Fzb(Bb.p3d),va+1}else 2===Nc&&(fc=!0)}return rb}vLi(va,rb){return rb?this.xLi(va):this.wLi(va)}xLi(va){let rb=va;for(;rb<Bb.tX.length&&
2===this.Sja(Bb.tX,rb)&&!Eb.a.eif(Eb.a.charCodeAt(Bb.tX,rb));)rb++;rb===va&&(rb++,this.Chf(rb)&&rb++);return rb}wLi(va){let rb=va;for(;0<rb&&2===this.Sja(Bb.tX,rb-1)&&!Eb.a.eif(Eb.a.charCodeAt(Bb.tX,rb-1));)rb--;rb===va&&(rb--,this.Chf(rb)&&rb--);return rb}Chf(va){return Eb.a.Xqi(Bb.tX,va-1)}Sja(va,rb){va=va.charAt(rb).toString();return this.Qli(va)?3:this.Qwi(va)?0:this.Esi(va)?1:this.Fsi(va)?5:this.qpi(va)?6:2}Qli(va){return Eb.a.Pli(va.charAt(0))}Qwi(va){Bb.pVc||(Bb.pVc=RegExp("[\\u0000-\\u001F]|\\u0020|[\\u007F-\\u009F]|\\u00A0|[\\u2000-\\u200B]|\\u202F|\\u205F|\\u2420|[\\u2422-\\u2424]|\\u3000|\\uFF02"));
return Bb.pVc.test(va)}Esi(va){Bb.MWb||(Bb.MWb=RegExp("[!-&]|[\\(-\\.]|/|[:-@]|[\\[-`]|[{-~]|\u00a1|\u00a6|\u00a7|\u00a9|\u00ab|\u00ac|\u00ae|\u00b0|\u00b1|[\u00b4-\u00b7]|\u00bb|\u00bf|\u00d7|\u00f7|\u01c3|\u037e|[\u2012-\u2015]|[\u201a-\u2022]|[\u2024-\u2026]|\\u202F|\u2030|\u2039|\u203a|\u203c|\u203d|\u2048|\u2049|\\u2060|\u2103|\u2105|\u2106|\u2109|\u2116|\u2122|\u2211|\u2212|\u221a|\u221e|\u222b|\u2248|\u2260|\u2264|\u2265|\\u25A1|\\u25AA|\\u25AB|\u25ca|\u25cf|\u25e6|[\u2639-\u263b]|\u2762|\\uFEFF|\uff01|\uff0e|\uff1b|\uff1f|\uff61"));
return Bb.MWb.test(va)}Fsi(va){return"'"===va||"\u2018"===va||"\u2019"===va}qpi(va){return"\ue000"===va}static get cdg(){return h.a.xXd||h.a.fdg}static get instance(){Bb.La||(Bb.La=new Bb);return Bb.La}}Bb.p3d=10265;Bb.o3d=10266;Bb.pVc=null;Bb.MWb=null;Bb.RCa=null;Bb.tX="";Bb.zra=null;Bb.La=null;Object(c.a)(Bb,"WordBreakUtils",null,[904]);class ec{constructor(){this.paa=CommonUIStrings.l_Ellipsis}Q5h(va,rb){if(!va)throw e.ULS.sendTraceTag(592998807,327,10,"Missing commentRichText"),Error.argumentNull("commentRichText");
try{var fc=La.k2e(va)}catch(Ne){throw e.ULS.sendTraceTag(592998806,327,10,"commentRichText not in Delta Format"),Error.format("Improperly formatted Delta text in commentRichText");}var Nc=va=0,hd=0;const xd=RegExp("\\s+","g"),ae=new Sys.StringBuilder;for(var Wd of fc.ops)Wd.attributes&&Wd.attributes.atmention&&Wd.attributes.atmention.email&&rb&&(fc=Wd.attributes.atmention.email,0<fc.length&&(fc===rb.UserId||fc===rb.Email||fc===Ha.a.CJa(rb.UserId))&&(Nc=va,hd=Nc+Wd.insert.length)),fc=Wd.insert.replace(xd,
" "),va+=fc.length,ae.append(fc);!hd&&rb&&e.ULS.sendTraceTag(592998805,327,10,"Assignee was not found in comment text",rb.Provider);rb=ae.toString().trimEnd();va=rb.length;255<va?(Wd=(255-(hd-Nc))/2,0>Nc-Wd?(va=Bb.instance.C0e(rb,255-this.paa.length),hd=rb.substring(0,va)+this.paa,va="Trimmed End"):hd+Wd>va?(Nc=Bb.instance.o3e(rb,va-255+this.paa.length),hd=this.paa+rb.substring(Nc,va),va="Trimmed Start"):(Nc=Bb.instance.o3e(rb,Nc-Wd+this.paa.length),va=Bb.instance.C0e(rb,hd+Wd-this.paa.length),hd=
this.paa+rb.substring(Nc,va)+this.paa,va="Trimmed Both")):(va="No Trim",hd=rb);e.ULS.sendTraceTag(592998804,327,50,va);return hd}}Object(c.a)(ec,"ContentExtractor",null,[]);class Qd{constructor(va,rb){this.hyg=va;this.Yzg=rb;this.bSa=this.oTa=!1}Doa(va){if(!va)return null;if(void 0===va.UserId||null===va.UserId)throw e.ULS.sendTraceTag(593368219,327,10,"Unexpected user missing UserId field"),Error.argumentType();if(va.IsCurrentUser||!this.hyg.equals(this.Yzg.value,va))return va;va=jb(va);va.IsCurrentUser=
!0;return va}}Object(c.a)(Qd,"EnsureIsCurrentUserSetTransformer",null,[973]);class dc{constructor(){this.bSa=this.oTa=!1}Doa(va){if(!va)return null;if(void 0===va.UserId||null===va.UserId)return va;if(!va.Email||""===va.Email){let rb;if(rb=Ha.a.CJa(va.UserId))return va=jb(va),va.Email=rb,va}return va}}Object(c.a)(dc,"RestoreEmailTransformer",null,[973]);class dd{constructor(){this.bSa=this.oTa=!1}Doa(va){if(!va)return null;if(void 0!==va.UserId&&null!==va.UserId)return va;switch(this.oTa?this.bSa?
2:1:0){case 0:if(void 0===va.UserId||null===va.UserId)throw e.ULS.sendTraceTag(593368215,327,10,"assignee missing UserId"),Error.argument("assignee.UserId");va=jb(va);break;case 1:if(void 0===va.Id||null===va.Id)throw e.ULS.sendTraceTag(593368214,327,10,"assignee missing Id"),Error.argument("assignee.Id");if(void 0===va.Email||null===va.Email)throw e.ULS.sendTraceTag(593368213,327,10,"assignee missing Email"),Error.argument("assignee.Email");var rb=dd.YLf(va.Id,va.Email,null);if(!rb||""===rb)throw e.ULS.sendTraceTag(593368212,
327,10,"Failed to generate UserId"),Error.argument("UserId");var fc=z.AFrameworkApplication.fa.Wa("HostAuthType")||"";if("aad"!==fc.toLowerCase()||rb.startsWith("S::")){if("msa"===fc.toLowerCase())throw e.ULS.sendTraceTag(593368210,327,10,"Unexpected IPersonObject in MSA Environment"),Error.argument("CommentTaskUserType");e.ULS.sendTraceTag(593368209,327,50,"Receiving IPersonObject with AuthType {0}",fc)}else throw e.ULS.sendTraceTag(593368211,327,10,"Unexpected UserID format"),Error.argument("userId");
va=new kb(rb,"AD",va.DisplayName,va.Email);break;case 2:if(void 0===va.UserPrincipalName||null===va.UserPrincipalName)throw e.ULS.sendTraceTag(593368208,327,10,"assignee missing UserPrincipalName"),Error.argument("assignee.UserPrincipalName");if(void 0!==va.SuggestionSubtype&&null!==va.SuggestionSubtype)if("OrganizationUser"===va.SuggestionSubtype)rb="AD";else throw e.ULS.sendTraceTag(593368207,327,10,"Unexpected LPP SuggestionSubtype : {0}",va.SuggestionSubtype),Error.argument("assignee.SuggestionSubtype");
else throw e.ULS.sendTraceTag(593368206,327,10,"Missing SuggestionSubtype"),Error.argument("assignee.SuggestionSubtype");fc=dd.YLf(va.Id,va.UserPrincipalName,va.AadObjectId);if(!fc||""===fc)throw e.ULS.sendTraceTag(593368205,327,10,"Failed to generate UserId"),Error.argument("UserId");if("AD"===rb&&!fc.startsWith("S::"))throw e.ULS.sendTraceTag(593368204,327,10,"Unexpected UserID and Provider combination"),Error.argument("userId");va=new kb(fc,rb,va.Name,va.UserPrincipalName);break;default:throw e.ULS.sendTraceTag(593368203,
327,10,"Unexpected UserType"),Error.argument("assignee.UserType");}return va}static YLf(va,rb,fc){if(!rb||""===rb)return e.ULS.sendTraceTag(593368218,327,50,"Missing UPN"),va;if(fc&&""!==fc)return"S::"+rb+"::"+fc;if(!va||""===va)return e.ULS.sendTraceTag(593368217,327,50,"Missing ID"),va;if(va.startsWith("S::"))return va;if(-1!==va.indexOf("@")){fc=va.split("@");if(d.a.isValid(fc[0]))return"S::"+rb+"::"+fc[0];e.ULS.sendTraceTag(593368216,327,50,"ID is not in AadObjectId@TenantId format")}return va}}
Object(c.a)(dd,"UserIdCanonicalizationTransformer",null,[973]);class jd{constructor(va,rb,fc=!1,Nc=!1){this.gwg=va;this.Z5d=rb;this.dAg=fc;this.UUb=Nc}gch(){const va=new Ha.a;var rb=new Wa.a(jd.OSh);const fc=new ab;this.Z5d&&(fc.Ofb.push(new dd),fc.Ofb.push(new dc));this.gwg&&fc.Ofb.push(new Qd(va,rb));fc.oTa=this.Z5d;fc.bSa=this.dAg;rb=new ha(rb,fc);const Nc=new ec;return new gd(va,fc,rb,Nc,jd.Fkh,jd.ukh,jd.vkh,this.UUb)}static OSh(){const va=new kb(z.AFrameworkApplication.fa.Wa("PresenceUserId")||
"",z.AFrameworkApplication.fa.Wa("PresenceProvider")||"",z.AFrameworkApplication.userName||"");va.IsCurrentUser=!0;return va}}jd.Fkh="";jd.ukh=5;jd.vkh=0;Object(c.a)(jd,"CommentTaskTranslatorFactory",null,[955]);class md{constructor(){this.vuf=(new jd(!0,!0,!0)).gch()}get Myf(){return this.vuf}jVj(va,rb){const fc=va.HistoryRecords.length,Nc=Array(fc);for(let hd=0;hd<fc;++hd)Nc[hd]=md.cah(va.HistoryRecords[hd]);try{return this.vuf.xhh(va.TaskId,va.AnchorId,Nc,rb)}catch(hd){return e.ULS.sendTraceTag(50918081,
12,10,`TranslateToSharedCommentTaskItem Failed due to [${hd.message}]`),null}}dVj(va){const rb=va?va.length:0,fc=Array(rb);for(let Nc=0;Nc<rb;++Nc)fc[Nc]=this.cVj(va[Nc]);return fc}cVj(va){const rb={};rb.AnchorId=va.commentId;va.assignee&&(rb.Assignee={},rb.Assignee.UserId=va.assignee.UserId,rb.Assignee.Provider=va.assignee.Provider,rb.Assignee.DisplayName=va.assignee.DisplayName);va.schedule&&(rb.DueDate=va.schedule.endDate?va.schedule.endDate.getTime():null,rb.StartDate=va.schedule.startDate?va.schedule.startDate.getTime():
null);rb.Id=va.recordId;rb.Priority=va.priority;rb.Progress=va.completion;rb.Time=va.time.getTime();rb.Title=va.title;switch(va.type){case 2:rb.Type=2;break;case 1:rb.Type=1;break;case 7:rb.Type=8;break;case 10:rb.Type=7;break;case 6:rb.Type=6;break;case 8:rb.Type=9;break;case 5:rb.Type=5;break;case 9:rb.Type=10;break;case 3:rb.Type=3;break;case 4:rb.Type=4;break;default:e.ULS.shipAssertTag(51230686,12,!1,"Unexpected task history type: "+va.type)}rb.UndoId=null;return rb}static hah(va){switch(va){case 0:return 0;
case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6;case 7:return 10;case 8:return 7;case 10:return 9;case 9:return 8;case 11:return-1;default:return 0}}static cah(va){var rb=null;va.User&&(rb=new kb(va.User.UserId,va.User.Provider,va.User.DisplayName));rb=new ma(md.hah(va.Type),rb,new Date(va.Time),va.Id);rb.commentId=va.AnchorId;va.Assignee&&(rb.assignee=new kb(va.Assignee.UserId,va.Assignee.Provider,va.Assignee.DisplayName));if(va.StartDate||va.DueDate)rb.schedule=
new eb,rb.schedule.startDate=va.StartDate?new Date(va.StartDate):null,rb.schedule.endDate=va.DueDate?new Date(va.DueDate):null;rb.priority=va.Priority;rb.completion=va.Progress;rb.title=va.Title;va.UndoId&&(rb.undoId=va.UndoId);return rb}}Object(c.a)(md,"ExcelCommentTaskTranslator",null,[481]);class vd{constructor(va,rb,fc,Nc,hd,xd,ae=null){this.date=this.author=this.commentBody=this.parentId=this.commentId=null;this.commentFlags=0;this.usersByReactionType=null;this.commentId=va;this.parentId=rb;
this.commentBody=fc;this.author=Nc;this.date=hd;this.commentFlags=xd;this.usersByReactionType=ae}}Object(c.a)(vd,"OfficeSharedCommentModel",null,[]);class wd extends vd{constructor(va,rb,fc,Nc,hd,xd,ae){super(va,rb,fc,Nc,hd,xd);this.anchorHintText=null;this.anchorHintText=ae}}Object(c.a)(wd,"ExcelOfficeSharedComment",vd,[]);class Pd{hVj(va,rb,fc){if(!va)return null;let Nc=0;va.hnf&&(Nc|=4);if(rb||fc&&va.e7a)Nc|=1;va.done&&(Nc|=8);va.roi&&(Nc|=16);rb=Na.EwaSettings.isChangeGateEnabled("OfficeVSO:5703292_ExcelPlumbEmailThroughCG")?
Ha.a.CJa(va.authorIdentity||""):"";rb=new Ya(va.authorIdentity||"",va.Bwe||"",va.author||"",rb||"",va.isCurrentUser);return new wd(va.id,va.jk||"",va.commentBody,rb,va.date,Nc,va.jRg||"")}iVj(va,rb,fc){const Nc=[];if(va)for(const hd of va)1!==hd.commentType&&Nc.push(this.hVj(hd,rb,fc));return Nc}}Object(c.a)(Pd,"ExcelSharedCommentModelTranslator",null,[480]);var ic=a(161),cd=a(1008),Hd=a(719),he=a(802);class Lb{constructor(va,rb){this.vZb=va;this.inputMethod=rb}}Object(c.a)(Lb,"ActionDataWithInputMethod",
null,[]);var Ic=a(121),Ob=a(86),Kc=a(436),Ac=a(525),Yc=a(474),td=a(149),$d=a(125),be=a(57);class ke{constructor(va,rb,fc,Nc,hd){this.aP=this.Tq=this.UDa=this.Xe=null;this.mJc=this.z4d=!1;this.iZb=null;this.x4d=!1;this.w6d=this.Zee=null;this.H8=this.uOe=!1;this.V8=this.rge=this.PQc=null;this.Ma=va;this.ti=rb;this.Yd=fc;this.Zb=Nc;this.WO=hd;this.cqa=l.KeyInputManager.Al(Ob.a.Voa,0)}get Rnb(){return this.x4d}set Rnb(va){(this.x4d=va)||this.QWc()}get t7g(){return"CommentPane"}get isVisible(){return this.H8}set isVisible(va){this.H8=
va}get ks(){return this.PQc}get EAd(){return this.aP}get C$b(){return this.WO}get G3i(){return this.rge}get Yg(){return this.V8}get ZMb(){return!0}get b8f(){return!0}get Srh(){return CommonUIStrings.l_CommentPaneEmpty1}get Trh(){return CommonUIStrings.l_CommentPaneEmpty2}get Bhc(){return 2===this.Xe.mode||3===this.Xe.mode}initialize(va,rb){this.Xe=va;this.rge=rb;va=this.ufh();this.G3i.appendChild(va);this.Ag()}dispose(){this.ZMb&&this.Tq&&(this.ti.Ba(k.a.click,this.Tq,Object(E.a)(this,this.ll,"onClosePaneClick")),
this.Yd.Xw(this.Tq,this.w6d));this.b8f&&this.aP&&(this.ti.Ba(k.a.click,this.aP,Object(E.a)(this,this.RDd,"onNewCommentClick")),this.Yd.Xw(this.aP,this.Zee));this.Yg&&this.ti.Ba(k.a.click,this.Yg,Object(E.a)(this,this.av,"clearSelection"));const va=this.Zb.pi(Y.AFrame.Ro);va.yk(this.cqa);va.yk(ia.FocusManager.instance().S1);va.yk(ia.FocusManager.instance().T1);this.aP=this.PQc=this.Tq=this.V8=null}O9f(){this.ks.innerText="";var va=Hd.a("div","","CommentPaneEmpty1");va.innerText=this.Srh;this.ks.appendChild(va);
0!==this.Xe.mode&&(va=Hd.a("div","","CommentPaneEmpty2"),va.innerText=this.Trh,this.ks.appendChild(va))}XR(){this.ks.innerText="";const va=Hd.a("div","","CommentPaneEmpty1");va.innerText=CommonUIStrings.l_CommentPaneError;this.ks.appendChild(va)}AJj(){this.ks.innerText="";const va=Hd.a("div","","");va.style.textAlign="center";var rb=document.createElement("img");rb.className="CommentPaneLoading";rb.src=Ic.a.Xsa("progress.gif");va.appendChild(rb);rb=Hd.a("div","","CommentPaneLoadingText");rb.innerText=
CommonUIStrings.l_CommentLoading;va.appendChild(rb);this.ks.appendChild(va)}showComments(va){be.a.rrb(this.ks);if(va.length)for(let rb=0;rb<va.length;rb++){const fc=va[rb],Nc=rb?va[rb-1]:null;(!rb||Nc.n5a<fc.n5a)&&this.ks.appendChild(this.$5b());this.ks.appendChild(fc.render())}else this.O9f();this.mJc=!0;this.Poa();this.iZb&&(this.iZb.focus(),this.iZb=null)}selectComment(va){this.mJc?va.focus():this.iZb=va}Yhf(va,rb){return!va||!rb||va.n5a!==rb.n5a}uXf(va){var rb=this.Xe.model.Wbc(va,!1);const fc=
this.Xe.model.Iwb(va,!1);rb||fc||be.a.rrb(this.ks);rb=this.Yhf(rb,va);const Nc=this.Yhf(fc,va);let hd=null;fc&&(hd=fc.pj,Nc&&(hd=hd.previousSibling));this.vXf(va,hd,rb&&Nc)}oXf(va){const rb=va.pj.nextSibling;this.ks.removeChild(va.pj);this.vXf(va,rb,!1)}XNi(va){ke.UCe(va.element);ke.NUf(va.element)}zzf(va){va.element.style.marginTop="";ke.NUf(va.element)}gLd(va){const rb=[];var fc=null,Nc=null;for(var hd=0;hd<va.length;hd++){fc=va[hd];hd||(Nc=fc.pj.previousSibling);if(hd===va.length-1){const xd=fc.pj.nextSibling;
Nc&&Sys.UI.DomElement.containsCssClass(Nc,"CommentGroupDivider")&&(!xd||Sys.UI.DomElement.containsCssClass(xd,"CommentGroupDivider"))&&Array.add(rb,Nc)}fc=fc.pj;Array.add(rb,fc)}Nc=0;if(va=fc.nextSibling){Nc=va.offsetTop;for(hd=0;hd<rb.length;hd++)rb[hd].style.display="none";Nc=va.offsetTop-Nc;for(hd=0;hd<rb.length;hd++)rb[hd].style.display=""}ke.lRg(rb,va,Nc,Object(E.a)(this,this.YNi,"onAfterFadeOut"),Object(E.a)(this,this.zzf,"onAfterMove"))}Ag(){this.Ma.Nb(ea.a.eba,t.a.frame,Object(E.a)(this,this.eba,
"hideCommentPane"));this.Ma.Nb(ea.a.editComment,t.a.frame,Object(E.a)(this,this.editComment,"editComment"));this.Ma.Nb(ea.a.bO,t.a.frame,Object(E.a)(this,this.bO,"selectNextComment"));this.Ma.Nb(ea.a.PR,t.a.frame,Object(E.a)(this,this.PR,"selectPrevComment"));this.Ma.Oe(ea.a.JIb,t.a.frame,Object(E.a)(this,this.JIb,"queryToggleCommentPane"),96);this.Ma.Nb(ea.a.N3c,t.a.frame,Object(E.a)(this,this.JEe,"commentMoveFocusForTabsHandler"));this.Ma.Nb(ea.a.M3c,t.a.frame,Object(E.a)(this,this.JEe,"commentMoveFocusForTabsHandler"))}YNi(va){va.element.parentNode&&
va.element.parentNode.removeChild(va.element);this.ks.childNodes.length||this.O9f()}F9a(){this.Poa()}ufh(){const va=Hd.a("div",this.t7g,"CommentPane");var rb=Hd.a("label",cd.a.O3c,cd.a.O3c);rb.innerText=CommonUIStrings.l_CommentTabHelp;va.appendChild(rb);this.ZMb&&(rb=this.pM(),va.appendChild(rb));this.b8f&&(rb=this.W5c(),va.appendChild(rb));rb=Hd.a("div","CommentPaneSurface","CommentPaneSurface");this.Xe.a5c||(Sys.UI.DomElement.addCssClass(va,"DisableSelection"),va.setAttribute("Unselectable","on"));
va.appendChild(rb);this.V8=va;this.PQc=rb;this.Poa();this.lSa();this.ti.ta(k.a.click,va,Object(E.a)(this,this.av,"clearSelection"));this.AJj();return va}pM(){const va=Hd.b("div","CommentPaneHeader","CommentPaneHeader"),rb=Hd.b("span","CommentPaneTitle","PaneTitle CommentPaneTitle UIFontLight");rb.innerText=CommonUIStrings.L_OpenCommentPane;const fc=he.a.pb("CloseCommentPane","CommentPaneCloseButton",CommonUIStrings.l_Close,"ClosePaneGlyph_16x16x32",!1);Sys.UI.DomElement.addCssClass(fc,z.AFrameworkApplication.isRtl?
"FloatLeft":"FloatRight");this.ti.ta(k.a.click,fc,Object(E.a)(this,this.ll,"onClosePaneClick"));this.w6d=this.Yd.Dt(fc,Object(E.a)(this,this.ll,"onClosePaneClick"),Ob.a.Lh);va.appendChild(rb);va.appendChild(fc);this.Tq=fc;return va}W5c(){this.UDa=Hd.b("div","CommentPaneControls","CommentPaneControls");const va=he.a.pb("CommentPaneNewComment","CommentPaneNewComment",CommonUIStrings.l_CommentNewCommentButton,"CommentNew_16x16x32");this.UDa.appendChild(va);this.ti.ta(k.a.click,va,Object(E.a)(this,this.RDd,
"onNewCommentClick"));this.Zee=this.Yd.Dt(va,Object(E.a)(this,this.RDd,"onNewCommentClick"),Ob.a.Lh);this.aP=va;return this.UDa}$5b(){const va=Hd.a("div","","CommentGroupDivider");this.z4d||Sys.UI.DomElement.addCssClass(va,"CommentGroupDividerFirst");this.z4d=!0;va.innerText="";return va}Poa(){0===this.Xe.mode||-1===this.Xe.mode?(this.UDa&&(this.UDa.style.display="none"),Sys.UI.DomElement.addCssClass(this.ks,"ReadOnly")):(Sys.UI.DomElement.removeCssClass(this.ks,"ReadOnly"),this.UDa&&(this.UDa.style.display=
"inline-block"),this.Bhc||4===this.Xe.mode?(Sys.UI.DomElement.addCssClass(this.ks,"CommentInProgress"),Sys.UI.DomElement.removeCssClass(this.ks,"Interactive"),this.aP&&this.K5f(!1)):(Sys.UI.DomElement.addCssClass(this.ks,"Interactive"),Sys.UI.DomElement.removeCssClass(this.ks,"CommentInProgress"),this.aP&&this.K5f(this.mJc)))}K5f(va){he.a.Ddb(this.aP,va)}lSa(){const va=this.Zb.pi(Y.AFrame.Ro);va.parent=Y.AFrame.wT;this.ti.$nb(Y.AFrame.Ro,this.Yg);va.Ura(()=>{let rb;rb=this.aP.disabled&&this.Tq?this.Tq:
this.aP;rb.focus();this.Xe.MJ().ef.Fl(rb);this.Xe.MJ().ef.ao(5)});va.SWc(()=>{2!==this.Xe.mode&&3!==this.Xe.mode&&this.Xe.av()});this.WO.Xnb(Y.AFrame.Ro);va.bindAction(l.KeyInputManager.Al(Ob.a.Woa,0),ea.a.PR);va.bindAction(l.KeyInputManager.Al(Ob.a.R7,0),ea.a.bO);va.bindAction(this.cqa,ea.a.eba)}FSf(va){va.yk(this.Zb.S1);va.yk(this.Zb.T1);va.bindAction(this.Zb.S1,ea.a.N3c);va.bindAction(this.Zb.T1,ea.a.M3c)}JEe(va){let rb=this.Xe.MJ().ef.xi;const fc=this.Xe.model.tAa;if(!rb){rb=document.activeElement;
this.Yg.contains(rb)||(rb=fc?fc.pj:this.Xe.Yg.EAd);if(!rb)return 4;this.Xe.MJ().ef.Fl(rb)}return va===ea.a.N3c?this.hya(rb,fc):va===ea.a.M3c?this.vOa(rb,fc):2}hya(va,rb){const fc=this.Bhc;if(va===this.aP&&this.Xe.model.mld()&&!this.Bhc)return this.Xe.bO(),32;if(rb&&va===rb.pj)this.Xe.MJ().ef.Fl(va.firstChild);else if(-1!==va.className.indexOf(cd.a.HEe)){if(rb){if(this.Xe.model.Iwb(rb,!1))return this.Xe.bO(),32;fc||this.Xe.model.av();this.Xe.MJ().ef.Fl(rb.pj)}}else{if(-1!==va.className.indexOf(cd.a.Q3c))return this.Xe.MJ().ef.Fl(rb.REe.tsj),
32;-1!==va.className.indexOf(cd.a.OEe)&&this.Xe.MJ().ef.Fl(rb.pj)}this.Xe.MJ().hya();return 32}vOa(va,rb){if(va===this.aP)return this.Xe.MJ().vOa(),32;if(rb)if(va===rb.pj)if(va=this.Bhc,this.Xe.model.Wbc(rb,!1)){if(!va)return this.Xe.PR(),(rb=this.Xe.model.tAa.REe.Ykh)&&this.Xe.MJ().ef.Fl(rb),32}else va||this.Xe.av();else{if(-1!==va.className.indexOf(cd.a.NEe)||-1!==va.className.indexOf(cd.a.GEe))return this.Xe.MJ().ef.Fl(rb.pj),32}else if((-1!==va.className.indexOf(cd.a.y7g)||-1!==va.className.indexOf(cd.a.u7g))&&
this.Xe.model.mld())return this.Xe.PR(),32;this.Xe.MJ().vOa();return 32}ll(){this.Ma.processAction(ea.a.eba,2);return!0}av(){this.Zb.Qj(Y.AFrame.Ro);this.Xe&&2!==this.Xe.mode&&3!==this.Xe.mode&&this.Xe.av();return!0}RDd(){if(this.aP.disabled)return!0;this.QWc();return!0}QWc(){this.Zb.Qj(Y.AFrame.Ro);this.Xe.bob(null)}bob(va,rb,fc,Nc,hd){1!==fc&&(this.isVisible?this.QWc():(va=0,Object(m.a)(Lb,hd)&&(va=hd.inputMethod),hd=new Lb(hd,va),this.Rnb=!0,this.Ma.Vd(ea.a.n7,2,hd)))}editComment(va,rb,fc,Nc,hd){if(1===
fc)return 1===this.Xe.mode?32:8;if(this.isVisible){va=this.Xe.model.nt(hd);if(!va)return 8;va.WCd()}else this.uOe=!0,this.Ma.Vd(ea.a.n7,2,hd);return 32}bO(va,rb,fc){if(1===fc)return 32;this.Xe.bO();return 32}PR(va,rb,fc){if(1===fc)return 32;this.Xe.PR();return 32}vXf(va,rb,fc){const Nc=va.render(),hd=[];let xd=0,ae=0;rb?(ae=rb.offsetTop,this.ks.insertBefore(Nc,rb)):this.ks.appendChild(Nc);Array.add(hd,Nc);fc&&(fc=this.$5b(),this.ks.insertBefore(fc,Nc),Array.add(hd,fc));rb&&(xd=rb.offsetTop-ae);ke.oRg(hd,
rb,xd,Object(E.a)(this,this.XNi,"onAfterFadeIn"),Object(E.a)(this,this.zzf,"onAfterMove"));0!==va.commentType&&va.focus()}static oRg(va,rb,fc,Nc,hd){for(let ae=0;ae<va.length;ae++){var xd=va[ae];rb?td.WacAirSpace.XK(xd,"WAC_DelayShowClass"):td.WacAirSpace.XK(xd,"Shared_BasicClass");xd=new Yc.a(xd);xd.bJ(0,1);td.WacAirSpace.animate(xd,null,Nc)}rb&&(va=ke.M2e(rb),rb.style.position="relative",td.WacAirSpace.XK(rb,"Shared_BasicClass"),rb=new Ac.a(rb),rb.hsa(va-fc,va),td.WacAirSpace.animate(rb,null,hd))}static lRg(va,
rb,fc,Nc,hd){for(let ae=0;ae<va.length;ae++){var xd=va[ae];td.WacAirSpace.XK(xd,"Shared_BasicClass");xd=new Kc.a(xd);xd.bJ(1,0);td.WacAirSpace.animate(xd,null,Nc)}rb&&(va=ke.M2e(rb),rb.style.position="relative",td.WacAirSpace.XK(rb,"WAC_DelayMoveClass"),rb=new Ac.a(rb),rb.hsa(va,fc+va),td.WacAirSpace.animate(rb,null,hd))}static NUf(va){var rb=va.className;if(rb){rb=rb.split(" ");for(let fc=0;fc<rb.length;fc++){const Nc=rb[fc];Nc.startsWith(td.WacAirSpace.Tob)&&Sys.UI.DomElement.removeCssClass(va,
Nc)}}}static M2e(va){va=$d.a.OA(va);let rb=0;va&&va.marginTop&&(rb=parseInt(va.marginTop),rb=isNaN(rb)?0:rb);return rb}static UCe(va){h.a.Uka?va.style.filter="":va.style.opacity=""}}Object(c.a)(ke,"CommentPane",null,[2,479]);class Pe extends B{constructor(va){super(va)}lhj(va){this.Rfj(va)}dZj(va){this.nig(va)}vCj(va){va=this.rch(va);for(let rb=0;rb<this.xV.count;++rb)Array.enqueue(this.xV.ma(rb).yU,va);this.e0(!0)}rch(va){const rb=new C;rb.eventType=3;rb.viewContainerVisibilityState=va;return rb}AJh(){const va=
this.bih();for(let rb=0;rb<this.xV.count;++rb)Array.enqueue(this.xV.ma(rb).yU,va);this.e0(!0)}bih(){const va=new C;va.eventType=2;return va}}Object(c.a)(Pe,"ViewContainerEventHost",B,[943]);class Dd{constructor(){this.hTc=this.o4d=!1;this.hga=this.Hn=this.pae=this.Dde=this.Cme=this.Dge=this.qle=this.U6d=this.Hl=this.ymb=null}initialize(va,rb,fc,Nc=null,hd=null,xd=null,ae=null,Wd=null,Ne=null,Ue=null){this.Hl=va;this.U6d=rb;this.qle=fc;this.Dge=Nc;this.Cme=hd;this.Dde=xd;this.pae=ae;this.Hn=Wd;this.o4d=
!0;this.hga=Ne;this.ymb=Ue}Fff(va=null){if(!this.o4d)return e.ULS.sendTraceTag(41424203,201,10,"InstantiateSharedComments called before activation manager initialization."),new Promise((rb,fc)=>{fc(x.a.dt(-2130915313))});if(this.hTc)return e.ULS.sendTraceTag(41424204,201,10,"InstantiateSharedComments called after shared comments was already instantiated."),new Promise(()=>{});this.ymb||(z.AFrameworkApplication.fa.pa("DynamicBundlesIsEnabled")?this.ymb=appResourceLoader.loadChunk("sharedComments"):
this.ymb=this.Hl.loadScript("sharedComments"));return this.ymb.then(()=>{va&&va();this.hTc||(this.hga&&this.hga.execute(rb=>{rb.logActivity("Office_Docs_SharedComments_InitializeWebFloodgate","InitializeFloodgateServiceInCommentsPane")}),sharedComments.instantiate(this.U6d,this.qle,this.Dge,this.Cme,this.Dde,this.pae,this.Hn));this.hTc=!0})}}Object(c.a)(Dd,"CommentActivationManager",null,[954]);class ge{constructor(va,rb,fc,Nc){this.isRightToLeft=!1;this.dataCulture=this.uiCulture=this.appLocale=
null;this.isRightToLeft=va;this.appLocale=rb;this.uiCulture=fc;this.dataCulture=Nc}}Object(c.a)(ge,"LocalizationDetails",null,[]);var ne=a(519);class ce{constructor(va,rb){this.CGg=va;this.dA=rb}getViewContainer(){return this.CGg}registerForViewContainerEvents(va){this.dA.lhj(va)}unregisterForViewContainerEvents(va){this.dA.dZj(va)}}Object(c.a)(ce,"ViewContainerProvider",null,[953]);class we{constructor(va,rb){this.canvasContextId=this.canvasActionId=0;this.withFlags=!1;this.postCallback=this.registeredCallback=
this.preCallback=null;this.delayActionsUntilRegistration=!1;this.canvasActionId=va;this.canvasContextId=rb}}Object(c.a)(we,"CommentUIAction",null,[]);var ve=a(221),Re=a(153),rf=a(166),We=a(836),Ye=a(713);class bf extends We.a{constructor(){super();this.comment=this.commentId=null;this.H_=Object.assign(new Ye.a,{T_:bf.getTypeName(),B_:bf.Kd()})}static getTypeName(){return"AugLoop_SmartReply_CommentSmartReplySignal"}static Kd(){return["AugLoop_Signals_Signal"]}}Object(c.a)(bf,"CommentSmartReplySignal",
We.a,[]);var Ve=a(736);class Za extends Ve.a{constructor(){super();this.DomainName=this.CommentId=null;this.ConfidenceLevel=0;this.ElapsedTime=this.ResultSets=null;this.H_=Object.assign(new Ye.a,{T_:Za.getTypeName(),B_:Za.Kd()})}static getTypeName(){return"AugLoop_SmartReply_SmartReply"}static Kd(){return["AugLoop_Core_Annotation"]}}Object(c.a)(Za,"SmartReply",Ve.a,[]);var Xb=a(884),ib=a(990);class Rb{constructor(va){this.Hug=va}m6c(va,rb){return Object.assign(new ib.a,{parentPath:["Signal",bf.getTypeName()],
items:[Object.assign(new Xb.a,{body:Object.assign(new bf,{commentId:va,comment:rb})})]})}MGd(va){const rb=new w.a;if(va&&va.CommentId&&va.ResultSets&&0<va.ResultSets.length&&va.ResultSets[0].Documents&&0<va.ResultSets[0].Documents.length){for(const fc of va.ResultSets[0].Documents)rb.add(fc.Caption);0<rb.count&&this.Hug.MGd(va.CommentId,rb.toArray())}else e.ULS.sendTraceTag(574493152,327,10,"Invalid response from SmartReplies request")}getTypeName(){return Za.getTypeName()}}Object(c.a)(Rb,"BaseCommentSmartReplyProvider",
null,[149]);var lc=a(730);class nc extends Rb{constructor(va,rb){super(va);this.I8h=(fc,Nc)=>{(fc=Nc.BG)&&lc.a.Hva(fc)===this.getTypeName()&&1===Nc.operationType?this.MGd(fc):e.ULS.sendTraceTag(537167437,12,10,"Invalid annotation event for smart replies")};this.augmentationLoopManager=rb}initialize(){if(this.augmentationLoopManager){const va=this.getTypeName();this.augmentationLoopManager.register(this.augmentationLoopManager.a4a().Kdb("CommentSmartReply").Hdb(()=>{}).activateAnnotation({annotationType:va,
iz:!1,zV:this.I8h}).build())}}invoke(va,rb){this.augmentationLoopManager&&this.augmentationLoopManager.mOb(Object(b.a)(new bf,{commentId:va,comment:rb}))}}Object(c.a)(nc,"CommentSmartReplyProvider",Rb,[]);class Oc{constructor(){this.Hn=null;this.shb=this.cCg=this.AHc=this.ole=this.Eme=this.glb=this.gie=!1}s7e(){this.Hn||(e.ULS.sendTraceTag(588292828,327,10,"OfficeSharedCommentsAppCapabilities: AppSettings object should not be empty"),this.s6f());return this.Hn}N4e(){return new Promise((va,rb)=>{this.shb?
va(this.O4e()):this.P3f().then(()=>{va(this.O4e())}).catch(fc=>{rb(fc)})})}O4e(){this.shb||e.ULS.sendTraceTag(588292829,327,10,"OfficeSharedCommentsAppCapabilities: GetModelCapabilitiesInternal should not be called before AtMentions are resolved");let va;va=33;this.AHc&&(va|=2);this.gie&&(va|=8);this.Eme&&(va|=16);this.glb&&(va|=4);this.ole&&(va|=64);this.cCg&&(va|=128);return va}}Object(c.a)(Oc,"OfficeSharedCommentsAppCapabilities",null,[872]);var Ib=a(33);class gc extends Oc{constructor(va,rb,fc,
Nc){super();this.$=va;this.oMf=fc;this.excelCommentManager=rb;this.N2a=Nc;this.jAj();this.s6f()}get zxf(){return this.glb}set zxf(va){this.glb!==va&&(this.glb=va,this.cIh())}s6f(){const va=this.excelCommentManager.GAb;this.Hn={};this.Hn.LivePersonaPicker="true";this.Hn.PersonaColor="true";this.Hn.NewCommentButton="true";this.Hn.DisabledChangeGates="WebThemeIntegrationHighContrastFixes,"+this.$.ya.DisabledChangeGatesInSharedComments;this.Hn.CommentsFluentUI="true";this.Hn.CommentTasks=va.toString();
this.Hn.CommentTasksFromReply=(va&&Na.EwaSettings.isChangeGateEnabled("OfficeVSO:4017579_DocumentTasksCreateFromReply")).toString();this.Hn.CommentsFluentUIV2="true";this.Hn.AtMentionFloodgateSurvey=this.$.ya.AtMentionFloodgateSurveyEnabled.toString();this.Hn.DiscreteHostedComments="true";this.Hn.LogDraftCommentIdPair="true";this.Hn.NewModelState="true";this.Hn.NewResolvedCardDesignInWeb="true";this.Hn.HyperlinksInComments=Na.EwaSettings.isChangeGateEnabled("OfficeVSO:7507099_ReplaceHyperlinksFGWithCG").toString();
this.Hn.HyperlinksWithDisplayText=Na.EwaSettings.isChangeGateEnabled("OfficeVSO:7507099_ReplaceHyperlinksFGWithCG").toString();this.Hn.NewBorderAndFocusLookInWeb="true";this.Hn.ExtendedDrafting="true";this.Hn.NewSelectionInteractions="true";this.Hn.SmartReplies=Na.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartRepliesIsEnabled",!1).toString();this.Hn.PersonaIconImageForWeb="true";this.Hn.TaskPaneWithNewInfrastructure=Ib.a.qmf(this.$).toString();this.Hn.LinkToComment="true";this.Hn.NoDiscardOnFocusLoss=
"true";this.Hn.WebThemeIntegration="true";this.Hn.TaskHistoryRecordIDs=Na.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.TaskHistoryRecordIDs",!1).toString()}jAj(){this.ole=this.excelCommentManager.GAb;this.Eme=!1;this.glb=this.gie=!0;this.P3f()}P3f(){return new Promise((va,rb)=>{this.$.uBb()?(this.AHc=!1,this.shb=!0,va(!1)):this.oMf?this.oMf.atMentionsEnabledAsync().then(fc=>{this.AHc=fc;this.shb=!0;va(this.shb)}):(e.ULS.sendTraceTag(537167308,0,10,"OfficeSharedCommentsAppCapabilities: SetAtMentionCapabilityAsync should not be called before _peopleAPIInstance is initialized"),
rb(x.a.dt(-2130915320)))})}cIh(){this.N4e().then(va=>{this.N2a.$0j(va)})}}Object(c.a)(gc,"ExcelSharedCommentsAppCapabilities",Oc,[]);class Fc{constructor(va,rb){this.Svg=va;this.Wt=rb}get contextId(){return 1}get mFb(){return null}get xhc(){return!1}get gic(){return!1}get c9c(){return this.Svg}get gridView(){return this.Wt}}Object(c.a)(Fc,"NextOrPrevCommentContext",null,[205]);var Vc=a(523),ed=a(50),Sd=a(140),Zd=a(37),pa=a(28),zb=a(381),Vb=a(105),xc=a(187);class Sc extends ke{constructor(va,rb,fc,
Nc,hd,xd,ae,Wd,Ne,Ue,xe){super(va,fc,Nc,hd,xd);this.twd=this.V8=this.sWb=this.Wsa=this.u6=null;this.Zdb=this.$zc=this.y4d=!1;this.setWebpackPublicPath=()=>{Vc.a(this.$)};this.xz=()=>{this.mFc.vCj(this.commentTaskPane.isVisible?3:1);if(Na.EwaSettings.isChangeGateEnabled("OfficeVSO:5015813_SyncNewCommentButtonWithRibbon")){const Ze=rf.a(this.$);Ze&&(this.commentTaskPane.isVisible?Ze.uOg(this.$$e):Ze.jlj(this.$$e))}};this.$$e=()=>{const Ze=Re.b(this.$).un("-1667294294");this.Wsa.zxf=Ze};this.eba=(Ze,
tf,Of)=>{1!==Of&&(this.commentTaskPane.Kg(!1),this.isVisible=!1,this.excelCommentManager.gridViewSetFocus());return 32};this.JIb=()=>32;this.wj=()=>{};this.cqc=()=>{this.Zb.Qj(Y.AFrame.Ro);return!1};this.fJj=(Ze,tf,Of)=>1===Of?this.Zdb?2:32:2!==Of||this.Zdb?2:(this.$zc=!0,32);this.eJj=(Ze,tf,Of,bg)=>this.$zc&&2===bg&&Ze?(this.$zc=!1,this.Qef(),32):2;this.X8g=(Ze,tf,Of)=>1===Of?this.excelCommentManager.Fka()?8:this.excelCommentManager.Haf()?this.Qjf(this.excelCommentManager.sC)||this.excelCommentManager.Fka()?
8:32:8:2;this.Y8g=(Ze,tf,Of)=>1===Of&&(Ze=this.excelCommentManager.sC,(tf=(!Ze||!Ze.hnf)&&this.excelCommentManager.Use(this.excelCommentManager.mode)&&!this.Qjf(Ze))&&Ze&&Ze.isResolved&&(tf=!1),this.excelCommentManager.Rm&&this.excelCommentManager.Rm.WE||!tf)?8:this.isVisible||1!==Of||this.Zdb?2:32;this.DFe=(Ze,tf,Of)=>1!==Of&&!this.excelCommentManager.hasCommentAtActiveCell&&this.excelCommentManager.Dih&&2===Of?(tf=Object(Ma.a)(Fc,tf),this.excelCommentManager.Guj(Ze===ea.a.bO,tf?tf.c9c:!1),32):2;
this.mZe=(Ze,tf,Of,bg)=>{tf=(tf=Object(Ma.a)(Fc,Of))?tf.c9c:!1;Ze&&2===bg&&tf&&(this.excelCommentManager.setFocus(!0,!1),this.Zb.Qj(Y.AFrame.Ro));return Ze?32:8};this.Phg=Ze=>{if(this.excelCommentManager.Fka())return 2;Ze=new Ja.a(Ze===ea.a.t_d?-1502853784:-111689794,1,2,6,null);this.$.Ia.Hb(Ze);return 32};this.ti=fc;this.Zb=hd;this.excelCommentManager=ae;this.mFc=new Pe(z.AFrameworkApplication.ji,"CommentPane");this.$=Wd;this.$.dC(this.wj);this.commentTaskPane=Ne;this.commentTaskPane.kE(this.xz);
this.taskManager=rb;this.qHg=this.Wah();this.GZb=new Dd;this.N2a=Ue;this.ha=xe}get L3c(){return"CommentPane"}dispose(){this.$&&this.$.zF(this.wj);this.V8&&this.ti.Ba(k.a.click,this.V8,Object(E.a)(this,this.av,"clearSelection"));this.commentTaskPane&&this.commentTaskPane.BF(this.xz);const va=this.Zb.pi(Y.AFrame.Ro);va.yk(ia.FocusManager.instance().S1);va.yk(ia.FocusManager.instance().T1);this.sWb=this.V8=this.u6=this.commentTaskPane=this.$=this.excelCommentManager=null;super.dispose()}initialize(va,
rb){this.Xe=va;this.sWb=rb;va=this.vfh();this.sWb.appendChild(va);this.Ag();this.ti.Pza(k.a.click,this.sWb,this.cqc,null,!0);this.V8.style.display="flex";this.twd=new ge(z.AFrameworkApplication.isRtl,Sys.CultureInfo.CurrentCulture.name,z.AFrameworkApplication.uiCulture,z.AFrameworkApplication.dataCulture);va=Gb.a.instance.Tb("Common.App.People.IExternalPeopleAPI");this.Lgi(va)}Lgi(va){ne.a.Rq(va).continueWith(rb=>{this.u6=rb.result;Na.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartRepliesIsEnabled",
!1)?(this.Gef(this.u6),this.Zgi(fc=>{this.excelCommentManager.Kef(this.u6,this.Wsa,fc);this.Nef()})):(this.Gef(this.u6),this.excelCommentManager.Kef(this.u6,this.Wsa,null),this.Nef())})}Nef(){Na.EwaSettings.isChangeGateEnabled("OfficeVSO:7457857_DynamicScriptLoaderNewService")?void(()=>Object(ic.a)(this,void 0,void 0,function*(){const va=yield xc.a.resolve(Vb.e,{Tl:0});this.GZb.initialize(va.Hl,this.excelCommentManager.CY,this.excelCommentManager.eYd,this.u6,new ce(this.excelCommentManager.lFc,this.mFc),
this.twd,null,this.Wsa.s7e());yield this.GZb.Fff(this.setWebpackPublicPath);this.ogc()}))():Zd.TaskExtensions.za(ed.GetServiceTaskFactory.Oa(this.$.da,283,284,0),va=>{this.GZb.initialize(va.result.Hl,this.excelCommentManager.CY,this.excelCommentManager.eYd,this.u6,new ce(this.excelCommentManager.lFc,this.mFc),this.twd,null,this.Wsa.s7e());this.GZb.Fff(this.setWebpackPublicPath).then(()=>{this.ogc()})},this.$.da.la,3)}Zgi(va){Zd.TaskExtensions.za(ed.GetServiceTaskFactory.Oa(this.$.da,328,327,1),rb=>
{(rb=rb.result)?(e.ULS.sendTraceTag(537167312,12,50,"ExcelSharedCommentPane::InitializeCommentSmartReplyProvider - AugmentationLoopManager instantiated."),rb=new nc(this.N2a,rb),rb.initialize(),va(rb)):(e.ULS.sendTraceTag(537167313,12,10,"ExcelSharedCommentPane::InitializeCommentSmartReplyProvider - Failed to instantiate AugmentationLoopManager."),va(null))},this.$.la,3)}Gef(va){this.Wsa=new gc(this.$,this.excelCommentManager,va,this.N2a)}ogc(){this.Zdb=!0;this.excelCommentManager.$nd();this.s_b?
(this.s_b=!1,this.excelCommentManager.VI.K_(ea.a.T9a,null,2,null,null)):this.$zc?this.excelCommentManager.VI.K_(ea.a.Ffb,null,2,null,null):this.Qef();const va=this.excelCommentManager.CY;va&&va.checkAtMentionCapability().then(fc=>{fc&&(fc=Gb.a.instance.Tb("Common.ISystemInitiatedFeedback"))&&fc.execute(Nc=>{Nc.logActivity("Office_Docs_SharedComments_InitializeWebFloodgate","InitializeFloodgateServiceInCommentsPane")})});const rb=sharedComments.RichContentEditAPIFactoryGlobal.getRichContentEditAPI();
void xc.a.resolve(Vb.l).then(fc=>{rb.registerSafelinksNavigator(fc.OBa.bind(fc))})}setFocus(){this.jIh&&this.mFc.AJh()}selectComment(){this.isVisible&&this.Zb.Qj(Y.AFrame.Ro)}Ag(){this.Ma.Nb(ea.a.eba,t.a.frame,this.eba);this.Ma.Nb(ea.a.editComment,t.a.frame,Object(E.a)(this,this.editComment,"editComment"));this.Ma.Nb(ea.a.t_d,t.a.frame,this.Phg);this.Ma.Nb(ea.a.oTf,t.a.frame,this.Phg);this.Ma.Oe(ea.a.JIb,t.a.frame,this.JIb,96)}ll(va){const rb=new Ja.a(999391620,2,this.$.xc,30,null);this.$.Ia.Hb(rb,
{["event"]:va.Ea},va.Ea);return!0}get s_b(){return this.y4d}set s_b(va){this.y4d=va}get jIh(){return document.getElementById(x.a.cei)}bob(va,rb,fc,Nc,hd){this.commentTaskPane.isVisible?this.excelCommentManager.nxc(hd):this.Xe.model.mld()||this.Zdb||(this.s_b=!0);this.Zb.Qj(Y.AFrame.Ro);this.Zdb&&(this.excelCommentManager.hasCommentAtActiveCell?x.a.QYa(this.taskManager,()=>{this.excelCommentManager.VI.K_(ea.a.T9a,rb,fc,Nc,hd)}):this.excelCommentManager.VI.K_(ea.a.T9a,rb,fc,Nc,hd));e.ULS.sendTraceTag(537167310,
12,50,`Comment pane opened. Source=${Nc.gU}. Method=${Nc.LY}`)}n7(va,rb,fc,Nc,hd){if(1===fc)return 32;e.ULS.sendTraceTag(36988121,12,50,"New Comment Pane opened.");va=this.Xe.mode;if(4===va||2===va||3===va)return 32;va=null;this.$.Jb&&(va=this.$.Jb.zg("ModelUpdate","CommentPaneRender"),va.start());this.isVisible=!0;this.Rnb&&hd?(this.excelCommentManager.nxc(hd),this.Rnb=!1):(this.setFocus(),this.Zb.Qj(Y.AFrame.Ro),this.excelCommentManager.hasCommentAtActiveCell&&(hd=this.excelCommentManager.sC)&&
this.Xe.selectComment(hd.id,1));va&&va.stop();return 32}Ffb(va,rb,fc,Nc,hd){return this.isVisible?this.eba(va,rb,fc,Nc,hd):this.n7(va,rb,fc,Nc,hd)}gLd(){}vfh(){const va=Hd.a("div",this.L3c,this.L3c);this.V8=va;this.tDj();return va}tDj(){const va=this.Zb.pi(Y.AFrame.Ro);va.parent=Y.AFrame.wT;va.gN=!0;va.Y0d=!0;this.ti.$nb(Y.AFrame.Ro,this.V8,va.Y0d);va.Ura(()=>{this.setFocus()});va.SWc(()=>{2===this.Xe.mode||3===this.Xe.mode||this.excelCommentManager.hasCommentAtActiveCell||this.Xe.av()});this.WO.Xnb(Y.AFrame.Ro);
va.bindAction(l.KeyInputManager.Al(Ob.a.rGc,l.KeyInputManager.AEe),ea.a.t_d);va.bindAction(l.KeyInputManager.Al(Ob.a.qGc,l.KeyInputManager.AEe),ea.a.oTf)}Qjf(va){return!!va&&va.e7a&&(new Sd.a(this.$.va)).Ph}Wah(){const va=new zb.a;var rb=new we(ea.a.T9a,t.a.frame);rb.preCallback=this.Y8g;const fc=new we(ea.a.bO,t.a.frame);fc.preCallback=this.DFe;fc.postCallback=this.mZe;const Nc=new we(ea.a.PR,t.a.frame);Nc.preCallback=this.DFe;Nc.postCallback=this.mZe;const hd=new we(467845448,t.a.frame);hd.preCallback=
this.X8g;va.ia(0,rb);va.ia(1,fc);va.ia(2,Nc);va.ia(3,hd);rb=new we(ea.a.Ffb,t.a.frame);rb.preCallback=this.fJj;rb.postCallback=this.eJj;va.ia(6,rb);return va}Qef(){x.a.QYa(z.AFrameworkApplication.ji,()=>{this.excelCommentManager.hasCommentAtActiveCell&&this.excelCommentManager.WPd(this.excelCommentManager.sC.id,1);x.a.QYa(this.taskManager,()=>{this.setFocus();this.Zb.kk(Y.AFrame.Ro);this.$.workbookContext.NavigationContentFound&&(za.b().tla(pa.a.Ya.ue.m,za.a),ve.a.instance.log())})})}static createInstance(va,
rb,fc,Nc,hd,xd,ae,Wd,Ne,Ue,xe){return new Sc(va,rb,fc,Nc,hd,xd,ae,Wd,Ne,Ue,xe)}}Object(c.a)(Sc,"ExcelSharedCommentPane",ke,[478,479]);var Jd=a(135);class ye{constructor(va,rb){this.containerType="full-pane";this.identifier=null;this.commentTaskPane=va;this.identifier=rb}openView(){this.commentTaskPane.Kg(!0)}closeView(){this.commentTaskPane.Kg(!1)}invokeModalConfirmationDialog(va,rb,fc){const Nc=new Jd.StandardDialog;fc||(e.ULS.sendTraceTag(537167307,12,10,"InvokeModalConfirmationDialog: No localized strings provided."),
fc=new n.a("","","",""));Nc.Ob=1;Nc.tc(1,fc.confirmButton);Nc.tc(0,fc.cancelButton);Nc.Wl(fc.title,fc.body,1,hd=>{1===hd?va():rb()})}}Object(c.a)(ye,"ExcelViewContainerAPI",null,[476,477]);var pe=a(31),re=a(5),He=a(65),ze=a(12),ef=a(22),$a=a(21),Nb=a(34);class qc{constructor(){this.contentId=null;this.anchorTop=this.containerContentType=0;this.anchorBottom=this.anchorRight=this.anchorLeft=null}}Object(c.a)(qc,"IContentAnchorPosition",null,[]);class Lc{constructor(){this.y=this.x=this.height=this.width=
0}}Object(c.a)(Lc,"IViewportInfo",null,[]);class sd{constructor(){this.contentId=null;this.containerContentType=0}}Object(c.a)(sd,"ContainerContentDescriptor",null,[]);var Fd=a(204);class Td{constructor(va,rb,fc,Nc){this.BH=null;this.g1b=!1;this.u7d=this.Ix=this.iZ=null;this.ekb=!1;this.L9d=null;this.IUb=!1;this.Ztb=null;this.X4d=this.N9f=!1;this.k9c=0;this.yac=null;this.$Fd=this.qFc=!1;this.vj=()=>{this.elg()};this.dKf=()=>{this.L0c()};this.wj=()=>{this.elg();this.qse()};this.WCf=hd=>hd.Ea.keyCode===
Ob.a.ZF&&this.Dba?(this.ewa(this.BC,!1),this.gridView.q0(),!0):!1;this.XDf=(hd,xd)=>{this.Dba&&this.Tka&&(this.ewa(this.BC,!1),xd.Sn===Sys.UI.MouseButton.leftButton&&ze.DOMElementExtensions.X2e(xd.Mb,pe.a.Kuh,!0)&&(hd=this.VQh(xd.clientPoint),hd=this.excelCommentManager.nKa(hd),this.hBf(hd)))};this.xz=()=>{this.commentTaskPane.isVisible||!this.excelCommentManager.model.rt||this.Jhc||this.Voc()};this.sSi=hd=>{const xd=hd.contentId;switch(hd.containerChangeType){case 0:this.vSi(xd);break;case 1:this.tSi(xd);
break;case 2:Td.ksa(xd,this.HJ)?this.Aub():this.Dba&&(this.Tka=!0);break;case 3:this.uSi()}};this.yo=(hd,xd)=>{xd.na!==xd.uF&&(this.Fsh(),ze.DOMElementExtensions.setVisible(this.Ix,!1))};this.ij=(hd,xd)=>{(hd=Object(Ma.a)(Qa.a,xd.na))&&this.thc(hd.sheetId)&&this.M9f()};this.excelCommentManager=va;this.commentTaskPane=rb;this.$=fc;this.gridView=Nc;this.fec=new Sys.UI.Bounds(0,0,0,0);this.commentTaskPane.kE(this.xz)}get MZa(){return this.X4d}get Dba(){return!!this.BC}get HJ(){return this.L9d}set HJ(va){this.L9d=
va;this.Jwa=!!va}get Jhc(){return!!this.HJ}get Jwa(){return this.IUb}set Jwa(va){this.IUb=va}get Tka(){return this.ekb}set Tka(va){!this.ekb&&va?(this.ekb=!0,this.gridView.ha.wob(this.XDf)):this.ekb&&!va&&(this.ekb=!1,this.gridView.ha.aKb(this.XDf))}get BC(){return this.u7d}set BC(va){this.u7d=va;va||(this.Tka=!1)}dispose(){this.gridView&&(this.qQe(),this.gridView.Ca.Nw(this.vj));this.commentTaskPane&&this.commentTaskPane.BF(this.xz);this.$&&this.$.zF(this.wj);this.iZ&&l.KeyInputManager.instance.Ba(k.a.Sb,
this.iZ,this.WCf);this.iZ=this.Ix=this.BH=this.gridView=this.$=this.excelCommentManager=null}$nd(){this.IAi(va=>{va.continueWith(()=>{this.iZ=document.createElement("div");this.iZ.classList.add(pe.a.Jwh);ze.DOMElementExtensions.It(this.iZ,re.a.CGa);$a.h(this.$).pj.appendChild(this.iZ);this.qse();l.KeyInputManager.instance.ta(k.a.Sb,this.iZ,this.WCf);this.BH=floatingContainerManager.FloatingContainerManagerFactoryGlobal.getIsolatedFloatingContainerManagerInstanceWithCallback(this.sSi);this.dEc();this.$.dC(this.wj);
this.gridView.Ca.Tv(this.vj);this.jbh();this.BH.setFloatingContainerParentElement(this.iZ)})})}pJh(){if(this.Jwa){var va=new sd;va.containerContentType=0;va.contentId=this.HJ;this.BH.focusContainer(va)}}dEc(){var va=$a.h(this.$).pj;va=this.kse(new Sys.UI.Bounds(va.clientLeft,va.clientTop,va.clientWidth,va.clientHeight));va=Object(b.a)(new Lc,{x:va.x,y:va.y,width:Nb.a(this.$).mi(va.width),height:Nb.a(this.$).mi(va.height)});this.BH.updateViewport(va,this.gridView.rtl);this.qFc=!1}Voc(){this.excelCommentManager.ybj();
if(this.Jwa)e.ULS.sendTraceTag(537167304,12,10,"Another draft is already shown");else if(this.MZa){var va=this.excelCommentManager.model.rt;if(va){var rb=P.Gcc(va.ju.sessionType);if(void 0===rb||null===rb)e.ULS.sendTraceTag(537167302,12,10,"Invalid comment draft");else{this.M9f();this.kBc();var fc=0===rb;rb=fc?va.ju.draftId:va.jk||va.id;if(this.Dba&&Td.ksa(this.BC,rb))this.BC=null,this.HJ=rb,va=new sd,va.containerContentType=0,va.contentId=rb,this.BH.cancelDeleteContainerRequest(va),Na.EwaSettings.isChangeGateEnabled("OfficeVSO:5473527_MakeFloatingContainerStickyForNewDraft")&&
this.BH.setContainerStickyState(va,!0);else if(!this.commentTaskPane.isVisible||this.Jhc){var Nc=this.Vbc(rb,this.fgd(va));Nc||(e.ULS.sendTraceTag(537167301,12,50,"IContentAnchorPosition is null"),Nc=this.mTh(rb));this.HJ=rb;fc&&(this.Ztb=va.id);this.qFc&&this.dEc();this.$Fd?(this.BH.addAndShowContainer(Nc,!0),this.$Fd=!1):this.BH.addContainer(Nc)}}}else e.ULS.sendTraceTag(537167303,12,10,"InProgressComment is null")}else this.N9f=!0}jbh(){this.Ix=document.createElement("div");this.Ix.classList.add(pe.a.lzh);
this.iZ.appendChild(this.Ix);this.k9c=this.Ix.clientWidth;ze.DOMElementExtensions.setVisible(this.Ix,!1);var va=document.createElement("div");va.classList.add(pe.a.mzh);this.Ix.appendChild(va);va=document.createElement("div");va.classList.add(pe.a.Juh);this.Ix.appendChild(va)}xjg(){if(this.thc(He.d(this.$.na))){var va=this.excelCommentManager.model.rt;if(va){var rb=this.fgd(va);va=this.B1e(rb);rb=this.gridView.Pb(rb);if(va&&rb&&this.gridView.Eba(rb.range)){var fc=this.gridView.rtl?va.x:va.x+va.width-
this.k9c,Nc=0;rb.hasAutoFilter&&30>(rb.vH?rb.cell.Nzb:rb.height)&&(fc=this.gridView.rtl?fc+17:fc-17);Ib.a.gj(this.$)&&this.gridView.rtl&&(Nc=this.fec.width-fc);this.Ix&&Nb.a(this.$).L5f(this.Ix);this.Ix&&(Ib.a.gj(this.$)?(this.gridView.rtl?ze.DOMElementExtensions.updatePosition(this.Ix,Math.max(Nc-this.k9c,this.gridView.zr),Math.max(va.y,this.gridView.lJ),!0,!0):ze.DOMElementExtensions.updatePosition(this.Ix,Math.max(fc,this.gridView.zr),Math.max(va.y,this.gridView.lJ),!0),this.Ix.style.position=
"absolute"):Sys.UI.DomElement.setLocation(this.Ix,Math.max(fc,this.gridView.zr),Math.max(va.y,this.gridView.lJ)),ze.DOMElementExtensions.ABa(this.Ix,this.gridView.rtl,pe.a.Muh,pe.a.Luh),ze.DOMElementExtensions.setVisible(this.Ix,!0))}else ze.DOMElementExtensions.setVisible(this.Ix,!1)}}}M9f(){this.iZ&&!ze.DOMElementExtensions.isVisible(this.Ix)&&(ze.DOMElementExtensions.setVisible(this.Ix,!0),this.xjg())}hQi(va){ze.DOMElementExtensions.setVisible(this.Ix,!1);if(this.Jhc)if(this.Dba&&this.ewa(this.BC,
!1),this.Ztb){var rb=new sd;rb.containerContentType=0;rb.contentId=this.HJ;va?(this.BH.deleteContainer(rb),this.gridView.q0()):(this.BH.changeContentId(rb,this.Ztb),this.BC=this.Ztb,this.Tka=!0);this.Ztb=this.HJ=null;this.kBc()}else this.Jwa&&(this.BC=this.HJ,this.Tka=!0),this.HJ=null;else this.commentTaskPane.isVisible||e.ULS.sendTraceTag(537167300,12,15,"No draft currently shown")}hBf(va){-1===this.gridView.ha.selectionType&&(!va||va.jk?e.ULS.sendTraceTag(537167299,12,50,"Mouseenter on an comment thread"):
(W.b(this.$).rd(Pa.a.FIh,{["Location"]:"floatie"}),this.V9f(va,!0,!1)))}iQi(va){W.b(this.$).rd(Pa.a.GIh,{["Location"]:"floatie"});this.ewa(va,!0)}gQi(){this.EIj();this.L0c()}EIj(){this.thc(He.d(this.$.na))&&!this.Jwa&&this.Voc()}Szc(va,rb){!va||va.jk?e.ULS.sendTraceTag(537167298,12,15,"Attemping to show invalid comment thread"):this.MZa?this.V9f(va,!1,rb):this.yac=va.id}Aub(){this.Dba&&this.ewa(this.BC,!1)}Fsh(){this.HJ&&this.ewa(this.HJ,!1);this.BC&&this.ewa(this.BC,!1)}V9f(va,rb,fc){const Nc=va.id;
if(this.Dba){if(rb&&this.Tka||!rb&&Td.ksa(this.BC,Nc)||this.Jwa&&Td.ksa(this.HJ,Nc))return;Td.ksa(this.BC,Nc)||this.ewa(this.BC,rb)}(va=this.Vbc(Nc,va.anchor))?(this.qFc&&this.dEc(),rb?this.BH.requestAddContainerWithDelay(va):this.BH.addAndShowContainer(va,fc),rb||(this.Tka=!0)):e.ULS.sendTraceTag(537167297,12,15,"ShowFloatingCommentThread: Could not get anchor bounds")}ewa(va,rb){if(!va)e.ULS.sendTraceTag(537167296,12,15,"Attempting to hide an invalid comment");else if(!rb||!this.Tka){var fc=new sd;
fc.containerContentType=0;fc.contentId=va;rb?this.BH.requestDeleteContainerWithDelay(fc):this.BH.deleteContainer(fc)}}IAi(va){Na.EwaSettings.isChangeGateEnabled("OfficeVSO:7457857_DynamicScriptLoaderNewService")?void xc.a.resolve(Vb.d).then(rb=>va(Fd.c(rb("floatingContainerManager")))):Zd.TaskExtensions.za(ed.GetServiceTaskFactory.Oa(this.$.da,283,284,0),rb=>{va(Fd.c(rb.result.Hl.loadScript("floatingContainerManager")))},this.$.da.la,3)}L0c(){if(this.Dba){var va=this.excelCommentManager.model.nt(this.BC);
if(!va){e.ULS.sendTraceTag(537167267,12,10,"currentlyShownNonDraftThreadId is null");return}(va=this.Vbc(va.id,va.anchor))&&this.BH.updateContainer(va)}if(this.Jwa&&this.thc(He.d(this.$.na))){va=this.excelCommentManager.model.rt;if(!va){e.ULS.sendTraceTag(537167266,12,10,"InProgressComment is null");return}(va=this.Vbc(this.HJ,this.fgd(va)))&&this.BH.updateContainer(va)}this.xjg()}fgd(va){if(va.jk&&0<va.jk.length){const rb=this.excelCommentManager.model.nt(va.jk);return rb?rb.anchor:va.anchor}return va.anchor}Vbc(va,
rb){return(rb=this.B1e(rb))?this.I1e(rb,va):null}I1e(va,rb){const fc=new qc;fc.anchorLeft=Nb.a(this.$).mi(va.x);fc.anchorTop=Nb.a(this.$).mi(va.y);fc.anchorRight=Nb.a(this.$).mi(va.x+va.width);fc.anchorBottom=Nb.a(this.$).mi(va.y+va.height);fc.containerContentType=0;fc.contentId=rb;return fc}mTh(va){var rb=$a.h(this.$).pj;rb=this.kse(new Sys.UI.Bounds(this.gridView.rtl?rb.clientWidth:rb.clientLeft,rb.clientTop,0,0));return this.I1e(new Sys.UI.Bounds(rb.x,rb.y,0,0),va)}B1e(va){va=this.gridView.ov(va)||
va;va.isSingle||(va=ja.A(this.gridView.Cp.D2e(va)).topRight);va=this.gridView.Pb(va);if(!va||!va.cell.uk)return null;va=this.gridView.getCellBounds(va.cell);this.fec=ze.DOMElementExtensions.getBoundingClientRect(this.gridView.pj);return new Sys.UI.Bounds(va.x-this.fec.x,va.y-this.fec.y,va.width,va.height)}kse(va){if(!He.b(this.$.na))return va;const rb=this.gridView.rtl?va.x:va.x+this.gridView.zr,fc=va.y+this.gridView.lJ;return Na.EwaSettings.isChangeGateEnabled("OfficeVSO:5198843_FloatingCommentHeaderDimensions")?
new Sys.UI.Bounds(rb,fc,va.width-this.gridView.zr,va.height-this.gridView.lJ):new Sys.UI.Bounds(rb,fc,this.gridView.rtl?va.width-this.gridView.zr:va.width,va.height)}qse(){Nb.a(this.$).vyc(this.iZ)}elg(){this.Jhc||this.Dba?(this.dEc(),this.L0c()):this.qFc=!0}VQh(va){({t0a:va}=this.gridView.Ibc(va));return this.gridView.tb.l7a(va)?this.gridView.ov(va):va}vSi(va){Td.ksa(va,this.HJ)?this.IUb=!0:(this.BC=va,this.kBc())}tSi(va){Td.ksa(va,this.HJ)?this.IUb=!1:Td.ksa(va,this.BC)?(this.BC=null,this.kBc()):
e.ULS.sendTraceTag(537167263,12,15,"A comment has been hidden that we're not currently tracking as being shown")}uSi(){this.X4d=!0;this.N9f&&this.Voc();if(this.yac){const va=this.excelCommentManager.model.nt(this.yac);va?(this.Szc(va,!0),this.yac=null):e.ULS.sendTraceTag(537167261,12,15,"Comment not found")}}thc(va){const rb=Object(Ma.a)(a(757).ExcelCommentManager,this.excelCommentManager);return!rb||!rb.Ge.rt||""!==rb.Ge.BU&&rb.Ge.BU!==va?!1:!0}kBc(){this.Dba||this.excelCommentManager.model.rt?this.gth():
this.qQe()}gth(){this.g1b||(this.gridView.view.Ps(this.dKf),this.$.va.aJ(this.yo),this.$.va.Vf(this.ij),this.g1b=!0)}qQe(){this.g1b&&(this.gridView.view.Mq(this.dKf),this.$.va.KK(this.yo),this.$.va.sg(this.ij),this.g1b=!1)}static ksa(va,rb){return ef.a.equals(va,rb,!0)}}Object(c.a)(Td,"FloatingCommentManager",null,[2]);var ue=a(806),Ae=a(35),Le=a(46),df=a(240),Oe=a(227),cf=a(239),vf=a(288),hf=a(217),Mf=a(63);class xf extends Sys.EventArgs{constructor(va){super();this.uJh=va}}Object(c.a)(xf,"DismissFloatingNoteEventArgs",
Sys.EventArgs,[]);var sc=a(840),ad=a(112),gb=a(74),Hb=a(470);class ac extends cf.a{constructor(va,rb,fc,Nc=null,hd=!1,xd=1){super(document.createElement(hf.a.div));this.Jrd=!1;this.C9e=0;this.pxd=this.YNa=null;this.UCf=(Wd,Ne)=>{this.eOd(Ne);ze.DOMElementExtensions.Kp(this.Ol)!==this.Ol&&ze.DOMElementExtensions.setFocus(this.Ol,!0);this.raiseEvent("OnFloatingNoteResized",Ne)};this.jXi=()=>{this.raiseEvent("OnFloatingNoteMouseEnter");return!0};this.kXi=()=>{this.raiseEvent("OnFloatingNoteMouseLeave");
return!0};this.lXi=Wd=>{this.gridView.ha.Ra.SG(null);gb.g(Wd.Ea,!1);this.raiseEvent("OnFloatingNotePointerDown");return!1};this.gXi=Wd=>{this.gridView.ha.Ra.SG(null);gb.g(Wd.Ea,!1);return!1};this.hXi=Wd=>{gb.g(Wd.Ea,!1);return!1};this.PLi=Wd=>{if(Wd.Ea.keyCode===Ob.a.ZF||Wd.Ea.keyCode===Ob.a.By)return ze.DOMElementExtensions.setFocus(this.Ol,!0),!0;!Wd.Ea.shiftKey||Wd.Ea.keyCode!==Ob.a.S7&&Wd.Ea.keyCode!==Ob.a.Woa&&Wd.Ea.keyCode!==Ob.a.eCa&&Wd.Ea.keyCode!==Ob.a.R7||Wd.Ea.stopPropagation();return!1};
this.EIh=Wd=>Wd.Ea.keyCode===Ob.a.ZF?(this.gridView.focus(),!0):Wd.Ea.keyCode===Ob.a.By?(ze.DOMElementExtensions.setFocus(this.iB),!0):!1;this.mXi=Wd=>{this.Jrd&&(this.raiseEvent("OnFloatingNoteTextEdited"),this.Jrd=!1);this.DQf(Wd.rawEvent)};this.rSi=Wd=>{this.DQf(Wd.rawEvent)};this.qXi=()=>{this.raiseEvent("OnFloatingNoteTextScrolled")};this.oXi=()=>{this.Jrd=!0;this.raiseEvent("OnFloatingNoteTextInput")};this.pXi=Wd=>{Wd.stopPropagation()};this.nXi=()=>{this.setActive();this.raiseEvent("OnFloatingNoteGotFocus");
this.C9e=ad.toTimestamp(new Date).m};this.gridView=$a.h(va);this.ilb=rb.id;const ae=document.createElement(hf.a.textArea);this.lYd=this.Ae.ie(ae);this.Ol.classList.add(pe.a.ASe);ae.classList.add(pe.a.jxh);ue.a.Us(va)||(ae.readOnly=!0);this.Ol.tabIndex=0;this.Ol.appendChild(ae);this.Yg=this.gridView.Rf(xd);this.Yg.QLi.appendChild(this.Ol);this.Evb=fc.fIa(this.Ol,this.gridView,0);this.Evb.tre(this.UCf);this.jUa(rb.text.toString());this.sMb(rb.anchor);Nc&&this.f2j(Nc);this.Ol.dir=va.isChromeRtl?vf.a.rtl:
vf.a.h9a;ze.DOMElementExtensions.It(this.Ol,re.a.xve);this.Ol.setAttribute(re.a.tTg,Ba.a.instance.ga(876));hd&&ae.setAttribute(re.a.Vu,Ba.a.instance.ga(877));this.ogj();this.MKd();W.a(this.gridView.$,Wd=>{this.YNa=Wd.NP(Pa.a.lpj,!1,!0)});W.a(this.gridView.$,Wd=>{this.pxd=Wd.NP(Pa.a.IIh,!1,!0)})}get qca(){return this.ilb}H_b(va){this.addHandler("DismissFloatingNote",va)}Huc(va){this.removeHandler("DismissFloatingNote",va)}sob(va){this.addHandler("OnFloatingNoteMouseEnter",va)}Tuc(va){this.removeHandler("OnFloatingNoteMouseEnter",
va)}tob(va){this.addHandler("OnFloatingNoteMouseLeave",va)}Uuc(va){this.removeHandler("OnFloatingNoteMouseLeave",va)}DXc(va){this.addHandler("OnFloatingNotePointerDown",va)}hMd(va){this.removeHandler("OnFloatingNotePointerDown",va)}jOg(va){this.addHandler("OnFloatingNoteTextInput",va)}$kj(va){this.removeHandler("OnFloatingNoteTextInput",va)}kOg(va){this.addHandler("OnFloatingNoteTextScrolled",va)}alj(va){this.removeHandler("OnFloatingNoteTextScrolled",va)}fOg(va){this.addHandler("OnFloatingNoteResized",
va)}Wkj(va){this.removeHandler("OnFloatingNoteResized",va)}V_b(va){this.addHandler("OnFloatingNoteTextEdited",va)}Vuc(va){this.removeHandler("OnFloatingNoteTextEdited",va)}ZNg(va){this.addHandler("OnFloatingNoteGotFocus",va)}Tkj(va){this.removeHandler("OnFloatingNoteGotFocus",va)}get BOa(){return this.iB.value}get Qxf(){return this.iB.scrollTop}get R6a(){return!!this.iB&&ze.DOMElementExtensions.Kp(this.Ol)===this.iB}get paneType(){return this.Yg.paneType}get dimensions(){return new Sys.UI.Bounds(0,
0,this.Ol.clientWidth,this.Ol.clientHeight)}get Ol(){return this.domElement}get iB(){return this.Ol?this.Ol.firstChild:null}dispose(){this.Evb&&(this.Evb.Vkj(this.UCf),this.Evb.dispose(),this.Evb=null);this.Ol&&(this.iB&&(Le.a.Wma(this.iB),this.lYd.DC(),yb.a.pc([this.lYd]),this.Ol.removeChild(this.iB)),Le.a.Wma(this.Ol),this.Cc.DC(),ze.DOMElementExtensions.vf(this.Ol));this.gridView=this.ilb=null;super.dispose()}focus(){if(this.iB){if(this.iB.value){const va=this.iB.value.length;Hb.a(this.iB,va,va)}ze.DOMElementExtensions.setFocus(this.iB,
!1)}}sMb(va){this.gridView.W0(va)?(va=this.gridView.ov(va)||va,va=this.gridView.xg(va,this.Yg.paneType,void 0,void 0,!1)||Mf.a.z3,ze.DOMElementExtensions.updatePosition(this.Ol,va.bottomRight.x,va.topLeft.y,!0,this.gridView.rtl)):this.pxd&&this.pxd(()=>({["PaneType"]:this.Yg.paneType.toString(),["Location"]:"floatie"}))}jUa(va){this.BOa!==va&&(this.iB.value=va)}I0d(va){this.Qxf!==va&&(this.iB.scrollTop=va)}f2j(va){va=new sc.a(va.width,va.height,!1,!1);this.eOd(va)}eOd(va){if(va.height!==this.Ol.clientHeight||
va.width!==this.Ol.clientWidth)va.height=Math.max(va.height,30),va.width=Math.max(va.width,30),this.gridView.rtl&&Sys.UI.DomElement.setLocation(this.Ol,this.Ol.offsetLeft-(va.width-this.Ol.clientWidth),this.Ol.offsetTop),ze.DOMElementExtensions.yI(this.Ol,va.height),ze.DOMElementExtensions.Jv(this.Ol,va.width),this.YNa&&this.YNa(()=>({["IsRTL"]:this.gridView.rtl,["Location"]:"floatie"}))}setActive(){this.Ol.classList.add(pe.a.Aad)}q5f(){this.Ol.classList.remove(pe.a.Aad)}ogj(){df.a.instance.ta(k.a.XV,
this.Ol,this.jXi);df.a.instance.ta(k.a.qB,this.Ol,this.kXi);df.a.instance.ta(k.a.pointerDown,this.Ol,this.lXi);Oe.a.instance.ta(k.a.click,this.domElement,this.gXi);Oe.a.instance.ta(k.a.tk,this.domElement,this.hXi);this.Cc.ka("contextmenu",va=>{gb.g(va,!1)});this.lYd.ka("blur",this.mXi);this.Cc.ka("blur",this.rSi);Le.a.addHandler(this.iB,k.a.scroll,this.qXi);Le.a.addHandler(this.iB,k.a.focus,this.nXi)}MKd(){l.KeyInputManager.instance.ta(k.a.Sb,this.iB,this.PLi);l.KeyInputManager.instance.ta(k.a.Sb,
this.Ol,this.EIh);Le.a.addHandler(this.iB,k.a.input,this.oXi);Le.a.addHandler(this.iB,k.a.bQd,this.pXi)}DQf(va){this.Ol.contains(va.relatedTarget)||(50>ad.toTimestamp(new Date).m-this.C9e&&W.b(this.gridView.$).rd(Pa.a.HIh,{["Location"]:"floatie",["callstack"]:Error().stack},void 0,!0),this.q5f(),this.raiseEvent("DismissFloatingNote",new xf(va.relatedTarget)))}}Object(c.a)(ac,"FloatingNoteControl",cf.a,[503,2]);class Ec{constructor(){this.$ic=!1;this.dimensions=Ec.W7c}static Yni(va){return va.height===
Ec.W7c.height&&va.width===Ec.W7c.width}}Ec.W7c=new Sys.UI.Bounds(0,0,210,150);Object(c.a)(Ec,"FloatingNoteState",null,[]);var pd=a(114);class Bd extends cf.a{constructor(va,rb,fc,Nc=null,hd=!1){super(document.createElement(hf.a.div));this.PAf=xd=>{this.jUa(xd.BOa)};this.QAf=xd=>{this.I0d(xd.Qxf)};this.IAf=(xd,ae)=>{pd.b(this.cq.values,Wd=>Wd.domElement.contains(ae.uJh))||(Ae.a.forEach(this.cq.tu,Wd=>{Wd.value.q5f()}),this.raiseEvent("DismissFloatingNote"))};this.KAf=()=>{this.raiseEvent("OnFloatingNoteMouseEnter")};
this.LAf=()=>{this.raiseEvent("OnFloatingNoteMouseLeave")};this.MAf=()=>{this.raiseEvent("OnFloatingNotePointerDown")};this.NAf=(xd,ae)=>{const Wd=xd.paneType;Ae.a.forEach(this.cq.tu,Ne=>{Ne=Object(Ma.a)(ac,Ne.value);Ne.paneType!==Wd&&Ne.eOd(ae)})};this.OAf=()=>{this.raiseEvent("OnFloatingNoteTextEdited")};this.JAf=()=>{Ae.a.forEach(this.cq.tu,xd=>{xd.value.setActive()})};this.EGg=new Ae.a(!1);this.behaviorsFactory=fc;for(fc=1;4>=fc;fc++)this.Xgi(va,rb,Nc,hd,fc);this.ilb=rb.id}get cq(){return this.EGg}get qca(){return this.ilb}get BOa(){return this.cq.Xf(0).BOa}get R6a(){return pd.b(this.cq.values,
va=>va.R6a)}get dimensions(){return this.cq.Xf(0).dimensions}H_b(va){this.addHandler("DismissFloatingNote",va)}Huc(va){this.removeHandler("DismissFloatingNote",va)}sob(va){this.addHandler("OnFloatingNoteMouseEnter",va)}Tuc(va){this.removeHandler("OnFloatingNoteMouseEnter",va)}tob(va){this.addHandler("OnFloatingNoteMouseLeave",va)}Uuc(va){this.removeHandler("OnFloatingNoteMouseLeave",va)}DXc(va){this.addHandler("OnFloatingNotePointerDown",va)}hMd(va){this.removeHandler("OnFloatingNotePointerDown",
va)}V_b(va){this.addHandler("OnFloatingNoteTextEdited",va)}Vuc(va){this.removeHandler("OnFloatingNoteTextEdited",va)}dispose(){Ae.a.forEach(this.cq.tu,va=>{va=va.value;va.$kj(this.PAf);va.alj(this.QAf);va.Huc(this.IAf);va.Tuc(this.KAf);va.Uuc(this.LAf);va.hMd(this.MAf);va.Wkj(this.NAf);va.Vuc(this.OAf);va.Tkj(this.JAf);va.dispose()});this.ilb=null;super.dispose()}focus(){this.cq.Xf(0).focus()}sMb(va){Ae.a.forEach(this.cq.tu,rb=>{rb.value.sMb(va)})}jUa(va){Ae.a.forEach(this.cq.tu,rb=>{rb.value.jUa(va)})}I0d(va){Ae.a.forEach(this.cq.tu,
rb=>{rb.value.I0d(va)})}Xgi(va,rb,fc,Nc,hd){va=new ac(va,rb,this.behaviorsFactory,fc,Nc,hd);this.cq.add(hd.toString(),va);va.jOg(this.PAf);va.kOg(this.QAf);va.H_b(this.IAf);va.sob(this.KAf);va.tob(this.LAf);va.DXc(this.MAf);va.fOg(this.NAf);va.V_b(this.OAf);va.ZNg(this.JAf)}}Object(c.a)(Bd,"MultiPanesFloatingNoteControl",cf.a,[503,2]);var de=a(48),Jb=a(44);class tc{constructor(va,rb,fc){this.RHb=this.oca=this.ske=this.cdf=this.iPb=this.Tla=this.$9a=null;this.mV=this.fEa=!1;this.zac=new Ae.a(!1);this.Twd=
this.Vwd=null;this.Btb=()=>{this.Eu&&(this.SEe(this.Eu),this.Eu.Huc(this.bJf),this.Eu.Vuc(this.mpc),this.tJe(this.Eu.qca,this.Eu.dimensions),this.Eu.dispose(),this.Eu=null)};this.M9c=Nc=>{const hd=this.gridView.$.na.sheetName!==Nc.SheetName,xd=ja.D(Nc);this.gridView.qg(Nc,xd,xd,null,0,"NoteManager.EditNoteAtRange",void 0,void 0,void 0,void 0,!0);hd||this.mV||!this.WE||!this.tBb(this.nN)?(W.b(this.gridView.$).rd(Pa.a.zHh,this.sm(),void 0,!1),this.RHb=Nc,this.Vwd&&yb.a.Ja(this.Vwd),this.Vwd=de.a.instance.create(()=>
{this.RHb&&W.b(this.gridView.$).rd(Pa.a.AHh,{["isDifferentSheet"]:hd,["isRecreatingInstancesRequired"]:this.mV,["HasNoteAtActiveCell"]:this.WE,["IsNoteInLoadedRange"]:this.tBb(this.nN),["Location"]:"floatie"},void 0,!0)},1500,Jb.a.NLi,!0,!0)):(this.V8b(),this.RHb=null)};this.hfc=()=>{this.gBb&&this.s8c()};this.kEf=()=>{this.a3b()};this.lEf=()=>{this.Tla&&this.Tla.Yp()};this.mEf=()=>{this.XUj()};this.jEf=()=>{this.hfc()};this.bJf=()=>{this.Btb()};this.mpc=Nc=>{this.SEe(Nc)};this.wya=(Nc,hd)=>{hd.na!==
hd.uF&&this.cfc()};this.mDf=()=>{this.mV=!0};this.tzf=()=>{this.mV=!0};this.uzf=()=>{this.mV=!0};this.uc=()=>{this.mV=!0};this.Gq=()=>{let Nc=null;this.mV&&(this.mV=!1,this.Eu&&this.Eu.R6a&&(Nc=this.Aw.Lhd(this.Eu.qca),W.b(this.gridView.$).rd(Pa.a.Nlh,this.sm(),void 0,!0)),this.cfc());this.lKd();e.ULS.shipAssertTag(537167244,12,!this.mV);this.Aw.xld&&W.b(this.gridView.$).rd(Pa.a.iXi,this.sm());Nc&&this.fHd(Nc)};this.wj=()=>{this.lKd()};this.excelCommentManager=va;this.gridView=$a.h(va.$);this.ha=
this.gridView.ha;this.Aw=rb;this.behaviorsFactory=fc;this.gridView.$.va.aJ(this.wya);this.gridView.$.va.Wra(this.mDf);this.gridView.$.va.Aqe(this.tzf);this.gridView.$.va.vXc(this.uzf);this.gridView.$.nj(this.uc);this.gridView.oT(this.Gq);this.gridView.$.dC(this.wj);this.Oge=new Ae.a(!1);W.a(this.gridView.$,Nc=>{this.Twd=Nc.NP(Pa.a.TJi,!1,!1)})}get bWc(){const va=this.gridView.ov(this.ha.qa.activeCell);return va?va.topLeft:this.ha.qa.activeCell}get WE(){return!!this.nN}get nN(){return this.Aw.Ycc(this.bWc)}get yld(){const {ExcelCommentManager:va}=
a(757);return va.kve(this.Aw.notes.values,this.ha.qa.selectedRanges)}get voi(){return!!this.Eu&&this.Eu.R6a||Z.a.any(this.TV.values,va=>va.R6a)}get Cui(){return this.fEa}get gBb(){return!!this.XC}get TV(){return this.Oge}get Eu(){return this.ske}set Eu(va){this.pAe();this.ske=va}get XC(){return this.cdf}set XC(va){this.cdf=va}dispose(){this.gridView&&(this.gridView.QN(this.Gq),this.gridView.$&&(this.gridView.$.ol(this.uc),this.gridView.$.va.KK(this.wya),this.gridView.$.va.Tza(this.mDf),this.gridView.$.va.$Ld(this.uzf),
this.gridView.$.va.jWf(this.tzf),this.gridView.$.zF(this.wj)));this.iPb=this.Aw=this.ha=this.gridView=null;this.$9a&&(this.$9a.dispose(),this.$9a=null);this.Tla&&(this.Tla.dispose(),this.Tla=null);this.cfc();this.Oge=null}tBb(va){return!!va&&!!this.gridView.W0(va.anchor)}Mic(va){if(!va)return!0;va=va.anchor;va=this.gridView.ov(va)||va;return this.gridView.Cp.Wh(va)}S_h(va){return this.TV.getItem(va)}Egd(va){return this.zac.getItem(va)}tJe(va,rb,fc=!1){if(fc===this.fEa&&Ec.Yni(rb))this.zac.remove(va);
else{var Nc=this.Egd(va);Nc||(Nc=new Ec,this.zac.add(va,Nc));Nc.dimensions=rb;Nc.$ic=fc}}Pig(va){this.zac.forEach(rb=>{rb.value.$ic=va})}Cig(){this.XC.Tuc(this.kEf);this.XC.Uuc(this.lEf);this.XC.hMd(this.mEf);this.XC.Huc(this.jEf)}s8c(){this.XC&&(this.Cig(),this.XC.dispose(),this.XC=null)}t8c(va,rb=!1){let fc=this.TV.getItem(va);fc&&(this.Aw.hkg(fc.qca,fc.BOa),fc.Vuc(this.mpc),this.tJe(fc.qca,fc.dimensions,!rb),fc.dispose(),this.TV.remove(va),this.gridView.focus())}cfc(va=!1){this.s8c();this.Btb();
this.TV.forEach(rb=>{this.t8c(tc.n5e(rb),va)})}Pej(){this.TV.forEach(va=>{this.nKd(tc.vVh(va),()=>{this.t8c(tc.n5e(va))})})}lKd(){this.oca?this.Eu.sMb(this.oca.anchor):this.nKd(this.Eu,this.Btb);this.Pej();this.nKd(this.XC,this.hfc);this.zRf();this.RHb&&this.M9c(this.RHb)}iMi(){this.lKd()}l6c(){this.gridView.Cp.Wh(this.ha.qa.activeCell)||(this.oca=ue.a.dfh(this.bWc,this.excelCommentManager),this.fHd(this.oca),W.b(this.gridView.$).rd(Pa.a.l6c,this.sm(),void 0,!1))}V8b(){this.tBb(this.nN)?this.Mic(this.nN)||
(this.TV.hb(this.nN.id)?this.S_h(this.nN.id).focus():this.fHd(this.nN),W.b(this.gridView.$).rd(Pa.a.V8b,this.sm(),void 0,!1)):this.M9c(ja.v(this.nN.anchor,this.gridView.$))}p8c(){this.Aw.p8c(this.ha.qa)}BHh(va){this.Btb();this.Aw.CHh(va,this.bWc,this.M9c);W.b(this.gridView.$).rd(Pa.a.findNextOrPreviousNote,this.sm(),void 0,!1)}QJj(){const {ExcelCommentManager:va}=a(757);if(!this.WE)e.ULS.sendTraceTag(592541398,12,10,"Show/Hide Note button is expected to be disabled when no note at active cell");else if(!this.Mic(this.nN)){this.pAe();
this.Btb();var rb=this.nN;this.TV.hb(rb.id)?(this.t8c(rb.id,!0),W.b(this.gridView.$).rd(Pa.a.Mci,this.sm(),void 0,!1)):(this.XNf(this.nN),W.b(this.gridView.$).rd(Pa.a.Wai,this.sm(),void 0,!1));this.gridView.focus();va.L1f(this.TV.hb(rb.id)?880:881,this.gridView.$)}}showOrHideAllNotes(){const {ExcelCommentManager:va}=a(757);(this.fEa=!this.fEa)?(this.Pig(!0),this.zRf(),W.b(this.gridView.$).rd(Pa.a.ZHj,this.sm(),void 0,!1)):(this.cfc(!0),this.Pig(!1),W.b(this.gridView.$).rd(Pa.a.YHj,this.sm(),void 0,
!1));this.gridView.$.qf();this.gridView.focus();va.L1f(this.fEa?878:879,this.gridView.$)}I$g(){this.WE?(new Ra(this.gridView.$,this.excelCommentManager,this.nN.id,null),W.b(this.gridView.$).rd(Pa.a.convertNote,this.sm(),void 0,!0)):e.ULS.sendTraceTag(574739536,12,10,"Convert Note button is expected to be disabled when no note at active cell")}fXi(va,rb){(rb=this.Aw.Ycc(rb))?this.TV.hb(rb.id)||this.Eu||(va?this.SDd(rb):this.Zpc()):e.ULS.sendTraceTag(592541397,12,50,"ECM.OnNoteCellHoverChange: Mouse hover triggered for null comment at cell with notch. Comments might not have been loaded yet.")}SDd(va){if(this.gBb){if(va.id===
this.XC.qca){this.a3b();return}this.iPb=va.id}W.b(this.gridView.$).rd(Pa.a.SDd,this.sm());this.$9a=de.a.instance.create(()=>{this.QUd(va);this.iPb=null},200,Jb.a.OLi,!0,!1)}Zpc(){this.iPb?this.gBb&&this.iPb===this.XC.qca?this.h1c():(W.b(this.gridView.$).rd(Pa.a.Zpc,this.sm()),this.Tla=de.a.instance.create(()=>{this.hfc()},250,Jb.a.Pxf,!0,!1)):this.gBb?(W.b(this.gridView.$).rd(Pa.a.Zpc,this.sm()),this.Tla=de.a.instance.create(()=>{this.hfc()},250,Jb.a.Pxf,!0,!1)):this.h1c()}QUd(va){this.gBb&&(this.s8c(),
this.a3b());this.p8i(va);W.b(this.gridView.$).rd(Pa.a.QUd,this.sm(),void 0,!1)}pAe(){this.a3b();this.h1c()}a3b(){this.Tla&&this.Tla.cancel()}h1c(){this.$9a&&this.$9a.cancel()}XUj(){this.Cig();this.Eu=this.XC;this.XC=null;this.Kcg();W.b(this.gridView.$).rd(Pa.a.uMj,this.sm(),void 0,!1)}Kcg(){this.Eu.H_b(this.bJf);this.Eu.V_b(this.mpc)}p8i(va){this.XC=this.N5c(va);this.XC.sob(this.kEf);this.XC.tob(this.lEf);this.XC.DXc(this.mEf);this.XC.H_b(this.jEf)}fHd(va){e.ULS.shipAssertTag(537167248,12,!this.Eu,
"Should not have two soft pinned floaties on the grid.");this.Eu=this.N5c(va);this.Kcg();this.Eu.focus()}XNf(va){const rb=this.N5c(va);rb.V_b(this.mpc);this.TV.add(va.id,rb)}N5c(va){e.ULS.shipAssertTag(537167246,12,!this.TV.hb(va.id)&&(!this.Eu||this.Eu.qca!==va.id),"Should not have more than one floating note with the same ID.");var rb=this.Egd(va.id);rb=rb?rb.dimensions:null;return this.gridView.ib.fj?(this.Twd&&this.Twd(()=>this.sm()),new Bd(this.gridView.$,va,this.behaviorsFactory,rb,!!this.oca)):
new ac(this.gridView.$,va,this.behaviorsFactory,rb,!!this.oca)}nKd(va,rb){if(va){var fc=this.Aw.Lhd(va.qca);fc&&this.tBb(fc)&&!this.Mic(fc)?(va.sMb(fc.anchor),va.R6a||va.jUa(fc.text.toString())):rb()}}SEe(va){this.oca?(this.oca.text=[va.BOa],this.Aw.Zeh(this.oca),this.oca=null):this.Aw.hkg(va.qca,va.BOa)}zRf(){var va=this.Aw.notes.values;for(const rb of va)va=this.Egd(rb.id),!this.TV.hb(rb.id)&&(this.fEa?!va||va.$ic:va&&va.$ic)&&this.tBb(rb)&&!this.Mic(rb)&&this.XNf(rb)}sm(){return{["Location"]:"floatie"}}static n5e(va){return va.key}static vVh(va){return va.value}}
Object(c.a)(tc,"NoteManager",null,[475,2]);var fd=a(81),Ad=a(113);class me extends fd.a{constructor(va,rb){super();this.notes=new Ae.a(!1);this.kOi=(fc,Nc,hd)=>{ub.a(fc)?(this.Ozf(null,Nc,hd),this.$.ea.Tn(fc.Errors)):(e.ULS.shipAssertTag(537167241,12,0<=fc.Result,"Invalid note id (insert order) provided by server when inserting new note into note model."),W.b(this.$).rd(Pa.a.pih,this.sm(),void 0,!1),this.$.qf(),$a.h(this.$).focus())};this.Ozf=(fc,Nc)=>{e.ULS.sendTraceTag(579089047,12,10,`Failed to create a note. ${Nc}`)};
this.bRi=fc=>{e.ULS.sendTraceTag(537167238,12,10,"Failed to delete one or more notes in the selected ranges.");fc&&this.$.ea.Tn(Ad.a.Pe(fc.data))};this.PCf=()=>{e.ULS.sendTraceTag(574365953,12,10,"Failed to find next/previous note.")};this.$=va;this.MVe=rb}get xld(){return!!this.notes&&0<this.notes.count}dispose(){this.notes=null;super.dispose()}Lhd(va){return this.xld&&va?this.notes.getItem(va):null}Ycc(va){return this.xld&&(va=this.o5e(va),0<=va)?this.notes.Xf(va):null}zea(va){this.notes.clear();
for(const rb of va)this.notes.hb(rb.id)?e.ULS.sendTraceTag(537167243,12,15,"Note id already exists!"):this.notes.add(rb.id,rb);this.notes.bWd((rb,fc)=>{const {ExcelCommentManager:Nc}=a(757);return Nc.Urb(rb.anchor,fc.anchor)})}hkg(va,rb){va=this.Lhd(va);va?rb!==va.text.toString()&&(va.text=[rb],this.MVe.aJb([va],4),W.b(this.$).rd(Pa.a.I7g,this.sm(),void 0,!1)):e.ULS.sendTraceTag(588890946,12,15,"UpdateNoteText: the note we're tring to edit doesn't exist.")}Zeh(va){this.DSg(va)}DSg(va){if(va){var rb=
new Ka.a(182,0,(fc,Nc,hd)=>ua(this.$.oa.xa,1,va.text[0],ja.q(va.anchor,this.$),-1,Kb.b(fc,this.kOi),Kb.a(Nc,this.Ozf),hd,va.id),1);this.$.userOperationManager.Jc(rb,null)}}p8c(va){if(va.h5){var rb=this.Ycc(va.selectedRanges[0]);rb?(this.MVe.aJb([rb],3),W.b(this.$).rd(Pa.a.nlh,this.sm(),void 0,!1)):e.ULS.sendTraceTag(537167240,12,15,"DeleteNotesInSelectedRanges: the note we're tring to delete doesn't exist.")}else{var fc=Nc=>{Nc&&ub.a(Nc)&&(e.ULS.sendTraceTag(537167239,12,50,"Delete notes succeeded but received warning message."),
this.$.ea.Tn(Nc.Errors));W.b(this.$).rd(Pa.a.jlh,this.sm(),void 0,!1)};rb=new Ka.a(182,0,(Nc,hd,xd)=>ua(this.$.oa.xa,3,null,ja.r(va.selectedRanges,this.$),-1,Kb.b(Nc,fc),Kb.a(hd,this.bRi),xd,null),65);this.$.userOperationManager.Jc(rb,null)}}CHh(va,rb,fc){var Nc=Sa.Ihd(rb,va,this.notes.values).returnValue;if(Nc)for(rb=null,Nc=this.o5e(Nc.anchor);va?Nc<this.notes.count:0<=Nc;Nc+=va?1:-1)if(rb=this.notes.Xf(Nc).anchor,rb=$a.h(this.$).ov(rb)||rb,!$a.h(this.$).Cp.Wh(rb)){fc(ja.v(rb,this.$));return}this.findNextOrPreviousNoteCrossSheet(va,
rb,fc)}findNextOrPreviousNoteCrossSheet(va,rb,fc){const Nc=(xd,ae,Wd)=>{xd&&xd.Result&&!ub.a(xd)?(xd=xd.Result,xd.SheetName===this.$.activeItemName&&rb.equals(ja.D(xd))&&!this.Ycc(rb)?$a.h(this.$).focus():fc(xd)):this.PCf(null,ae,Wd)},hd=new Ka.a(590,0,(xd,ae,Wd)=>Ca(this.$.oa.xa,ja.o(rb,this.$),va,Kb.b(xd,Nc),Kb.a(ae,this.PCf),Wd,null),80);this.$.userOperationManager.Jc(hd,null)}o5e(va){const rb=new wb.a(this.notes.values);return na.HelperMethods.Xu(rb,0,this.notes.count,va,(fc,Nc)=>{const {ExcelCommentManager:hd}=
a(757);return hd.Urb(fc.anchor,Nc)})}sm(){return{["Location"]:"floatie"}}}Object(c.a)(me,"NoteModel",fd.a,[474,2]);var Vd=a(24),oe=a(376),Me=a(29),cb=a(73);class Mb{constructor(){this.draftId=null;this.insertIndex=0;this.anchorHintText=null}}Object(c.a)(Mb,"CurrentContextDraft",null,[]);var kc=a(39),Uc=a(100);a.d(F,"ExcelCommentManager",function(){return qd});class qd extends f.a{constructor(va,rb,fc,Nc,hd,xd,ae,Wd,Ne,Ue){super(fc);this.RZb=[Ta.a.idle,Ta.a.tRa,Ta.a.Kda];this.Pa=new Da.a;this.E6b=
0;this.EUd=this.ZPd=this.p7d=this.o7d=this.Ptd=!1;this.wua=this.Rx=this.wKc=this.DGc=this.eYd=this.lFc=this.CY=null;this.nZa=0;this.voa=null;this.j5b=d.a.nil;this.GMf=this.FMf=null;this.NHb=0;this.Irc=null;this.Fta=!1;this.Aw=this.tYd=null;this.correlationId=0;this.sGf=xe=>{let Ze=!1;h.a.Hg&&window.focus();113===xe.Ea.keyCode&&xe.Ea.shiftKey&&(xe=new Ja.a(-1667294294,1,this.jb.xc,6,null),Ze=this.Fcg(1,xe));return Ze};this.Gh=()=>{this.$bg();this.ijg()};this.ij=(xe,Ze)=>{this.activeSheet!==Ze.na&&
(this.activeSheet=Ze.na)&&(this.Jvc(),this.$qf(),this.N0a(),this.jjg(!0))};this.mD=(xe,Ze)=>{xe=Ze.item;!xe||""!==this.Ge.BU&&He.d(xe)!==this.Ge.BU||this.Gdd()};this.tN=xe=>{switch(xe.nu){case 1:this.Irc||this.Jvc()}};this.z_=()=>{this.Jvc()};this.Ao=()=>{this.PK();this.Jvc()};this.gTi=(xe,Ze)=>{if(this.Tca&&Ze===this.correlationId){this.Tca=null;if(Me.a.Wf(xe.Errors))this.Ptd&&Me.a.S9(xe.Errors)&&this.jb.ea.Ldd();else if(xe=xe.Result,this.Ftd()){if(xe&&xe.ObjectMetadataArray){if(null===this.voa||
0===xe.StartIndex?this.voa=xe:this.voa.ObjectMetadataArray=this.voa.ObjectMetadataArray.concat(xe.ObjectMetadataArray),0<xe.AdditionalStartIndex){this.nZa=xe.AdditionalStartIndex;this.b$();return}}else this.voa=null;if(this.voa||this.version===qd.WA)this.activeSheet.mJ=this.voa,this.ngb(!1)}else if(xe||this.version===qd.WA)this.activeSheet.mJ=xe,this.ngb(!1);this.Ptd=!1;this.j5b!==d.a.nil?(32!==this.cxf(this.j5b)&&e.ULS.sendTraceTag(537167382,12,15,"ExcelCommentManager.OnGetCommentsComplete: Deferred comment selection failed - comment may not exist."),
this.j5b=d.a.nil):this.EUd&&(this.DUd(),this.EUd=!1)}};this.hTi=xe=>{this.Tca=null;10===xe.data.status?this.b$():8!==xe.data.status&&14!==xe.data.status&&404!==xe.data.httpStatus&&502!==xe.data.httpStatus&&503!==xe.data.httpStatus&&e.ULS.sendTraceTag(594886745,12,10,this.Ftd()?`Comment information couldn't be retrieved. RequestStatus is ${xe.data.status}. Http Status is ${xe.data.httpStatus}. AdditionalCommentStartIndex is ${this.nZa}.`:`Comment information couldn't be retrieved. RequestStatus is ${xe.data.status}. Http Status is ${xe.data.httpStatus}.`)};
this.xz=()=>{this.Ptd=this.commentTaskPane.fxa;this.Jcg(this.commentTaskPane.fxa)};this.dd=()=>{this.activeSheet&&this.activeSheet.mJ&&(this.activeSheet.mJ.Version=qd.WA);this.mode=this.jb.isEditMode?1:0;this.commentTaskPane.Kg(this.commentTaskPane.fxa)};this.c1i=(xe,Ze,tf)=>{ub.a(xe)?(this.TJf(null,Ze,tf),this.ea.Tn(xe.Errors)):(this.ngb(!0),this.Fsf(!0))};this.TJf=()=>{this.ngb(!0);this.Fsf(!1)};this.lSi=(xe,Ze,tf)=>{xe&&xe.Result&&!ub.a(xe)?(this.Irc=null,tf=Ze.gridView,e.ULS.shipAssertTag(537167381,
12,Object(m.a)(220,tf),"ExcelCommentManager.OnFindNextOrPreviousCommentCrossSheetWebMethodSuccess: the userContext is null or not an IGridView."),this.Nrf(!0),xe=xe.Result,this.aGj(xe)&&(xe=this.u7e(),this.Rx.$Fd=!0),this.dxf(xe,tf,Ze.c9c),this.NHb=0):this.OCf(null,Ze,tf)};this.OCf=()=>{this.Irc=null;this.NHb=0;this.Nrf(!1)};this.L0a=(xe,Ze,tf,Of,bg)=>{if(!bg)return e.ULS.sendTraceTag(537167376,12,10,"actionData is null"),8;xe=bg.NavigationId;Ze=this.xZh(xe);if(isNaN(Ze))return e.ULS.sendTraceTag(537167375,
12,10,"Unable to extract nav type from navigation id"),8;11<Ze&&e.ULS.sendTraceTag(537167374,12,15,`Unexpected navigation type, type=${Ze}`);Ze=this.y7e(xe);if(Ze.equals(d.a.nil))return e.ULS.sendTraceTag(537167373,12,10,"Unable to extract sheet id from navigation id"),8;if(!this.sQj(Ze))return e.ULS.sendTraceTag(537167372,12,15,"Destination sheet no longer exists"),8;xe=this.J1e(xe);return xe.equals(d.a.nil)?(e.ULS.sendTraceTag(537167371,12,10,"Unable to extract content id from navigation id"),8):
this.activeSheet.mJ?this.cxf(xe):(this.j5b=xe,32)};this.TIa=(xe,Ze,tf,Of,bg)=>{if(!bg)return e.ULS.sendTraceTag(537167370,12,10,"DoesCommentExist: actionData is null"),8;xe=bg.NavigationId;if(!xe)return e.ULS.sendTraceTag(537167369,12,10,"DoesCommentExist: navigation ID is null"),8;Ze=this.y7e(xe);if(Ze.equals(d.a.nil))return e.ULS.sendTraceTag(537167368,12,10,"DoesCommentExist: Failed to parse sheet ID from navigation ID"),8;Ze=this.x7e(Ze);if(!Ze)return e.ULS.sendTraceTag(537167367,12,50,"DoesCommentExist: Sheet not found from Sheet ID; Sheet has been deleted"),
8;xe=this.J1e(xe);if(xe.equals(d.a.nil))return e.ULS.sendTraceTag(537167366,12,10,"DoesCommentExist: Failed to parse content ID from navigation ID"),8;if(Ze.mJ){for(const pf of Ze.mJ.ObjectMetadataArray)if(xe.equals(d.a.N$(pf.CommentId)))return 32;e.ULS.sendTraceTag(537167365,12,50,"DoesCommentExist: Comment has been deleted");return 8}return 32};this.jb=Nc;this.gridView=hd;this.ha=xd;this.commentTaskPane=ae;this.ea=Wd;this.yq=Ne;this.M0a=va;this.fJi=new Pd;this.jyi='"ops" : [';this.lch(Ue);this.Qzb(rb);
this.mode=Nc.isEditMode?1:0;0===this.mode&&this.M0a.classList.add("Interactive");this.M0a&&l.KeyInputManager.instance.ta(k.a.Sb,this.M0a,this.sGf);this.ha.yG(this.Gh);this.Tca=null;this.activeSheet=Nc.va.na;for(let xe=0,Ze=this.RZb.length;cb.a(this.jb)&&xe<Ze;++xe)cb.a(this.jb).kQ(this.RZb[xe]).pq(this.tN);this.jb.va.Vf(this.ij);this.jb.va.fY(this.mD);this.ea.oA(this.z_);Na.EwaSettings.isChangeGateEnabled("OfficeVSO:3298264_LoadOnDemandShouldResetCommentVersion")&&this.ea.TL(this.Ao);this.jb.Lk(this.dd);
this.commentTaskPane.kE(this.xz);this.rhf()&&(this.nZa=0,this.b$());this.Ma.Nb(ea.a.L0a,t.a.frame,this.L0a);this.Ma.Nb(ea.a.TIa,t.a.frame,this.TIa);this.Ma.Nb(ea.a.a$a,t.a.frame,()=>{this.a$a();return 32})}get mode(){return this.E6b}set mode(va){this.E6b=va;this.jb.qf()}get VI(){return this.DGc}get sbd(){return this.wKc}get Ge(){return this.FMf}get X2(){return this.GMf}get $(){return this.jb}get Rm(){return this.wua}get hasCommentAtActiveCell(){return!!this.sC}get Dih(){return this.o7d}get Eih(){return this.p7d}get sC(){return this.Ge.nKa(this.ha.qa.activeCell)}get version(){return this.activeSheet.mJ?
this.activeSheet.mJ.Version:qd.WA}get $cg(){return 1===this.mode}get Ona(){return!0}get Agc(){return 2===this.mode||3===this.mode}get p1a(){return this.Ge.p1a}get tnh(){return new n.a(Ba.a.instance.Ta(441),CommentPaneStrings.DiscardDialogBody,CommentPaneStrings.DiscardDialogAbandon,CommentPaneStrings.DiscardDialogResume)}get GAb(){let va=Na.EwaSettings.ra(144)&&!this.jb.uBb();Na.EwaSettings.isChangeGateEnabled("OfficeVSO:3999480_ShouldCheckTasksHostIsEnabled")&&(va=va&&z.AFrameworkApplication.fa.pa("TasksHostIsEnabled"));
return va}get D9f(){return!1}UNg(va){this.Pa.addHandler(qd.GCd,va)}Rkj(va){this.Pa.removeHandler(qd.GCd,va)}ybj(){this.Pa.raiseEvent(qd.GCd)}dispose(){this.M0a&&l.KeyInputManager.instance.Ba(k.a.Sb,this.M0a,this.sGf);this.ha&&this.ha.JK(this.Gh);this.jb&&(this.jb.va.sg(this.ij),this.jb.va.N6(this.mD),this.ea.uB(this.z_),this.jb.pl(this.dd),Na.EwaSettings.isChangeGateEnabled("OfficeVSO:3298264_LoadOnDemandShouldResetCommentVersion")&&this.ea.yR(this.Ao));this.commentTaskPane&&this.commentTaskPane.BF(this.xz);
for(let va=0,rb=this.RZb.length;this.jb&&va<rb;++va)cb.a(this.jb).kQ(this.RZb[va]).Lq(this.tN);this.Rx=this.ea=this.commentTaskPane=this.ha=this.gridView=this.jb=null;this.wua&&(this.wua.dispose(),this.wua=null);this.Aw&&(this.Aw.dispose(),this.Aw=null);this.Ma.xD(ea.a.L0a,t.a.frame,this.L0a);this.Ma.xD(ea.a.TIa,t.a.frame,this.TIa);super.dispose()}lch(va){this.dA=new G(D.a.instance);this.bA=this.GMf=Sc.createInstance(this.Ma,D.a.instance,z.AFrameworkApplication.sa.wy,z.AFrameworkApplication.sa.Lt,
z.AFrameworkApplication.sa.Le,z.AFrameworkApplication.sa.oea,this,this.jb,this.commentTaskPane,this.dA,this.ha);this.DGc=new aa(this.Ma,this.bA.qHg);this.wKc=new md;this.lFc=new ye(this.commentTaskPane,this.bA.L3c);this.eYd=this.zhh();this.Rx=new Td(this,this.commentTaskPane,this.jb,this.gridView);this.Fy=this.FMf=Sa.createInstance(this,this.jb,this.ha,this.ea);this.ufa=Ga.createInstance(this,this.jb,this.gridView,this.ha,this.commentTaskPane);this.Zb=this.yq;this.Aw=new me(this.jb,this.Ge);null==
va?Zd.TaskExtensions.za(ed.GetServiceTaskFactory.Oa(this.jb.da,389,390,0),rb=>{this.wua=new tc(this,this.Aw,rb.result)},this.jb.da.la,3):this.wua=new tc(this,this.Aw,va)}Haf(){return qd.kve(this.Ge.owb(),this.ha.qa.selectedRanges)}Qzb(va){this.X2.initialize(this,this.M0a);this.Ge.initialize(this);this.ufa.initialize(va)}rni(va){return!!va&&va===this.sC}Fcg(va,rb){e.ULS.shipAssertTag(537167392,12,1===va||2===va&&this.hasCommentAtActiveCell||3===va,"ExcelCommentManager.SubmitCommentAction: we can't submit a delete/edit operation if there is no comment in the active selection.");
let fc=!0;const Nc=1!==va?this.sC:null;switch(va){case 3:this.Ge.wkd(rb);break;case 2:this.X2.editComment(ea.a.editComment,null,2,null,Nc.id);break;case 1:va=new V.a;va.gU=rb.Ve;va.LY=rb.method;this.X2.bob(ea.a.T9a,null,2,va,this.ha.qa.activeCell.clone());break;default:fc=!1}return fc}setFocus(va,rb){rb||this.X2.setFocus();return!rb}bob(va){if(1===this.mode){va=Sa.Weh(this.ha.qa.activeCell,this,va);var rb=new bb;this.addComment(va,rb);this.jb.qf()}}HHa(va){this.gKa("ExcelCommentManager::CommitNewComment",
va);super.HHa(va);this.mode=4}GHa(va){this.gKa("ExcelCommentManager::CommitEditComment",va);super.GHa(va);this.mode=4}selectComment(va,rb=1){this.znh(va);const fc=this.Ge.nt(va);fc&&(this.Ge.selectComment(fc),this.ufa.highlightComment(fc,!0),this.X2.selectComment(fc,rb),1===rb&&(this.hqd(va)?this.dA.selectComment(this.aUh()):this.dA.selectComment(va)))}F7g(va,rb){rb&&(va.done=rb.isResolved);super.GHa(va);this.mode=4}U3c(va,rb){super.U3c(va,rb);this.mode=4}Afi(va=null){this.ZRa();va=Sa.Xeh(this.ha.qa.activeCell,
this,va);this.gKa("ExcelCommentManager::InitCreateCommentSession",va);this.Ge.Vnb(va,!0);this.nBd();return this.Ge.Jwb(va)}ggi(va,rb=null){va=Sa.Yeh(this.model.nt(va).anchor,this,va,rb);this.gKa("ExcelCommentManager::InitReplyCommentSession",va);this.Ge.Vnb(va,!0);this.nBd();return this.Ge.Jwb(va)}Cfi(va,rb=null){va=this.model.nt(va);va.qgc(2,rb);this.gKa("ExcelCommentManager::InitEditCommentSession",va);this.Ge.H9c(va,rb);this.nBd();return this.Ge.Jwb(va)}Sfi(va,rb){va=this.model.nt(va);this.Ge.H9c(va,
rb);return this.Ge.Jwb(va)}k4c(){const va=this.Ge.rt;(null===va||void 0===va?0:va.ju)?this.endCommentSession(!0):e.ULS.sendTraceTag(537167391,12,10,"Attempting to discard when there is no active draft!")}endCommentSession(va){this.Rx&&this.Rx.hQi(this.Fka());this.Fka()&&(this.gKa("ExcelCommentManager::EndCommentSession",this.Ge.rt),this.Ge.uAe(),this.Ge.BU="",this.ngb(!0),va&&this.Gdd())}v$i(){new Ra(this.jb,this,null,null)}upgradeLegacyComments(va){if(this.jb&&cb.a(this.jb)&&this.jb.oa){var rb=new Ka.a(124,
0,(fc,Nc,hd)=>ca(this.jb.oa.xa,va,Kb.b(fc,this.c1i),Kb.a(Nc,this.TJf),hd,this.correlationId));this.jb.userOperationManager.Jc(rb,null)}}prd(va){return(va=this.model.nt(va))?va.e7a:!1}hZj(){this.av()}A7b(va){this.gKa("ExcelCommentManager::DeleteCommentConfirmed",va);if(va){this.dDa=null;this.av();va=this.Ge.deleteComment(va);this.X2.gLd(va);for(let rb=0;rb<va.length;rb++)va[rb].dispose()}}$kh(va){if(this.ha.qa.h5&&this.commentTaskPane.isVisible){const rb=this.sC;rb?this.VI.K_(467845448,null,2,null,
rb.id):this.Ge.wkd(va)}else this.Ge.wkd(va)}elh(va){(va=this.model.nt(va))&&this.deleteComment(va)}WPd(va,rb=0){if(0===rb){const fc=this.model.nt(va);fc?this.Mzc(fc.anchor,!1):e.ULS.sendTraceTag(537167390,12,15,"SelectExcelComment: comment is null, which means we will fail to select it")}this.selectComment(va,rb)}znh(va){!this.commentTaskPane.isVisible&&this.Rx&&this.qni(va)&&this.Aub()}qni(va){return!!this.Ge.rt&&this.Ge.rt.id===va}zuj(va){this.selectComment(va,1);x.a.QYa(D.a.instance,()=>{this.ZRa()})}N0a(){var va=
[];this.Ge.BU===He.d(this.jb.na)&&this.Ge.rt&&(va=0,this.Ge.rt.ju.sessionType===P.create&&(va=this.Ge.Jwb(this.Ge.rt)),va=[Object(b.a)(new Mb,{draftId:this.Ge.rt.ju.draftId,insertIndex:va})]);this.Gdd(va)}A7g(){const va=this.adc();this.dA?(this.dA.e1j(this.p1a,0===this.mode),this.dA.ovj(va,this.Nhd(),this.Ge.Sid())):e.ULS.sendTraceTag(537167389,12,10,"Event host should not be null.")}adc(){return[...this.fJi.iVj(this.model.owb(),!this.jb.isEditMode,(new Sd.a(this.jb.va)).Ph)]}e_h(){return this.Ge.Sid()}Nhd(){const va=
this.adc();let rb=0;for(const fc of va)fc.parentId&&fc.parentId.length||rb++;return rb}isCommentOperationEnabled(va){if(!this.Use(this.mode)||this.jb.$d.get(1)||1!==this.ha.Ke)return!1;let rb=!1;switch(va){case 3:rb=8!==this.VI.K_(ea.a.commentDelete,null,1,null,null);break;case 1:rb=8!==this.VI.K_(ea.a.T9a,null,1,null,null);break;case 4:rb=8!==this.VI.K_(ea.a.bO,null,1,null,null);break;case 5:rb=8!==this.VI.K_(ea.a.PR,null,1,null,null)}return rb}Use(va){return 1===va||2===va||3===va}Fka(){return!!this.Ge.rt}Jwc(){""===
this.Ge.BU&&(this.Ge.BU=He.d(this.jb.na))}ngb(va){if(va||!this.Agc)this.$qf(),this.A7g();this.jjg(va)}jjg(va){va||!this.Agc?(this.ZPd||this.ijg(),this.commentTaskPane.fxa&&this.ZPd&&(this.Jcg(!0),this.ZPd=!1),this.Rx&&this.Rx.gQi()):this.Fta=!0;this.NAi()}nxc(va){this.gridView.qg(ja.v(va,this.jb),va,null,null,60,"ExcelCommentManager.SelectRangeInGrid",void 0,void 0,void 0,void 0,!0)}cLg(va){if(va=this.g5h(va))va=this.qJe(va),this.Ge.Vnb(va,!1)}XRi(va){!va||this.commentTaskPane.isVisible?(this.hasCommentAtActiveCell&&
this.selectComment(this.sC.id,1),(va=this.model.tAa)&&va.focus()):this.$bg()}nKa(va){return this.Ge.nKa(va)}Kef(va,rb,fc=null){this.CY=new Oa(this,this.dA,this.DGc,D.a.instance,this.jb,va,this.Ge,rb,fc)}ILb(va){const rb=new Fc(!0,this.gridView);va?this.VI.K_(ea.a.bO,rb,2,null,null):this.VI.K_(ea.a.PR,rb,2,null,null)}U9f(){this.$hf()&&this.Rx.pJh();this.commentTaskPane.isVisible||this.$hf()||this.DUd()}$hf(){const va=this.Ge.tAa;return va?this.hqd(va.id):!1}Guj(va,rb){const fc=Sa.Ihd(this.ha.qa.activeCell,
va,this.Ge.owb()).returnValue;fc?(va=fc.anchor,this.Mzc(va,rb),this.gridView.qg(ja.v(va,this.jb),va,null,null,60,"ExcelCommentManager.SelectNextOrPreviousCommentFromActiveCell",void 0,void 0,void 0,void 0,!0)):this.$Pd(va,rb)}selectFirstThreadInNextCommentContext(){this.$Pd(!0,!1)}selectLastThreadInPreviousCommentContext(){this.$Pd(!1,!1)}setThreadResolvedState(va,rb){this.y3b(this.model.nt(va),rb)}gridViewSetFocus(){this.gridView.setFocus()}$nd(){this.Rx.$nd()}fBf(va,rb,fc){rb=new Vd.Range(rb+1,
fc+1,rb+1,fc+1,!1,!1);(fc=this.Ge.nKa(rb))?this.Rx.MZa?va?this.Rx.hBf(fc):this.Rx.iQi(fc.id):e.ULS.sendTraceTag(537167388,12,50,"OnCommentCellHoverChange: floating comments not yet initialized"):this.wua&&this.wua.fXi(va,rb)}YIj(va){this.Rx.MZa&&(va=this.Ge.nKa(va))&&this.Rx.Szc(va,!1)}ZIj(){this.DUd()}DUd(){this.sC?this.Rx.Szc(this.sC,!0):this.Tca?this.EUd=!0:e.ULS.sendTraceTag(537167387,12,15,"Trying to show a comment at the active cell for deep linking when none exists")}Aub(){this.Rx.MZa&&this.Rx.Aub()}sQj(va){const rb=
this.activeSheet;if(rb&&d.a.N$(rb.sheetId).equals(va))return!0;va=this.x7e(va);if(!va)return!1;va.activate(!0);return!0}CKi(){if(this.Ge.rt){var va=this.u7e();this.jb.activeItemName===va.SheetName?this.WPd(this.$Th()):this.dxf(va,this.gridView)}}hqd(va){const rb=this.Ge.rt;if(!rb||!rb.ju)return!1;const fc=rb.ju;return fc.draftId===va||fc.threadId===va||rb.id===va||rb.jk===va}NAi(){const va=[];var rb=null;this.activeSheet&&this.activeSheet.mJ&&(rb=this.activeSheet.mJ.ObjectMetadataArray);if(rb)for(const fc of rb)rb=
fc,rb.IsLegacy&&(rb=new ue.a(rb.CommentId,rb.Author.DisplayName,rb.Text,new Vd.Range(rb.AnchorRow+1,rb.AnchorColumn+1,rb.AnchorRow+1,rb.AnchorColumn+1,!1,!1),rb.IsTextLocked?2:0,this),va.push(rb));this.p7d=0<va.length;e.ULS.shipAssertTag(537167386,12,!!this.Aw,"LoadLegacyNotesData: not expecting NoteModel to be null");this.Aw&&this.Aw.zea(va);this.Rm&&this.Rm.iMi();this.Fta=!1}$qf(){var va=null,rb=null;this.activeSheet&&this.activeSheet.mJ&&(rb=this.activeSheet.mJ.ObjectMetadataArray,va=this.activeSheet.mJ);
const fc=[];var Nc=null;const hd=[];if(rb){Nc=[];for(const xd of rb){rb=xd;const ae=this.qJe(rb);if(!ae.e7a&&(Nc.push(xd),ae.commentBody.startsWith(this.jyi)&&(ae.commentBody="{ "+ae.commentBody),"}"!==this.ZXh(ae.commentBody)&&(ae.commentBody+="}"),fc.push(ae),this.GAb&&rb.DocumentTaskObject)){const Wd=new Uc.a;Wd.add(ae.id,new ba(ae.id,ae.isResolved));rb=this.wKc.jVj(rb.DocumentTaskObject,Wd);hd.push(rb)}}}this.tYd=Nc;va?(Nc=va.HasCommentsInSheetBefore||this.zph(),va=va.HasCommentsInSheetAfter||
this.Aph(),this.Ge.x_j(fc,hd,Nc,va)):this.Ge.zea(fc,hd);this.Fta=!1;this.o7d=0<fc.length}D7e(va){for(let rb=0,fc=this.jb.va.count;rb<fc;++rb){const Nc=this.jb.va.getItem(rb);if(He.d(Nc)===va)return Nc}return null}eXh(va){return(va=this.D7e(va))?va.index:-1}ggd(){let va=-1;if(!this.Ge.rt||""===this.Ge.BU)return va;va=this.eXh(this.Ge.BU);0>va&&e.ULS.shipAssertTag(537167384,12,!1,"ExcelCommentManager.GetDraftSheetIndex: there should be a known sheet index for a valid sheet ID!");return va}zph(){const va=
this.ggd();return 0<=va&&va<this.activeSheet.index}Aph(){const va=this.ggd();return 0<=va&&va>this.activeSheet.index}aUh(){const va=this.Ge.rt;return va&&va.ju?va.jk||va.ju.commentId||va.ju.draftId:null}$Th(){const va=this.Ge.rt;return va&&va.ju?va.jk||va.ju.commentId||va.id:null}Ag(){}Jcg(va){var rb=null;this.X2.Rnb?rb=this.ha.qa.activeCell.clone():this.X2.uOe&&(rb=this.sC,e.ULS.shipAssertTag(537167383,12,!!rb,"ExcelCommentManager.SubmitShowCommentPaneAction: active cell should have a comment to edit!"),
rb=rb.id);va?this.X2.n7(ea.a.n7,null,2,null,rb):this.X2.eba(ea.a.eba,null,2,null,null)}g5h(va){if(this.tYd&&va)for(const rb of this.tYd)if(rb.CommentId===va)return rb;return null}ijg(){if(this.commentTaskPane.isVisible||this.Rx.MZa){var va=this.sC;va?this.Ge.tAa&&va.id===this.Ge.tAa.id||this.selectComment(va.id,1):this.Ge.tAa&&this.hZj();this.jb.qf()}}rhf(){return this.ea.Xb&&!this.jb.userOperationManager.operationCount&&He.i(this.activeSheet)}Y2h(){const va=this.model.owb();let rb=-1;var fc=this.Ge.tAa;
if(!fc)return rb;fc=fc.jk&&0<fc.jk.length?fc.jk:fc.id;let Nc=!1;for(const hd of va)if(!(hd.jk&&0<hd.jk.length)&&(rb+=1,fc===hd.id)){Nc=!0;break}return Nc?rb:-1}Gdd(va=null){const rb=this.adc(),fc=0===this.mode,Nc=this.Nhd(),hd=this.Y2h();0<=hd&&hd<Nc?this.dA.nvj(rb.length,Nc,hd,fc,this.p1a,va):this.dA.mvj(rb.length,Nc,fc,this.p1a,va);this.dA.Jvj(rb,this.Ge.Sid())}Jvc(){this.rhf()&&(this.rY(),this.nZa=0,this.b$())}PK(){for(let va=0,rb=this.jb.va.count;va<rb;++va){const fc=this.jb.va.getItem(va);if(null===
fc||void 0===fc?0:fc.mJ)fc.mJ.Version=qd.WA}}rY(){this.Tca&&(Ad.a.Nt(this.Tca.Rs),this.Tca=null)}b$(){this.jb&&cb.a(this.jb)&&this.jb.oa&&(cb.a(this.jb).iMa?this.Tca||(this.correlationId+=1,this.Tca=fb(this.jb.oa.xa,3,this.activeSheet.name,this.Ftd()&&0<this.nZa&&this.voa?this.voa.Version:this.version,this.nZa,this.gTi,this.hTi,null,this.correlationId)):this.rY())}nBd(){this.Rx&&this.Rx.Voc()}ZRa(){this.setFocus(!0,!1);this.yq.Qj(Y.AFrame.Ro)}qJe(va){let rb=null;va.DocumentTaskObject&&!Z.a.lh(va.DocumentTaskObject.HistoryRecords)&&
va.DocumentTaskObject.HistoryRecords[0].User&&(rb=va.DocumentTaskObject.HistoryRecords[0].User.DisplayName);return new lb.a(va.CommentId,va.ParentCommentId,va.Text,va.DateTime?new Date(va.DateTime):null,va.Author,new Vd.Range(va.AnchorRow+1,va.AnchorColumn+1,va.AnchorRow+1,va.AnchorColumn+1,!1,!1),va.IsTextLocked,va.IsLegacy,va.IsEditRestricted,this,va.IsResolved,va.IsCurrentUser,!!va.DocumentTaskObject,rb)}Fsf(va){const rb={};rb.a=this.jb.ya.UserSessionId;rb.b=va;za.b().Se(33,rb)}$Pd(va,rb){this.Fka()?
(this.Jwc(),this.XFe(va)):this.s2f(va,rb)}KCd(va){this.k4c();this.XFe(va)}XFe(va){this.N0a();this.s2f(va,!1)}s2f(va,rb){const fc=this.jb.oa.xa.Wb();let Nc;const hd=this.model.owb();Nc=hd&&hd.length?ja.o((va?hd[hd.length-1]:hd[0]).anchor,this.jb):ja.o(this.ha.qa.activeCell,this.jb);this.NHb=va?2:1;this.Irc=oe.a(this.jb.userOperationManager,(xd,ae,Wd)=>ka(this.jb.oa.xa,Nc,va,Kb.b(xd,this.lSi),Kb.a(ae,this.OCf),Wd,new Fc(rb,this.gridView),fc),xd=>new Ka.a(509,0,xd,80),null)}B3h(){const va=this.D7e(this.Ge.BU);
return va?va.sheetName:null}u7e(){const va=ja.v(this.Ge.rt.anchor,this.jb);va.SheetName=this.B3h()||va.SheetName;return va}aGj(va){const rb=this.ggd();if(!va||0===this.NHb||0>rb)return!1;const fc=2===this.NHb,Nc=this.jb.va.getItemByName(va.SheetName);return Nc&&rb!==this.activeSheet.index?rb===Nc.index?(va=qd.Urb(this.Ge.rt.anchor,ja.D(va)),fc&&0>=va||!fc&&0<=va):fc?rb<Nc.index&&!(rb<this.activeSheet.index&&this.activeSheet.index<Nc.index)||rb>this.activeSheet.index&&this.activeSheet.index>=Nc.index:
rb>Nc.index&&!(rb>this.activeSheet.index&&this.activeSheet.index>Nc.index)||rb<this.activeSheet.index&&this.activeSheet.index<=Nc.index:!1}dxf(va,rb,fc=!1){let Nc=null;Nc=()=>{this.jb.va.sg(Nc);this.Mzc(ja.D(va),fc)};this.jb.activeItemName===va.SheetName?this.Mzc(ja.D(va),fc):this.jb.va.Vf(Nc);rb.qg(va,ja.D(va),null,null,60,"ExcelCommentManager.OnFindNextOrPreviousCommentCrossSheetWebMethodSuccess",void 0,void 0,void 0,void 0,!0)}Mzc(va,rb){let fc=null;fc=(Nc,hd)=>{this.gridView.XLd(fc);if(hd.H9e){if((Nc=
this.gridView.Pb(va))&&Nc.cell.uk)this.U9f();else{let xd=null;xd=ae=>{ae.De.contains(va)&&(this.gridView.Muc(xd),this.U9f())};this.gridView.L_b(xd)}rb&&this.hasCommentAtActiveCell&&this.zuj(this.sC.id)}else e.ULS.sendTraceTag(537167380,12,15,"Failed to navigate to the next or previous comment")};this.gridView.qXc(fc)}Nrf(va){const rb={};rb.a=this.jb.ya.UserSessionId;rb.b=va;za.b().Se(34,rb)}zhh(){let va="Unknown",rb="Unknown";try{var fc=kc.b(z.AFrameworkApplication.fa.appSettings.SessionStartInfoJson.toString());
va=fc.Ring||"Unknown";rb=fc.WACDatacenter||"Unknown"}catch(Nc){e.ULS.sendTraceTag(537167379,12,10,`Error fetching session start info from app settings. Threw ${Nc}`)}fc=this.jb.ya.LokiComplianceEnvironment;return new xa("Excel",z.AFrameworkApplication.buildVersion,null,null,this.jb.ya.UserSessionId,va,rb,!this.jb.ya.AriaLoggingIsEnabled,this.Ma,null,fc&&""!==fc?fc:z.AFrameworkApplication.fa.Wa("SovereignEnvironmentName"))}ZXh(va){for(let rb=va.length-1;0<=rb;rb--){const fc=va.charAt(rb);if(" "!==
fc&&"\n"!==fc&&"\t"!==fc&&"\r"!==fc)return fc}return"\x00"}gKa(va,rb){rb?e.ULS.sendTraceTag(537167377,12,50,"VSO3351297: InvalidCommentDataState- "+va+". Id: "+rb.id+", Type: "+rb.commentType):e.ULS.sendTraceTag(537167378,12,10,"VSO3351297: InvalidCommentDataState- "+va+". inProgressComment is null")}$bg(){this.Agc&&(this.mode=1)}cxf(va){va=va.toString();if(!va)return e.ULS.sendTraceTag(537167364,12,10,"NavigateToCommentById: contentId is null"),8;let rb=Object(Ma.a)(qa.a,this.Ge.nt(va));if(!rb)return e.ULS.sendTraceTag(537167363,
12,15,"NavigateToFloatingCommentThread: comment does not exist"),8;rb.jk&&(rb=Object(Ma.a)(qa.a,this.Ge.nt(rb.jk)));this.selectComment(va,1);this.Rx.Szc(rb,!0);return 32}x7e(va){const rb=this.jb.va.items;for(let fc=0;fc<rb.length;++fc)if(rb[fc]&&d.a.N$(rb[fc].sheetId).equals(va))return rb[fc];return null}xZh(va){return(va=this.Sbd(va,0))?parseInt(va,10):Number.NaN}J1e(va){return(va=this.Sbd(va,1))?d.a.N$(va):d.a.nil}y7e(va){return(va=this.Sbd(va,2))?d.a.N$(va):d.a.nil}Sbd(va,rb){if(!va)return null;
va=va.split("_");return va.length<rb+1?null:va[rb]}Ftd(){return Na.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ThreadedCommentPagination",!1)}set Ona(va){super.Ona=va}static Urb(va,rb){return va.top!==rb.top?va.top-rb.top:va.left-rb.left}static L1f(va,rb){Zd.TaskExtensions.za(ed.GetServiceTaskFactory.Oa(rb.da,211,212,0),fc=>{fc=fc.result;fc.setEnabled(!0);fc.readText(Ba.a.instance.ga(va))},rb.la,3)}static kve(va,rb){if(!(va&&va.length&&rb&&rb.length))return!1;for(const fc of rb)if({efi:rb}=
Sa.Ihd(fc.topLeft,!0,va),!(0>rb))for(rb=0<rb?rb-1:rb;rb<va.length;rb++){const Nc=va[rb].anchor;if(0<qd.Urb(Nc,fc.bottomRight))break;if(fc.zd(Nc))return!0}return!1}static ka(va,rb,fc,Nc,hd,xd){rb=qd.createInstance(va,rb,fc,Nc,hd,xd);f.a.instance=rb;return va.da.Ha(65,rb)}static createInstance(va,rb,fc,Nc,hd,xd){const ae=Nc.jc;return new qd(ae,ae,z.AFrameworkApplication.rb,va,rb,fc,Nc,hd,ia.FocusManager.instance(),xd)}}qd.WA=-1;qd.GCd="OnCommentDraftStarted";Object(c.a)(qd,"ExcelCommentManager",f.a,
[447,2])},778:function(r,F,a){a.d(F,"a",function(){return d});r=a(0);var c=a(97),b=a(264),e=a(174),f=a(873);class d extends f.Comment{constructor(h,l,k,t,n,z,w,m,u,y=!1){super(h,f.Comment.U9e,l,w,m,y,w?[k]:d.Ffd(k),-1);this.KRj=null;this.anchor=t;this.MEe=n;this.Xe=z;this.ezg=u}get Wgc(){return 1===(this.MEe&1)}get hnf(){return 2===(this.MEe&2)}get e7a(){return this.ezg}get isResolved(){return this.done}focus(){this.Wgc||this.MGb()}MGb(){this.Wgc||c.FocusManager.instance().Qj(b.AFrame.Ro)}qgc(h,l){this.nX=
h;this.$fa=0;this.sTb=l}static P5b(h,l,k,t){h=new d(e.a.create().toString(),h,null,l,0,k,null,null,!0);h.qgc(1,t);return h}static Ffd(h){return h?h.split("<br/>")||[h]:[]}}Object(r.a)(d,"ExcelComment",f.Comment,[377])},806:function(r,F,a){a.d(F,"a",function(){return f});r=a(0);var c=a(174),b=a(4);F=a(778);var e=a(140);class f extends F.a{constructor(d,h,l,k,t,n){super(d,h,l,k,t,n,null,null,!0);this.$=n.$}static Us(d){return d.isEditMode&&(new e.a(d.va)).Pd(1)}static dfh(d,h){return new f(c.a.create().toString(),
b.AFrameworkApplication.userName,String.format("{0}:\n",b.AFrameworkApplication.userName),d,0,h)}}Object(r.a)(f,"Note",F.a,[376,377])},873:function(r,F,a){a.r(F);r=a(0);var c=a(1349),b=a(85),e=a(1008),f=a(719),d=a(802),h=a(264),l=a(4),k=a(121),t=a(156),n=a(554),z=a(227),w=a(14),m=a(97),u=a(86),y=a(110),v=a(109),C=a(88),x=a(57),B=a(40),H=a(27),I=a(25);class U{constructor(D){this.nnc=4;this.ohe=0;this.S7d=this.Y5d=this.Zhe=this.q8d=this.Tie=this.X1=this.eYa=this.jm=this.mWa=this.Fke=this.S9d=this.T9d=
this.OX=this.Vfa=this.dKc=this.s8=this.n8=this.$a=this.Jpa=this.e1=null;H.a.V4&&(this.nnc=6);this.tl=D;this.cqa=y.KeyInputManager.Al(u.a.Voa,0);this.render()}get pj(){return this.$a}get Ykh(){return this.n8}get tsj(){return this.OX}dispose(){var D=l.AFrameworkApplication.sa.wy;const E=l.AFrameworkApplication.sa.Lt;D.Ba(w.a.click,this.$a,Object(b.a)(this,this.vBf,"onContainerClick"));D.Ba(w.a.tk,this.$a,Object(b.a)(this,this.wBf,"onContainerDoubleClick"));E.Ba(w.a.Ld,this.$a,Object(b.a)(this,this.xBf,
"onContainerKeyPress"));this.n8&&(D.Ba(w.a.click,this.n8,Object(b.a)(this,this.r$a,"onDeleteButtonClick")),E.Xw(this.n8,this.S7d));this.s8&&(D.Ba(w.a.click,this.s8,Object(b.a)(this,this.UCd,"onDoneButtonClick")),E.Xw(this.s8,this.q8d));this.OX&&(D.Ba(w.a.click,this.OX,Object(b.a)(this,this.rqc,"onSaveButtonClick")),E.Xw(this.OX,this.Tie));this.e1&&(D.Ba(w.a.click,this.e1,Object(b.a)(this,this.cma,"onCancelButtonClick")),E.Xw(this.e1,this.Y5d));this.Vfa&&(D.Ba(w.a.click,this.Vfa,Object(b.a)(this,this.nEd,
"onReplyButtonClick")),E.Xw(this.Vfa,this.Zhe));this.jm&&(E.Ba(w.a.hp,this.jm,Object(b.a)(this,this.HV,"onKeyEvent")),E.Ba(w.a.Ld,this.jm,Object(b.a)(this,this.HV,"onKeyEvent")),H.a.Hg&&(D=l.AFrameworkApplication.sa.rfb,D.Ba(w.a.Yrb,this.jm,Object(b.a)(this,this.b6,"onCompositionEvent")),D.Ba(w.a.Xrb,this.jm,Object(b.a)(this,this.b6,"onCompositionEvent")),D.Ba(w.a.Zrb,this.jm,Object(b.a)(this,this.b6,"onCompositionEvent"))),n.a.instance.Ba(w.a.paste,this.jm,Object(b.a)(this,this.onPaste,"onPaste")));
this.mWa=this.X1=this.eYa=this.jm=this.e1=this.OX=this.dKc=this.s8=this.Vfa=this.n8=this.$a=null}focus(){m.FocusManager.instance().Qj(h.AFrame.Ro);this.$a.focus();this.tl.Qf.MJ().ef.Fl(this.$a)}jZe(){m.FocusManager.instance().Qj(e.a.Nrb);this.jm.focus();this.tl.Qf.MJ().ef.Fl(this.jm);2===this.tl.commentType&&this.jm.value&&0<this.jm.value.length&&B.a.ldb(this.jm);const D=this.tl.Qf.Yg.ks,E=B.a.F1h(D,this.$a);E.y+this.$a.clientHeight>D.scrollTop+D.clientHeight&&(D.scrollTop=E.y+this.$a.clientHeight-
D.clientHeight)}UHh(){Sys.UI.DomElement.removeCssClass(this.$a,"NewOrEditComment");this.e1.style.display="none";this.jm.style.display="none";m.FocusManager.UZd(this.jm);m.FocusManager.UZd(this.OX);m.FocusManager.instance().pi(e.a.Nrb).yk(this.cqa);m.FocusManager.instance().EQa(e.a.Nrb);y.KeyInputManager.instance.Ba(w.a.hp,this.jm,Object(b.a)(this,this.HV,"onKeyEvent"));y.KeyInputManager.instance.Ba(w.a.Ld,this.jm,Object(b.a)(this,this.HV,"onKeyEvent"));if(H.a.Hg){const D=l.AFrameworkApplication.sa.rfb;
D.Ba(w.a.Yrb,this.jm,Object(b.a)(this,this.b6,"onCompositionEvent"));D.Ba(w.a.Xrb,this.jm,Object(b.a)(this,this.b6,"onCompositionEvent"));D.Ba(w.a.Zrb,this.jm,Object(b.a)(this,this.b6,"onCompositionEvent"))}n.a.instance.Ba(w.a.paste,this.jm,Object(b.a)(this,this.onPaste,"onPaste"));this.Jpa.removeChild(this.jm);this.Jpa.removeChild(this.eYa);this.X1=this.eYa=this.jm=null;this.C0d();this.Poa();this.focus()}Poa(){this.yda(this.Fke,this.T9d,this.S9d,this.s8,this.dKc,this.$a)}render(){var D=f.a("a",this.eR("cc"),
"CommentContainer");C.a.nh(D,C.a.DG,e.a.O3c);D.tabIndex=0;this.tl.jk&&(D.className+=" Reply1");var E=f.a("div",this.eR("ch"),"CommentHeaderRow");const N=f.a("span",this.eR("ca"),"CommentAuthor UIFontBold");N.innerText=this.tl.author;E.appendChild(N);const M=f.a("span",this.eR("ct"),"CommentDate");M.innerText=U.xjh(this.tl.date,this.tl.Qf.vjh,this.tl.Qf.uSj);Sys.UI.DomElement.addCssClass(M,l.AFrameworkApplication.isRtl?"FloatLeft":"FloatRight");E.appendChild(M);const L=f.a("span",this.eR("ci"),"CommentStatusIcon");
E.appendChild(L);let aa=null;this.tl.qMa&&(aa=d.a.pb(this.eR("cl"),e.a.GEe,CommonUIStrings.l_CommentCancelButton,"ClosePaneGlyph_16x16x32",!1),Sys.UI.DomElement.addCssClass(aa,l.AFrameworkApplication.isRtl?"FloatLeft":"FloatRight"),aa.tabIndex=0,E.appendChild(aa));this.Jpa=f.a("div",this.eR("cn"),"CommentContent");let V=null,P=null,ba=null;this.tl.qMa?(V=f.a("textarea",this.eR("ce"),e.a.Q3c+" UIFont"),V.rows=this.nnc,V.cols=50,V.tabIndex=0,C.a.nh(V,"title",CommonUIStrings.l_CommentContent),this.Jpa.appendChild(V),
P=f.a("div","","CommentTextMeasurementContainer"),ba=f.a("textarea","",e.a.Q3c+" UIFont"),ba.rows=1,ba.cols=50,ba.style.visibility="hidden",ba.spellcheck=!1,P.appendChild(ba),this.Jpa.appendChild(P),2===this.tl.commentType&&(V.value=this.tl.text.join("\n")+"\n")):this.C0d();const Y=f.a("div","","CommentFooterRow"),Z=f.a("span",this.eR("cf"),""),ea=d.a.pb(this.eR("cr"),e.a.NEe+" CommentFooterButton",CommonUIStrings.l_CommentReplyButton,"CommentReply_16x16x32",!1);ea.tabIndex=0;ea.setAttribute(C.a.Cd,
C.a.Qs);Z.appendChild(ea);const ra=d.a.pb(this.eR("cd"),"CommentDoneButton CommentFooterButton",CommonUIStrings.l_CommentDoneButton,"CheckboxUnchecked_16x16x32",!1);ra.tabIndex=0;const O=ra.childNodes[0].childNodes[0];Z.appendChild(ra);const da=d.a.pb(this.eR("cx"),e.a.HEe+" CommentFooterButton",CommonUIStrings.l_CommentDeleteButton,"Delete_16x16x32",!1);ra.tabIndex=0;Z.appendChild(da);Y.appendChild(Z);const xa=f.a("span",this.eR("cfa"),""),ia=d.a.pb(this.eR("cs"),e.a.OEe,CommonUIStrings.l_CommentSaveCommentButton,
null);d.a.Ddb(ia,!1);ia.tabIndex=0;xa.appendChild(ia);Y.appendChild(xa);this.yda(L,Z,xa,ra,O,D);this.tl.Qf.a5c||(N.setAttribute("Unselectable","on"),M.setAttribute("Unselectable","on"));D.appendChild(E);D.appendChild(this.Jpa);D.appendChild(Y);this.$a=D;this.s8=ra;this.dKc=O;this.n8=da;this.Vfa=ea;this.OX=ia;this.jm=V;this.eYa=P;this.X1=ba;this.e1=aa;this.T9d=Z;this.S9d=xa;this.Fke=L;this.mWa=E;D=l.AFrameworkApplication.sa.wy;E=l.AFrameworkApplication.sa.Lt;D.ta(w.a.click,this.$a,Object(b.a)(this,
this.vBf,"onContainerClick"));D.ta(w.a.tk,this.$a,Object(b.a)(this,this.wBf,"onContainerDoubleClick"));E.ta(w.a.Ld,this.$a,Object(b.a)(this,this.xBf,"onContainerKeyPress"));this.s8&&(D.ta(w.a.click,this.s8,Object(b.a)(this,this.UCd,"onDoneButtonClick")),this.q8d=E.Dt(this.s8,Object(b.a)(this,this.UCd,"onDoneButtonClick"),u.a.Lh));this.Vfa&&(D.ta(w.a.click,this.Vfa,Object(b.a)(this,this.nEd,"onReplyButtonClick")),this.Zhe=E.Dt(this.Vfa,Object(b.a)(this,this.nEd,"onReplyButtonClick"),u.a.Lh));this.OX&&
(D.ta(w.a.click,this.OX,Object(b.a)(this,this.rqc,"onSaveButtonClick")),this.Tie=E.Dt(this.OX,Object(b.a)(this,this.rqc,"onSaveButtonClick"),u.a.Lh));this.n8&&(D.ta(w.a.click,this.n8,Object(b.a)(this,this.r$a,"onDeleteButtonClick")),this.S7d=E.Dt(this.n8,Object(b.a)(this,this.r$a,"onDeleteButtonClick"),u.a.Lh));this.e1&&(D.ta(w.a.click,this.e1,Object(b.a)(this,this.cma,"onCancelButtonClick")),this.Y5d=E.Dt(this.e1,Object(b.a)(this,this.cma,"onCancelButtonClick"),u.a.Lh));V&&(E.ta(w.a.hp,V,Object(b.a)(this,
this.HV,"onKeyEvent")),E.ta(w.a.Ld,V,Object(b.a)(this,this.HV,"onKeyEvent")),H.a.Hg&&(D=l.AFrameworkApplication.sa.rfb,D.ta(w.a.Yrb,V,Object(b.a)(this,this.b6,"onCompositionEvent"),null),D.ta(w.a.Xrb,V,Object(b.a)(this,this.b6,"onCompositionEvent"),null),D.ta(w.a.Zrb,V,Object(b.a)(this,this.b6,"onCompositionEvent"),null)),n.a.instance.ta(w.a.paste,V,Object(b.a)(this,this.onPaste,"onPaste")),this.zDj())}n6f(D){d.a.Ddb(this.OX,D)}eR(D){return D+"_"+this.tl.id}yda(D,E,N,M,L,aa){switch(this.tl.idb){case 0:case 1:this.N$f(D,
0);break;case 2:case 4:D.style.display="none";break;case 3:Sys.UI.DomElement.addCssClass(aa,"SaveFailure"),Sys.UI.DomElement.addCssClass(aa,"NoReply"),this.N$f(D,1)}this.tl.done?(Sys.UI.DomElement.addCssClass(aa,"CommentIsDone"),L.className=t.getImageClass("CheckboxChecked_16x16x32")):(Sys.UI.DomElement.removeCssClass(aa,"CommentIsDone"),L.className=t.getImageClass("CheckboxUnchecked_16x16x32"));this.tl.qMa?(Sys.UI.DomElement.addCssClass(aa,"NewOrEditComment"),Sys.UI.DomElement.addCssClass(aa,"SelectedComment"),
D.style.display="none",E.style.display="none",N.style.display="inline",0===this.tl.Qf.mode&&(this.n6f(!1),d.a.Ddb(this.e1,!1))):(1===this.tl.wAa?(Sys.UI.DomElement.addCssClass(aa,"SelectedComment"),Sys.UI.DomElement.removeCssClass(aa,"SelectedParentComment"),E.style.display=1!==this.tl.Qf.mode||3===this.tl.idb||this.tl.Ph?"none":"inline"):(2===this.tl.wAa?(Sys.UI.DomElement.removeCssClass(aa,"SelectedComment"),Sys.UI.DomElement.addCssClass(aa,"SelectedParentComment")):(Sys.UI.DomElement.removeCssClass(aa,
"SelectedComment"),Sys.UI.DomElement.removeCssClass(aa,"SelectedParentComment")),E.style.display="inline"),N.style.display="none")}N$f(D,E){x.a.qrb(D);switch(E){case 0:E=document.createElement("img");E.alt=CommonUIStrings.l_CommentProgressTooltip;E.src=k.a.Xsa("progress16.gif");D.appendChild(E);break;case 1:E=t.createClusteredImage(16,16,"Risks_16x16x32","",!0,CommonUIStrings.l_CommentFailTooltip),D.appendChild(E)}D.style.display="inline-block"}C0d(){x.a.rrb(this.Jpa);var D=this.tl.text;1===D.length&&
D[0]&&(D=D[0].split("\n"));for(const E of D)D=f.a("p","","CommentContentPara"),D.innerText=E||"\u00a0",this.tl.Qf.a5c||D.setAttribute("Unselectable","on"),this.Jpa.appendChild(D)}zDj(){const D=m.FocusManager.instance().pi(e.a.Nrb);D.parent=h.AFrame.Ro;z.a.instance.$nb(e.a.Nrb,this.jm);D.bindAction(y.KeyInputManager.Al(u.a.Y3d,2),I.a.doNothing);D.bindAction(this.cqa,I.a.K3c);D.bindAction(y.KeyInputManager.Al(u.a.Woa,0),I.a.pia);D.bindAction(y.KeyInputManager.Al(u.a.R7,0),I.a.pia);D.yk(m.FocusManager.instance().S1);
D.yk(m.FocusManager.instance().T1)}vBf(D){if(this.tl.qMa&&D.Ea.target===this.jm)return!0;this.tl.MGb();return!0}wBf(){this.tl.WCd();return!0}xBf(D){let E=!1;D.Ea.keyCode===u.a.Lh&&(0===this.tl.wAa?this.tl.MGb():this.tl.WCd(),E=!0);return E}r$a(){if(this.n8.disabled)return!0;this.tl.Yoc();return!0}UCd(){if(this.s8.disabled)return!0;this.tl.G0i();return!0}nEd(){if(this.Vfa.disabled)return!0;this.tl.KYi();return!0}rqc(){if(this.OX.disabled)return!0;this.tl.lZi(this.jm.value);return!0}cma(){if(this.e1.disabled)return!0;
this.tl.uca();return!0}HV(D){if(D.Ea.ctrlKey&&D.Ea.keyCode===u.a.Lh)return 0<this.jm.value.length&&this.rqc(null),!0;if(D.Ea.keyCode===u.a.Voa)return!0;this.onTextEntered(D.eventName===w.a.hp&&D.Ea.charCode===u.a.Lh);return!1}b6(){this.onTextEntered(!1);return!1}onPaste(){const D=new v.a(0,1,0,()=>{this.onTextEntered(!1)},1);l.AFrameworkApplication.ji.fg(D);return!1}onTextEntered(D){if(0!==this.tl.Qf.mode&&(this.n6f(0<this.jm.value.length),!H.a.V4)){this.eYa.clientWidth!==this.jm.clientWidth&&(this.eYa.style.width=
this.jm.clientWidth+"px");this.X1.value=this.jm.value+"___";this.ohe>this.jm.value.length&&(this.X1.rows=1);for(var E=0,N=Number.MAX_VALUE;1<=(E=this.X1.scrollHeight-this.X1.clientHeight)&&E<N;)N=E,this.X1.rows++;this.X1.rows<this.nnc?this.jm.rows=this.nnc:(D&&this.X1.rows++,this.jm.rows=this.X1.rows);this.ohe=this.jm.value.length}}static xjh(D,E,N){if(!D||isNaN(D.getDate()))return"";let M=N;const L=new Date;if(L.getFullYear()!==D.getFullYear()||L.getMonth()!==D.getMonth()||L.getDate()!==D.getDate())M=
String.format(CommonUIStrings.l_CommentLongDateFormat,E,N);return D.localeFormat(M)}}Object(r.a)(U,"CommentViewObject",null,[2,391]);var S=a(174);a.d(F,"Comment",function(){return G});class G{constructor(D,E,N,M,L,aa,V,P,ba,Y,Z,ea=null){this.FXb=0;this.$fa=2;this.nX=0;this.objectId=this.sTb=this.Sv=null;this.Ph=!1;this._id=D;this.e5d=N;this.aTb=M;this.iXb=L;this.Nib=aa;this.Lfa=V;this.i$d=P;this.usersByReactionType=ea;this.Xe=c.a.instance}get id(){return this._id}set id(D){this._id=D}get author(){return this.dmf?
CommonUIStrings.l_RemovedAuthorName:this.e5d}get date(){return this.dmf?null:this.aTb}set date(D){this.aTb=D}get done(){return this.Nib}set done(D){this.Nib!==D&&(this.Nib=D,this.Sv&&this.Sv.Poa())}get n5a(){return this.i$d}set n5a(D){this.i$d=D}get jk(){return this.iXb}set jk(D){this.iXb=D}get text(){return this.Lfa}set text(D){this.Lfa=D;this.Sv&&this.Sv.C0d()}get wAa(){return this.FXb}set wAa(D){this.FXb!==D&&(this.FXb=D,this.Sv&&this.Sv.Poa())}get idb(){return this.$fa}set idb(D){this.$fa===D||
0===this.$fa&&2===D||3===this.$fa||(this.$fa=D,this.Sv&&this.Sv.Poa())}get commentType(){return this.nX}set commentType(D){if(this.nX!==D){const E=this.qMa&&0===D;this.nX=D;E&&this.Sv&&this.Sv.UHh()}}get qMa(){return 1===this.nX||2===this.nX}get dmf(){return!!this.Xe&&this.Xe.Gij}get pj(){return this.Sv?this.Sv.pj:null}get Qf(){return this.Xe}get REe(){return this.Sv}get ju(){return this.sTb}set ju(D){this.sTb=D}dispose(){this.Sv&&(this.Sv.dispose(),this.Sv=null)}render(){this.Sv=new U(this);return this.Sv.pj}F9a(){this.Sv&&
this.Sv.Poa()}focus(){this.MGb();this.Sv.focus();this.qMa&&this.Sv.jZe()}toString(){let D="[null]";this.Lfa&&0<this.Lfa.length&&(D=30<this.Lfa[0].length?this.Lfa[0].substr(0,30)+"...":this.Lfa[0]);return String.format('I:{0} A:{1} T:{2} R:{3} D:{4} "{5}"',this._id||"[null]",this.e5d||"[null]",this.aTb?this.aTb.toString():"[null]",this.iXb||"[null]",this.Nib,D)}MGb(){2===this.Qf.mode||3===this.Qf.mode?this.qMa&&this.Sv.jZe():(m.FocusManager.instance().Qj(h.AFrame.Ro),1!==this.FXb&&this.Qf.selectComment(this._id))}WCd(){this.Qf.$cg&&
0===this.nX&&(m.FocusManager.instance().Qj(h.AFrame.Ro),this.nX=2,this.$fa=0,this.Qf.editComment(this,null))}DRi(){3===this.Qf.mode&&(m.FocusManager.instance().Qj(h.AFrame.Ro),this.nX=0,this.$fa=2,this.Qf.I1g(this))}Yoc(){m.FocusManager.instance().Qj(h.AFrame.Ro);this.Qf.deleteComment(this)}G0i(){this.Qf.y3b(this,!this.Nib)}KYi(){2!==this.Qf.mode&&(m.FocusManager.instance().Qj(h.AFrame.Ro),this.Qf.addReply(this.iXb||this._id,null))}lZi(D){m.FocusManager.instance().Qj(h.AFrame.Ro);this.Lfa=Array(1);
this.Lfa[0]=D;1===this.nX?this.Qf.HHa(this):this.Qf.GHa(this)}uca(){m.FocusManager.instance().Qj(h.AFrame.Ro);this.Qf.Yg.ks&&this.Qf.Yg.ks.focus();1===this.nX?(this.Qf.deleteComment(this),this.Qf.m2f(this.jk)):this.DRi()}static P5b(D,E,N,M){const L=S.a.create().toString();D=new G(L,G.U9e,D,new Date,E,!1,[],N,!1,l.AFrameworkApplication.fa.Wa("PresenceUserId"),l.AFrameworkApplication.fa.Wa("PresenceProvider"));D.nX=1;D.$fa=0;D.sTb=M;return D}}G.U9e=null;G.A3i=-1;Object(r.a)(G,"Comment",null,[2,379])},
897:function(r,F,a){a.d(F,"a",function(){return b});r=a(0);var c=a(174);a=a(778);class b extends a.a{constructor(e,f,d,h,l,k,t,n,z,w,m,u,y=!1,v=null){super(e,l.DisplayName,d,k,t?2:0,w,h,f,n,m);this.mkf=!1;this.Yre=null;this.otf=l;this.hFi=z;this.sFi=u;this.tFi=y;this.HFi=v}get commentBody(){return this.text&&0<this.text.length?this.text[0]:""}set commentBody(e){this.text[0]=e}get authorIdentity(){return this.otf.UserId}get Bwe(){return this.otf.Provider}get jRg(){return this.anchor?this.anchor.toString():
""}get roi(){return this.hFi}get isCurrentUser(){return this.sFi}get vvi(){return this.tFi}get kRj(){return this.HFi}static Chh(e,f,d,h){e=new b(c.a.create().toString(),null,null,null,e,f,!1,!1,!1,d,!1,!0);e.qgc(1,h);return e}static Dhh(e,f,d,h,l){e=new b(c.a.create().toString(),h,null,null,e,f,!1,!1,!1,d,!1,!0);e.qgc(1,l);return e}}Object(r.a)(b,"ExcelThreadedComment",a.a,[378])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.commentpane.js.map/45ebaa9f462ed2be756ff48ce419ccd0/EwaDSEsNext.commentpane.js.map